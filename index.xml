<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>CloudWeGo – CloudWeGo</title><link>https://www.cloudwego.io/</link><description>Recent content on CloudWeGo</description><generator>Hugo -- gohugo.io</generator><language>en</language><atom:link href="https://www.cloudwego.io/index.xml" rel="self" type="application/rss+xml"/><item><title>Blog: Kitex Release v0.13.0</title><link>https://www.cloudwego.io/blog/2025/04/07/kitex-release-v0.13.0/</link><pubDate>Mon, 07 Apr 2025 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2025/04/07/kitex-release-v0.13.0/</guid><description>
&lt;blockquote>
&lt;p>We recommend upgrading directly to Kitex version v0.13.1, as we have fixed a potential Goroutine leak issue of the gRPC Client in v0.13.0.&lt;/p>
&lt;/blockquote>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="new-features">&lt;strong>New Features&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>New streaming interface StreamX supports gRPC, existing Kitex gRPC users can migrate&lt;/strong>&lt;/p>
&lt;p>v0.12.0 released the StreamX interface to optimise the streaming experience, and supported the custom streaming protocol TTHeader Streaming, but did not support gRPC. So existing users could not migrate.&lt;/p>
&lt;p>This version supports gRPC for StreamX, users can migrate to StreamX, and the Server side can be compatible with two streaming protocols at the same time. So there is no need to worry about protocol compatibility after interface migration.&lt;/p>
&lt;p>In particular, when adapting gRPC with StreamX, we found that there are still some inconvenient problems. In order to bring a better experience of using the interface, we have adjusted the StreamX interface for the second time, which will affect the users who have already been using StreamX. We apologise for that.&lt;/p>
&lt;p>User documentation: &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/streamx/">StreamX User Documentation&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Prutal - Protobuf&amp;rsquo;s non-generated code serialisation library&lt;/strong>&lt;/p>
&lt;p>&lt;a href="https://github.com/cloudwego/prutal">Prutal&lt;/a> is officially open source, on par with Thrift&amp;rsquo;s &lt;a href="https://github.com/cloudwego/frugal">Frugal&lt;/a>, and the new version of Kitex integrates Prutal by default.&lt;/p>
&lt;p>Advantages:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Minimized Code Product Size: Generating Only Structures, No Runtime Code&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Leveraging Reflection Optimization Similar to Frugal, Achieving Over 50% Speed Increase&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Generating Code Compatible with Existing Protobuf and Derivative Versions&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>User documentation: &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/code-gen/prutal/">Prutal&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="featureexperience-optimization">&lt;strong>Feature/Experience Optimization&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>TTHeader Streaming: Support interface-level Recv timeout control&lt;/strong>&lt;/p>
&lt;p>In addition to the existing Client level, this release of TTHeader Streaming supports interface-level Recv timeout configuration, making configuration more flexible.&lt;/p>
&lt;p>User documentation: &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/streamx/kitex&amp;#43;streamx&amp;#43;-&amp;#43;stream&amp;#43;timeout&amp;#43;control/">StreamX Timeout Control&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Default Thrift transport protocol changed from Buffered to Framed&lt;/strong>&lt;/p>
&lt;p>This change can leverage FastCodec for better performance.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="others">&lt;strong>Others&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>Code Product Simplification&lt;/strong>&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>
&lt;p>Kitex Tool would not generate the repeated verification code for Set data structure and the &lt;code>DeepEqual&lt;/code> function for each structure by default.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>If you only want to restore&lt;code>DeepEqual&lt;/code>, add&lt;code>-thrift gen_deep_equal=true&lt;/code>to the generation command.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>If you want to restore the repeated verification of Set, add&lt;code>-thrift validate_set=true, -thrift gen_deep_equal=true&lt;/code>to the generation command.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Kitex Tool would not generate the Apache Codec related code by default.&lt;/p>
&lt;ul>
&lt;li>If you want to restore it, add&lt;code>-thrift no_default_serdes=false&lt;/code>to the generation command.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>
&lt;p>&lt;strong>Go Supported Version Change&lt;/strong>&lt;/p>
&lt;p>Support version Go 1.19~1.24, the lowest supported version becomes Go 1.19.&lt;/p>
&lt;p>if Go version is too low, there will be a prompt when compiling:&lt;code>note: module requires Go 1.19&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="full-change">&lt;strong>Full Change&lt;/strong>&lt;/h2>
&lt;h3 id="feature">Feature&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1719">#1719&lt;/a>] feat: prutal for replacing protoc&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1736">#1736&lt;/a>] feat(ttstream): support WithRecvTimeout stream call option&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1702">#1702&lt;/a>] feat(gRPC): add grpc client conn dump to help debug the conn and stream status&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1723">#1723&lt;/a>] feat(codec/thrift): use fastcodec/frugal if apache codec not available&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1724">#1724&lt;/a>] feat: add tail option to support for delayed initialization of some client options&lt;/p>
&lt;h3 id="optimize">Optimize&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1728">#1728&lt;/a>] optimize(apache): remove apache codec gen and set default protocol from buffered to framed&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1732">#1732&lt;/a>] optimize(rpcinfo): purify the transport protocol of rpcinfo in a single rpc request&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1711">#1711&lt;/a>] optimize(tool): disable set validate and deep equal code gen to simplify kitex_gen&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1717">#1717&lt;/a>] optimize(gRPC): return more detailed error when received invalid http2 frame&lt;/p>
&lt;h3 id="fix">Fix&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1734">#1734&lt;/a>] fix(ttstream): adjust stream state transition and remove all SetFinalizer to avoid memory leak&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1735">#1735&lt;/a>] fix(generic): support both relative and absolute check for idl includes parse to make it compatible with generation tool&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1725">#1725&lt;/a>] fix: code gen import issue for streamx mode, stream call judgement bug and set ttheader streaming as default&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1727">#1727&lt;/a>] fix(tool): fix tool UseStdLib remains unexpected lib issue&lt;/p>
&lt;h3 id="refactor">Refactor&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1658">#1658&lt;/a>] refactor: streamx api to adapt both grpc and ttheader streaming protocol and provide more user-friendly interface&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1729">#1729&lt;/a>] refactor(tool): move pb tpl code to sep pkg&lt;/p>
&lt;h3 id="chore">Chore&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1743">#1743&lt;/a>] chore: update dependencies version&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1740">#1740&lt;/a>] chore(generic): deprecate NewThriftContentProvider&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1741">#1741&lt;/a>] chore(streamx): remove redundant streamx package&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1738">#1738&lt;/a>] ci: fix typos &amp;amp; crate-ci/typos&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1737">#1737&lt;/a>] chore: update dependency and change go support to 1.19-1.24&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1720">#1720&lt;/a>] Revert &amp;ldquo;fix(ttstream): pingpong method refers to server interface defined in Kitex generation code when streamx is enabled and there are other streaming methods&amp;rdquo;&lt;/p></description></item><item><title>Blog: Kitex Release v0.12.0</title><link>https://www.cloudwego.io/blog/2025/01/03/kitex-release-v0.12.0/</link><pubDate>Fri, 03 Jan 2025 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2025/01/03/kitex-release-v0.12.0/</guid><description>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="simplified-product-recommendation---remove-apache-thrift-dependency">Simplified Product Recommendation - Remove Apache Thrift Dependency&lt;/h3>
&lt;p>We strongly recommend removing Apache Codec to resolve the compilation issues caused by Apache&amp;rsquo;s incompatible changes and to &lt;strong>reduce the product size by 50%&lt;/strong>.&lt;/p>
&lt;p>Please replace it with Kitex&amp;rsquo;s own Thrift codec: FastCodec or Frugal, which does not rely on Apache Thrift Codec.&lt;/p>
&lt;p>Future version plans: Kitex will remove Apache products by default. User guide: &lt;a href="https://www.cloudwego.io/docs/kitex/best-practice/remove_apache_codec/">Kitex Remove Apache Thrift User Guide&lt;/a>&lt;/p>
&lt;h3 id="new-features">New Features&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>Thrift Streaming over TTHeader - Custom Streaming Protocol&lt;/strong>&lt;/p>
&lt;p>Supported streaming calls based on the TTHeader protocol, optimizing stability issues caused by the high complexity of the gRPC streaming protocol.&lt;/p>
&lt;p>Provided a new streaming interface, StreamX, to solve various user experience issues with the original streaming interface and provide best practices for streaming interfaces.&lt;/p>
&lt;p>For more details: &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/streamx/">StreamX User Documentation and Best Practices&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Graceful Shutdown for gRPC Streaming&lt;/strong>&lt;/p>
&lt;p>Added support for a graceful shutdown feature to address upstream errors caused by service upgrades or updates.&lt;/p>
&lt;p>For usage: &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/graceful_shutdown/">gRPC Streaming Graceful Shutdown&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>JSON Generic Call Supports gRPC Streaming&lt;/strong>&lt;/p>
&lt;p>JSON generic calls now support gRPC Streaming interfaces (client-side only). This is the official release after trial in v0.10.0.&lt;/p>
&lt;p>For usage: &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/advanced-feature/generic-call/generic_streaming/">User Guide to Generic Call for Streaming&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="experience-optimization">Experience Optimization&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>gRPC Streaming Log Optimization&lt;/strong>&lt;/p>
&lt;p>For streaming concatenation scenarios, if the downstream error is due to an exit of the upstream Stream exiting, the error will include the suffix &amp;ldquo;[triggered by {serviceName}]&amp;rdquo; will be included in the error, which is convenient for locating the problem.&lt;/p>
&lt;p>Errors returned by Send such as &lt;code>the stream is done&lt;/code> now reflect the actual error that caused the stream to close.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Code Generation Tool Kitex Tool&lt;/strong>&lt;/p>
&lt;p>&lt;strong>Optimization of Generation Speed and Tool Installation&lt;/strong>: Now Thriftgo is built into Kitex, significantly improving generation speed, especially for scenarios with particularly large IDL files. There is no need to install or upgrade Thriftgo anymore.&lt;/p>
&lt;p>&lt;strong>Minimizing Product Size&lt;/strong>: To minimize product size, Frugal can be used. For gray scale adoption, it supports specifying certain structs to use Frugal serialization.
For more details, refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/code-gen/code_generation/">Code Generation Tool&lt;/a> for instructions on -frugal-struct and -gen-frugal parameters.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="breaking-change---no-impact-for-99-of-users">Breaking Change - No Impact for 99% of Users&lt;/h3>
&lt;p>Kitex will strive to ensure compatibility with normal usage methods. Some users may have dependencies on certain code definitions of Kitex, and this version adjustment of Kitex will have an impact on these users.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Removing &lt;code>thrift.NewBinaryProtocol&lt;/code>
&lt;code>thrift.NewBinaryProtocol&lt;/code> is Kitex&amp;rsquo;s implementation of the Apache thrift.TProtocol interface. Because the trans part directly uses Kitex&amp;rsquo;s ByteBuffer, the performance is better than Apache thrift.TBinaryProtocol.
The Deprecation comment has been added to it in v0.11.0.&lt;/p>
&lt;p>&lt;strong>Removing Reason&lt;/strong>: To remove the Apache Thrift dependency, the implementation needs to be removed.&lt;/p>
&lt;p>&lt;strong>User Modification Method&lt;/strong>: This implementation was originally used with Apache Codec. If you still need to rely on Apache Codec, please directly use Apache&amp;rsquo;s TBinaryProtocol.
If you think that it has an impact on performance, you can fork the old version of Kitex, refer to github/cloudwego/kitex v0.10.0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;github.com/apache/thrift/lib/go/thrift&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">tProt&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">thrift&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewTBinaryProtocol&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">thrift&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewTMemoryBufferLen&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1024&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>Removing &lt;code>generic.ServiceInfo&lt;/code>&lt;/strong>&lt;/p>
&lt;p>Generic removed an API &lt;code>generic.ServiceInfo&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Removing Reason&lt;/strong>: To prepare for future multi-service registration on a generic server, the generic implementation has been refactored (v0.11.0), and this API is no longer used.&lt;/p>
&lt;p>&lt;strong>User Modification Method&lt;/strong>: This API was replaced by &lt;code>generic.ServiceInfoWithGeneric&lt;/code>. Please use it instead.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/kitex/pkg/generic&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// removed&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">ServiceInfo&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">pcType&lt;/span> &lt;span style="color:#000">serviceinfo&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">PayloadCodec&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">serviceinfo&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">ServiceInfo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// please use this instead&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">ServiceInfoWithGeneric&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">g&lt;/span> &lt;span style="color:#000">Generic&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">serviceinfo&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">ServiceInfo&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h3 id="feature">Feature:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1541">#1541&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1633">#1633&lt;/a>] feat(ttstream): support ttheader streaming and streamv2 interface&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1623">#1623&lt;/a>] feat(gRPC): optimize gRPC error prompt and metrics, assisting in troubleshooting problems&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1556">#1556&lt;/a>] feat(gRPC): support gRPC graceful shutdown&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1467">#1467&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1627">#1627&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1619">#1619&lt;/a>] feat(generic): support thrift streaming(over gRPC) for json generic client&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1607">#1607&lt;/a>] feat(tool): kitex tool support gen frugal codec for certain struct&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1526">#1526&lt;/a>] feat(generic): support an option to remove go.tag annotation&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1536">#1536&lt;/a>] feat(generic): support an option to set IDL ParseMode for each client&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1510">#1510&lt;/a>] feat: register service with service level middleware&lt;/p>
&lt;h3 id="optimize">Optimize:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1635">#1635&lt;/a>] optimize: add two function for binary protocol to get bufiox reader and writer&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1630">#1630&lt;/a>] optimize(tool): implement no recursive generate to support incremental update&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1617">#1617&lt;/a>] optimize(retry): optimize UpdatePolicy and add test cases to check invalid retry policy. &amp;lt;v0.11.0, if the FailurePolicy is nil and type is 0 or &amp;gt;1, will trigger nil panic. The bug has been fixed in v0.11.0, this pr is to add test cases and optimize UpdatePolicy to ignore the nil panic&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1606">#1606&lt;/a>] optimize(tool): use embedded thriftgo as default option&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1595">#1595&lt;/a>] optimize(tool): optimize pb tool code&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1599">#1599&lt;/a>] optimize(tool): call FastWriteNocopy in FastWrite to avoid misuse by users&lt;/p>
&lt;h3 id="refactor">Refactor:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1615">#1615&lt;/a>] refactor: get rid of apache thrift in go.mod&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1611">#1611&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1614">#1614&lt;/a>] refactor: move ttheader codec logic to gopkg&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1553">#1553&lt;/a>] refactor(codec/thrift): unified typecodec implementation and adjust new file layout&lt;/p>
&lt;h3 id="perf">Perf:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1581">#1581&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1628">#1628&lt;/a>] perf(timeout): refactor new rpctimeout implementation to improve performance&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1564">#1564&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1567">#1567&lt;/a>] perf: reduce object allocation for circuitbreak middleware and retry context&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1557">#1557&lt;/a>] perf(rpcinfo): remove lock for rpcinfo.RPCStats&lt;/p>
&lt;h3 id="fix">Fix:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1622">#1622&lt;/a>] fix(generic): use jsoniter instead of sonic for json generic-call, since sonic doesn&amp;rsquo;t support map[interface{}]interface{}&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1562">#1562&lt;/a>] fix: deep copy function of the generated code cannot copy the empty string&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1602">#1602&lt;/a>] fix(gRPC): check if the type assertion succeed in ProtocolMatch to avoid panic&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1598">#1598&lt;/a>] fix(retry): fix issue that mixed retry cannot update its config correctly&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1590">#1590&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1572">#1572&lt;/a>] fix(generic): set default values for optional fields of primitive types with generic with dynamicgo&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1580">#1580&lt;/a>] fix(netpoll): fix timeout caused by partial use of the Read method of remote.ByteBuffer&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1574">#1574&lt;/a>] fix(trace): stream event handler ignore io.EOF event&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1563">#1563&lt;/a>] fix(generic): fix the issue where the generic client sets the parse mode of CombineServices and then requests causes &amp;ldquo;unknown service&amp;rdquo; error&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1568">#1568&lt;/a>] fix(wpool): fix the issue of wpool object allocation, and incorrect ctx causing profiler errors.&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1558">#1558&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1555">#1555&lt;/a>] fix(bthrift): fix the issue of no recursion conversion of unknown field type under bthrift&lt;/p>
&lt;h3 id="chore">Chore:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1593">#1593&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1560">#1560&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1561">#1561&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1559">#1559&lt;/a>] chore(test): fix data race issue, unstable issue and long time running issue of some test cases&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1634">#1634&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1632">#1632&lt;/a>][&lt;a href="https://github.com/cloudwego/kitex/pull/1573">#1573&lt;/a>] chore(dep): upgrade frugal, localsession and other cloudwego dependency versions&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1616">#1616&lt;/a>] chore(generic): remove deprecated apis/interfaces/variables&lt;/p></description></item><item><title>Blog: Kitex Release v0.11.0</title><link>https://www.cloudwego.io/blog/2024/09/12/kitex-release-v0.11.0/</link><pubDate>Thu, 12 Sep 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/09/12/kitex-release-v0.11.0/</guid><description>
&lt;blockquote>
&lt;p>Highly recommend upgrading Kitex version to v0.11.3 or higher, because there&amp;rsquo;s some bugfix on v0.11.0.&lt;/p>
&lt;/blockquote>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="new-feature">New Feature&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>Mixed Retry&lt;/strong>: Supports enabling both &amp;ldquo;Failure Retry&amp;rdquo; and &amp;ldquo;Backup Request&amp;rdquo; strategies simultaneously, which can reduce tail requests while increasing the success rate of retries, for more detail: &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/service-governance/retry/">Retry&lt;/a>&lt;/li>
&lt;li>&lt;strong>Custom Payload Validation&lt;/strong>: To avoid inconsistencies in data transmission caused by hardware failures or data tampering, Kitex provides validation functionality for payload messages and supports custom extensions. For usage: &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/advanced-feature/payload_validator/">Payload Validator&lt;/a>.&lt;/li>
&lt;/ol>
&lt;h3 id="feature-optimization">Feature optimization&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>Frugal ARM Optimization&lt;/strong>: Frugal v0.2.0 now supports a new implement by reflection&lt;/li>
&lt;li>&lt;strong>Kitex Tool Improvement&lt;/strong>: Kitex Tool provide a new param &lt;code>-rapid&lt;/code> to integrates Thriftgo and there&amp;rsquo;s a slightly improved speed.&lt;/li>
&lt;li>&lt;strong>Generating Multiple Handlers for Multiple Services&lt;/strong>：Since this version, Kitex tool provide each service with independent handler file and register them into server，for more details: &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/advanced-feature/multi_service/multi_handler/">Generating Multiple Handlers for Multiple Services&lt;/a>&lt;/li>
&lt;li>&lt;strong>Generic Streaming for JSON [on trial]&lt;/strong>：JSON generic streaming has now support streaming (client only)，currently we&amp;rsquo;re doing some optimization, you can have a try by following this doc: &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/advanced-feature/generic-call/generic_streaming/">Generic Streaming&lt;/a>&lt;/li>
&lt;/ol>
&lt;h3 id="others">Others&lt;/h3>
&lt;ol>
&lt;li>Support Go 1.18~1.23. Minimum support for Golang 1.18，if your golang version is lower than 1.18, you&amp;rsquo;ll see &lt;code>note: module requires Go 1.18&lt;/code> when you compile.&lt;/li>
&lt;li>Remove Apache Thrift，and refactor all related interface into github.com/cloudwego/gopkg/thrift.&lt;/li>
&lt;/ol>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h3 id="feature">Feature:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1509">#1509&lt;/a>] feat(retry): support Mixed Retry which integrating Failure Retry and Backup Request&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1478">#1478&lt;/a>] feat: customized payload validator&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1514">#1514&lt;/a>] feat(grpc): server returns cancel reason&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1513">#1513&lt;/a>] feat(tool): support updating import path for PkgInfo&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1425">#1425&lt;/a>] feat(tool): support generating multiple handlers for multiple services&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1491">#1491&lt;/a>] feat(grpc): add GetTrailerMetadataFromCtx&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1492">#1492&lt;/a>] feat: add GetCallee to kitexutil to get the service name of callee&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1479">#1479&lt;/a>] feat(tool): embed thriftgo into kitex tool&lt;/p>
&lt;h3 id="optimize">Optimize:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1485">#1485&lt;/a>] optimize: add cachekey to discovery event for debug&lt;/p>
&lt;h3 id="fix">Fix:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1525">#1525&lt;/a>] fix: move json-iterator back to support marshal &lt;code>map[any]any&lt;/code>&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1471">#1471&lt;/a>] fix(streaming): resolve ctx diverge in server-side streaming&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1515">#1515&lt;/a>] fix(gRPC): pass error when client transport is closed&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1501">#1501&lt;/a>] fix(generic): judge business error directly&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1503">#1503&lt;/a>] fix: return an unknown service/method exception to client correctly under multi_service server scenario&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1487">#1487&lt;/a>] fix(generic): fix a generic serviceInfo compatible issue&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1489">#1489&lt;/a>] fix(codec): wrap trans error for apache thrift read error&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1486">#1486&lt;/a>] fix(trans/netpoll): log when panic in onConnRead&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1476">#1476&lt;/a>] fix: fix GetServerConn interface assert for streamWithMiddleware&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1481">#1481&lt;/a>] fix(gonet): adjust gonet server read timeout to avoid read error&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1466">#1466&lt;/a>] fix: allow HEADERS frame with empty header block fragment&lt;/p>
&lt;h3 id="refactor">Refactor:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1512">#1512&lt;/a>] refactor: thrift and generic codec uses bufiox interface for encoding and decoding&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1490">#1490&lt;/a>] refactor: optimized apache codec without reflection&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1483">#1483&lt;/a>] refactor: use github.com/cloudwego/gopkg/protocol/thrift/apache&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1474">#1474&lt;/a>] refactor: rm apache thrift in internal/mocks&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1470">#1470&lt;/a>] refactor: rm apache thrift in pkg/generic &amp;amp; netpollmux&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1450">#1450&lt;/a>] refactor(generic): remove apache thrift.TProtocol from generic&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1441">#1441&lt;/a>] refactor: deprecate bthrift, use cloudwego/gopkg&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1455">#1455&lt;/a>] refactor(test): perf optimize and log loc correct&lt;/p>
&lt;h3 id="tests">Tests:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1469">#1469&lt;/a>] test: replace judgement of mem stats of client finalizer by closed count check&lt;/p>
&lt;h3 id="perf">Perf:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1527">#1527&lt;/a>] perf(grpc): bdp ping rate limit&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1511">#1511&lt;/a>] perf(thrift): encodeBasicThrift write logic didn&amp;rsquo;t use kitex BinaryProtocol&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1504">#1504&lt;/a>] perf(grpc): zero allocation in hot path&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1497">#1497&lt;/a>] perf: add option to enable spancache for fastpb&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1495">#1495&lt;/a>] perf(thrift): use kitex BinaryProtocol replace apache BinaryProtocol for apache thrift codec&lt;/p>
&lt;h3 id="chore">Chore:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1532">#1532&lt;/a>] chore: update dependency&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1522">#1522&lt;/a>] chore(generic): make generic streaming APIs internal&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1465">#1465&lt;/a>] chore(generic): add an external method to create service info for generic streaming client&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1468">#1468&lt;/a>] build: adapt to go1.23rc2&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1482">#1482&lt;/a>] chore(generic): add generic base using gopkg base&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1463">#1463&lt;/a>] chore: fix grpc keepalive test by start server responsiblly&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1462">#1462&lt;/a>] chore(test): fix xorshift64 in consist_test.go&lt;/p>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1454">#1454&lt;/a>] chore(ci): speed up multiple ci processes 8min -&amp;gt; 1min&lt;/p></description></item><item><title>Blog: Kitex Release v0.10.0</title><link>https://www.cloudwego.io/blog/2024/06/12/kitex-release-v0.10.0/</link><pubDate>Wed, 12 Jun 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/06/12/kitex-release-v0.10.0/</guid><description>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="performance-optimization">Performance Optimization&lt;/h3>
&lt;ol>
&lt;li>Long connection: conncurrency = 100, qps increased by 4%, p99 decreased by 18%&lt;/li>
&lt;li>connection multiplexing: conncurrency = 100, qps increased by 7%, p99 decreased by 24%&lt;/li>
&lt;li>gRPC: conncurrency = 100, qps increased by 8%，p99 decreased by 10%&lt;/li>
&lt;/ol>
&lt;h3 id="code-generation-simplification-and-optimization">Code Generation Simplification and Optimization&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>Remove non-serialization code (By default)&lt;/strong>: the original kitex_gen Thrift code includes Processor code to maintain consistency with Apache Thrift. However, Kitex does not need these codes. To solve users&amp;rsquo; code generation painpoint, this version Kitex removes this part of the code, increasing the generation speed by about 10%.&lt;/li>
&lt;li>&lt;strong>Remove Apache Codec code (Remove if configured)&lt;/strong>：Kitex has custom FastCodec code, and the original Apache Codec is only required when using Buffered protocol. The new version of Kitex implements SkipDecoder. If enabled, the serialization will be completely independent of Apache Codec, reducing the generated code size by about 50%. Refer to this doc for usage &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/code-gen/skip_decoder/">SkipDecoder&lt;/a>&lt;/li>
&lt;/ol>
&lt;h3 id="new-feature">New Feature&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>Thrift Serialize Data Ondemands&lt;/strong>：Support defining FieldMask to achieve on-demand serialization of data (field clipping, merging, RPC Performance optimization, etc.), see details &lt;a href="https://github.com/cloudwego/thriftgo/tree/main/fieldmask">Thrift FieldMask RFC&lt;/a>&lt;/li>
&lt;/ol>
&lt;h3 id="feature-optimization">Feature optimization&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>CircuitBreaker&lt;/strong>： Support for customized circuit breaker error types.&lt;/li>
&lt;li>&lt;strong>Failure Retry&lt;/strong>：The code configuration of the customized result retry adds the ctx parameter to facilitate users to check whether to retry based on ctx information.&lt;/li>
&lt;li>&lt;strong>Remove cache from consistent hashing&lt;/strong>：Solve the issue of high latency and memory increase caused by scattered hash keys. After removing the cache, it can effectively reduce memory usage and cache management consumption in scenarios where keys are particularly scattered or even close to random distribution.&lt;/li>
&lt;/ol>
&lt;h3 id="user-experience-and-tool-optimization">User Experience and Tool Optimization&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>Kitex tool compatibility check&lt;/strong>：Optimize the &amp;ldquo;undefined&amp;rdquo; compile error caused by introducing new definitions in old generated code. The Kitex tool will check the Kitex version used in go.mod before generating code. If the Kitex tool and Kitex version are incompatible, the code will not be generated and will provide corresponding upgrade and downgrade prompts and documentation.&lt;/li>
&lt;/ol>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h3 id="feature">Feature:&lt;/h3>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1370">#1370&lt;/a>] feat(loadbalance): do not cache all the keys for Consistent Hash&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1359">#1359&lt;/a>] feat:(generic) jsonpb using dynamicgo support parse IDL from memory&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1353">#1353&lt;/a>] feat(retry): add ctx param for customized result retry funcs&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1352">#1352&lt;/a>] feat: add option to specify ip version for default HTTPResolver&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1316">#1316&lt;/a>] feat(kitex tool): support dependencies compatibility checking&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1346">#1346&lt;/a>] feat(generic): set dynamicgo parse mode&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1336">#1336&lt;/a>] feat(tool): fast-codec supports Thrift Fieldmask&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1313">#1313&lt;/a>, #1378] feat(thrift codec): implement skipDecoder to enable Frugal and FastCodec for standard Thrift Buffer Protocol&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1257">#1257&lt;/a>] feat: CBSuite custom GetErrorType func&lt;/li>
&lt;/ol>
&lt;h3 id="optimize">Optimize:&lt;/h3>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1349">#1349&lt;/a>] optimize(gRPC): gRPC onError uses CtxErrorf to print log with information in ctx&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1326">#1326&lt;/a>] optimize(tool): remove thrift processor for less codegen&lt;/li>
&lt;/ol>
&lt;h3 id="perf">Perf:&lt;/h3>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1369">#1369&lt;/a>] perf(thrift): optimized skip decoder&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1314">#1314&lt;/a>] perf: use dirtmake to reduce memclr cost&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1322">#1322&lt;/a>] perf(codec): support fast write nocopy when using netpoll link buffer&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1276">#1276&lt;/a>] perf: linear allocator for fast codec ReadString/ReadBinary&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1320">#1320&lt;/a>] perf(codec): fast codec use batch alloc&lt;/li>
&lt;/ol>
&lt;h3 id="fix">Fix:&lt;/h3>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1379">#1379&lt;/a>] fix: fix a bug &amp;ldquo;unknown service xxx&amp;rdquo; when using generic client by not writing IDLServiceName when it&amp;rsquo;s generic service&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1368">#1368&lt;/a>] fix(remote): modify the error message thrown when no target service is found&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1374">#1374&lt;/a>] fix: init default values when using liner allocator&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1361">#1361&lt;/a>] fix: span cache re-cap bytes when using Make&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1362">#1362&lt;/a>] fix(payloadCodec): replace the registered PayloadCodec if the type is same when using WithPayloadCodec for server-side&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1364">#1364&lt;/a>] fix: fix grpc compressor mcache free panic when data is empty&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1328">#1328&lt;/a>] fix(gRPC): release connection in DoFinish for grpc streaming to close the short connection&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1307">#1307&lt;/a>] fix(connpool): kitex long pool reset idleList element to nil to prevent conn leak&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1294">#1294&lt;/a>] fix(netpollmux): fix a bug that disables multi-service by assigning the first svcInfo to targetSvcInfo&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1308">#1308&lt;/a>] fix(generic): not write generic method name for binary generic exception to align with method names of services not using binary generic&lt;/li>
&lt;/ol>
&lt;h3 id="refactor">Refactor:&lt;/h3>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1344">#1344&lt;/a>] refactor(tool): export thriftgo template definition in kitextool&lt;/li>
&lt;/ol>
&lt;h3 id="chore">Chore:&lt;/h3>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1385">#1385&lt;/a>] chore: update dynamicgo to v0.2.8&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1383">#1383&lt;/a>] chore: upgrade netpoll to v0.6.1&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1376">#1376&lt;/a>] chore: integration test use go 1.20 to solve the compatibility issue of official gRPC in kitex-tests repo&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1355">#1355&lt;/a>] chore: upgrade netpoll to v0.6.1 pre-release version&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1338">#1338&lt;/a>] chore: correct the comment of FreezeRPCInfo&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1347">#1347&lt;/a>] chore: use runtimex to replace choleraehyq/pid&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1342">#1342&lt;/a>] chore: update sonic/loader to v0.1.1&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1334">#1334&lt;/a>] chore: update dynamicgo to v0.2.3&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1324">#1324&lt;/a>] chore: update dynamicgo and sonic version&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1317">#1317&lt;/a>] chore: frugal v0.1.15 (with migrated iasm)&lt;/li>
&lt;/ol>
&lt;hr>
&lt;p>&lt;strong>Thanks a lot to those community contributors who submit some pull requests or share your ideas for this version:&lt;/strong>
@XiaoYi-byte&lt;/p></description></item><item><title>Blog: Hertz Release v0.9.0</title><link>https://www.cloudwego.io/blog/2024/05/30/hertz-release-v0.9.0/</link><pubDate>Thu, 30 May 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/05/30/hertz-release-v0.9.0/</guid><description>
&lt;p>The Hertz v0.9.0 release mainly supports general iteration and optimization.&lt;/p>
&lt;h2 id="feature">Feature&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/1101">#1101&lt;/a>] feat: add method to exile requestContext&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/1056">#1056&lt;/a>] feat: add more default type for binding&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/1057">#1057&lt;/a>] feat: add SetHandlers when fast fail for no valid host and invalid rPath&lt;/li>
&lt;/ol>
&lt;h2 id="optimize">Optimize&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/921">#921&lt;/a>] optimize(hz): sort route strictly which preventing sorting inconsistencies&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/1037">#1037&lt;/a>] optimize: filter shortConnErr in tracer&lt;/li>
&lt;/ol>
&lt;h2 id="fix">Fix&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/1102">#1102&lt;/a>] fix: resp set trailer will panic&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/1107">#1107&lt;/a>] fix: router sort&lt;/li>
&lt;/ol>
&lt;h2 id="refactor">Refactor&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/1064">#1064&lt;/a>] refactor(hz): client query enum&lt;/li>
&lt;/ol></description></item><item><title>Blog: Volo Release 0.10.0</title><link>https://www.cloudwego.io/blog/2024/04/08/volo-release-0.10.0/</link><pubDate>Mon, 08 Apr 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/04/08/volo-release-0.10.0/</guid><description>
&lt;p>In Volo 0.10.0, we mainly focused on extensibility and ease of use.&lt;/p>
&lt;h2 id="break-change">Break Change&lt;/h2>
&lt;h3 id="error-handling-refactored">Error Handling Refactored&lt;/h3>
&lt;p>Existing error types had issues such as unclear semantics, lack of maintainability and extensibility, and misuse. In the new version, we refactored the entire error handling, greatly enhancing the clarity and maintainability of error handling, and reducing misuse through the type system.&lt;/p>
&lt;h4 id="migration-guide">Migration Guide&lt;/h4>
&lt;h5 id="server-handler-migration">Server Handler Migration&lt;/h5>
&lt;ol>
&lt;li>If previously using &lt;code>anyhow::Result&lt;/code>, change &lt;code>anyhow::Result&lt;/code> to &lt;code>volo_thrift::ServerResult&lt;/code>:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">example&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>: &lt;span style="color:#000">XReq&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">volo_thrift&lt;/span>::&lt;span style="color:#000">ServerResult&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">XResp&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>If previously using Result&amp;lt;XResp, anyhow::Error&amp;gt;, replace anyhow::Error with volo_thrift::ServerError:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">example&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>: &lt;span style="color:#000">XReq&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">XResp&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">volo_thrift&lt;/span>::&lt;span style="color:#000">ServerError&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>If you were using &lt;code>Exception&lt;/code>, change the return type from &lt;code>Result&amp;lt;XResp, volo_thrift::UserException&amp;lt;XException&amp;gt;&amp;gt;&lt;/code> to &lt;code>Result&amp;lt;volo_thrift::MaybeException&amp;lt;XResp, XException&amp;gt;, volo_thrift::ServerError&amp;gt;&lt;/code>. At the same time, places that return &lt;code>Err(UserError::UserException(exception))&lt;/code> should be changed to use &lt;code>Ok(MaybeException::Exception(exception))&lt;/code>:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">example&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>: &lt;span style="color:#000">XReq&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">volo_thrift&lt;/span>::&lt;span style="color:#000">MaybeException&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">XResp&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">XException&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">volo_thrift&lt;/span>::&lt;span style="color:#000">ServerError&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">..&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Ok&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">volo_thrift&lt;/span>::&lt;span style="color:#000">MaybeException&lt;/span>::&lt;span style="color:#000">Exception&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">exception&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>If an error occurs when returning &lt;code>anyhow::Error&lt;/code> after these changes, you can manually add a &lt;code>.into()&lt;/code>:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">return&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Err&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">anyhow&lt;/span>::&lt;span style="color:#000">anyhow!&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">xxx&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">into&lt;/span>&lt;span style="color:#000;font-weight:bold">())&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="5">
&lt;li>If an error occurs at the &lt;code>?&lt;/code> error return spot after these changes, you can try converting it to &lt;code>anyhow::Error&lt;/code> before returning:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">x&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">xxx&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#000">map_err&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">|&lt;/span>&lt;span style="color:#000">e&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">|&lt;/span>&lt;span style="color:#000">anyhow&lt;/span>::&lt;span style="color:#000">anyhow!&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">e&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">?&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="service-middleware-migration">Service Middleware Migration&lt;/h5>
&lt;p>For middleware that is not aware of user errors, this change should not cause a breaking change. If you are aware of user errors, then just change the original &lt;code>volo_thrift::Error&lt;/code> to &lt;code>volo_thrift::ServerError/ClientError&lt;/code>.&lt;/p>
&lt;h5 id="client-migration">Client Migration&lt;/h5>
&lt;p>The error part of the client has changed from &lt;code>ResponseError&lt;/code> to &lt;code>ClientError&lt;/code>. Just follow the compiler error message prompts to match the new error variant.&lt;/p>
&lt;h3 id="idl-management-file-voloyml-format-refactored">IDL Management File volo.yml Format Refactored&lt;/h3>
&lt;p>The structure of the new yml configuration is clearer, easier to maintain, and mainly solves the issue that the old version could not support cross-repository referencing with git. The specific functions and configuration parameters can be seen &lt;a href="https://www.cloudwego.io/docs/volo/guide/config">here&lt;/a>. In addition, for the volo-cli command-line tool, we have renamed the previous idl command to repo.&lt;/p>
&lt;h4 id="migration-guide-1">Migration Guide&lt;/h4>
&lt;p>Install the volo-cli v0.10.0 version and execute the volo migrate command in the volo.yml directory for automatic migration.&lt;/p>
&lt;h3 id="change-in-default-generated-enum-type">Change in Default Generated Enum Type&lt;/h3>
&lt;p>In the newly generated code, the default generated Enum type has been changed to a newtype wrapping i32, in order to better support forward compatibility of modifications in the enumeration values of the IDL enum field.&lt;/p>
&lt;h4 id="migration-guide-2">Migration Guide&lt;/h4>
&lt;p>Just modify the enumeration name in the enum field to the corresponding generated name, such as &lt;code>Foo::Bar&lt;/code> -&amp;gt; &lt;code>Foo::BAR&lt;/code>.&lt;/p>
&lt;h2 id="complete-release-note">Complete Release Note&lt;/h2>
&lt;p>For the complete Release Note, please refer to: &lt;a href="https://github.com/cloudwego/volo/compare/volo-0.9.0...volo-0.10.0">Volo Changelog&lt;/a>&lt;/p></description></item><item><title>Blog: Netpoll Release v0.6.0</title><link>https://www.cloudwego.io/blog/2024/03/04/netpoll-release-v0.6.0/</link><pubDate>Mon, 04 Mar 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/03/04/netpoll-release-v0.6.0/</guid><description>
&lt;h2 id="feature">Feature&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/306">#306&lt;/a>] feat: lazy init pollers to avoid create any poller goroutines if netpoll is not used&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/303">#303&lt;/a>] feat: add WithOnDisconnect callback&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/300">#300&lt;/a>] feat: netpoll exception implement net.Error interface&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/294">#294&lt;/a>] feat: add SetRunner option&lt;/li>
&lt;/ol>
&lt;h2 id="fix">Fix&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/307">#307&lt;/a>] fix: ctx race when disconnect callback run with connect callback&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/304">#304&lt;/a>] fix: connection leak when poller close connection but onRequest callback just finished&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/296">#296&lt;/a>] fix: stop timer when read triggered by err&lt;/li>
&lt;/ol>
&lt;h2 id="chore">Chore&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/302">#302&lt;/a>] ci: bump the version of actions/checkout and actions/setup-go&lt;/li>
&lt;/ol></description></item><item><title>Blog: Kitex Release v0.9.0</title><link>https://www.cloudwego.io/blog/2024/03/04/kitex-release-v0.9.0/</link><pubDate>Mon, 04 Mar 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/03/04/kitex-release-v0.9.0/</guid><description>
&lt;p>v0.9.0 provides two important features for Thrift: Thrift Streaming and Multi-Service. Multiple RC versions have been released for internal usage to collect feedback, so the final release version is delayed.&lt;/p>
&lt;p>Below are some important changes:&lt;/p>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="features">Features&lt;/h3>
&lt;p>&lt;strong>1. Thrift Streaming&lt;/strong>&lt;/p>
&lt;p>The Thrift Streaming feature based on gRPC (HTTP2) has been officially released. Users can use Thrift to define their own Streaming requests. To maintain compatibility with IDL parsing, Kitex chooses to use annotation to define stream method. See &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/thrift_streaming/">Thrift Streaming Usage&lt;/a>. This version also improves the monitoring and reporting of Streaming requests, which also applies to gRPC-Protobuf. Note that Thrift is mainly used for data serialization and does not use the Thrift message protocol.&lt;/p>
&lt;p>Due to the complexity of the HTTP2 protocol, it has a certain impact on performance. We plan to release a self-developed Streaming protocol to improve performance in the future.&lt;/p>
&lt;p>&lt;strong>2. Full Thrift MultiService support&lt;/strong>&lt;/p>
&lt;p>In the v0.8.0 version, Kitex supports gRPC multi-service to align gRPC, while Thrift previously provided &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/code-gen/combine_service/">Combine Service&lt;/a> as &amp;lsquo;Multi-Service&amp;rsquo; to ensure protocol compatibility. However, the use of this feature requires that the methods of different IDL services cannot be the same, and it is not real multi-Service.&lt;/p>
&lt;p>In this version, Kitex provides real multi-service functionality at the protocol level based on TTHeader, supporting the registration of multiple Thrift IDL Services in one server, while also being compatible with old CombineServices. See &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/advanced-feature/multi_service/">Multi-Service&lt;/a>.&lt;/p>
&lt;p>Note: Thrift Multi-Service requires the use of the TTHeader transport protocol.&lt;/p>
&lt;p>&lt;strong>3. Frugal&amp;rsquo;s experimental support for ARM64&lt;/strong>&lt;/p>
&lt;p>Supported the use of Frugal on ARM64 machines, temporarily supported by Fallback.&lt;/p>
&lt;p>&lt;strong>4. Server level context timeout&lt;/strong>&lt;/p>
&lt;p>Added server.WithEnableContextTimeout supports adding timeout to context at the server level. And in the new version, Kitex will default pass the client-side timeout in the TTHeader to server-side. Usage please see &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/service-governance/timeout/">Timeout&lt;/a>.&lt;/p>
&lt;p>Note: TTHeader transport protocol is required.&lt;/p>
&lt;p>&lt;strong>5. KitexProtobuf protocol supports JSON generic call&lt;/strong>&lt;/p>
&lt;p>The new version also provides the JSON generic call for KitexProtobuf (TTHeader is required). Please see &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/advanced-feature/generic-call/basic_usage/#jsonpbgeneric">JSONPbGeneric&lt;/a>.&lt;/p>
&lt;p>Note: TTHeader transport protocol is required.。&lt;/p>
&lt;p>&lt;strong>6. Adding a new LoadBalance policy&lt;/strong>&lt;/p>
&lt;p>Adding a new LoadBalance method of Alias Method to reduce the time complexity of random weight LoadBalance algorithm. Specified by &lt;code>client.WithLoadBalancer(loadbalance.NewWeightedRandomWithAliasMethodBalancer())&lt;/code>.&lt;/p>
&lt;h3 id="special-change">Special Change&lt;/h3>
&lt;p>Kitex v0.9.0 requires Go version must &amp;gt;= 1.17, no longer compatible with Go &amp;lt;= v1.16 (stability requirement must upgrade golang.org/x/library, which introduced Go version limit)&lt;/p>
&lt;h2 id="expand-the-ecosystem-of-config-center">&lt;strong>Expand the ecosystem of Config Center&lt;/strong>&lt;/h2>
&lt;blockquote>
&lt;p>Note that it is not related to v0.9.0 version, only synchronize the state of community expansion&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>Main configuration centers have finish integrated&lt;/strong>&lt;/p>
&lt;p>Kitex supports controlling the policies of Timeout, Retry, Circuit Breaker, Limiter through the remote configuration center. Thanks to the contributors of the CloudWeGo community, all the &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/third-party/config-center/">main configuration centers&lt;/a> have finish integrated. Usage please see &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/third-party/config-center/">Config Center&lt;/a>.&lt;/p>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h3 id="feature">Feature:&lt;/h3>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1208">#1208&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/1251">#1251&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/1230">#1230&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/1226">#1226&lt;/a>] feat: support thrift streaming (replacing the protobuf payload of GRPC/HTTP2 with thrift binary)&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1217">#1217&lt;/a>] feat: support thrift and pb multi service&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1268">#1268&lt;/a>] feat(thrift): support frugal fallback for arm&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/951">#951&lt;/a>] feat(bizerr): support returning biz status error for json/map generic server&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1199">#1199&lt;/a>] feat(loadbalance): add loadbalancer using Alias Method (#1184)&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1244">#1244&lt;/a>] feat(timeout): add option server.WithEnableContextTimeout to enable server timeout&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1228">#1228&lt;/a>] feat(streaming): Adding Recv/End events to streaming requests to improve trace information&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1062">#1062&lt;/a>] feat(generic): supports JSON and Map generic call for the KitexProtobuf protocol.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1225">#1225&lt;/a>] feat(timeout): support timeout transparent transmission by default when using TTHeader transport protocol&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1211">#1211&lt;/a>] feat(hessian2): support nested struct for hessian2 customized Exception&lt;/li>
&lt;/ol>
&lt;h3 id="optimize">Optimize:&lt;/h3>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1222">#1222&lt;/a>] optimize(frugal): enable frugal by default when the generated code is using slim template&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1209">#1209&lt;/a>] optimize: split encoder interface to customize meta and payload encoding implementation&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1206">#1206&lt;/a>] optimize(tool): add IsDir judge in readTemplate and add template register func&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1198">#1198&lt;/a>] optimize(kitexutil): add util api for getting real request and response&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1197">#1197&lt;/a>] optimize(kitexutil): add GetCallerIP util method in kitexutil to fetch Caller IP&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1195">#1195&lt;/a>] optimize(error): more specific instruction when panic in server handler&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1235">#1235&lt;/a>] optimize(tool): add IDLName field in PackageInfo for cwgo tool rendering&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1238">#1238&lt;/a>] optimize(bizerr): support biz status error for streaming mode&lt;/li>
&lt;/ol>
&lt;h3 id="fix">Fix:&lt;/h3>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1236">#1236&lt;/a>] fix(hessian2): correct code-ref behavior when thrift file is not in project dir&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1234">#1234&lt;/a>] fix(hessian2): still perform replacement on handler.go when -service is not specified for hessian2&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1232">#1232&lt;/a>] fix(gRPC): append &amp;ldquo;h2&amp;rdquo; to next proto in gRPC tlsConfig to enable protocol negotiation in TLS&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1215">#1215&lt;/a>] fix: bugfix for hessian2 tpl codegen&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1203">#1203&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/1205">#1205&lt;/a>] fix: fix the issue where disabling rpcinfo reuse on the server side does not take effect&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1227">#1227&lt;/a>] fix: idl-ref overwritten when using hessian2&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1194">#1194&lt;/a>] fix(retry): always set RespOp &amp;amp;&amp;amp; preventive panic to avoid dead loop&lt;/li>
&lt;/ol>
&lt;h3 id="chore--tests">Chore &amp;amp; Tests&lt;/h3>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1273">#1273&lt;/a>] chore: upgrade netpoll to v0.6.0&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1263">#1263&lt;/a>] chore: update sonic to v1.11.1&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1255">#1255&lt;/a>] chore: upgrade netpoll to v0.6.0 pre-release version&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1252">#1252&lt;/a>] chore: upgrade golang.org/x/net&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1254">#1254&lt;/a>] chore: upgrade sonic to v1.11.0 to support go1.22&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1231">#1231&lt;/a>] chore: frugal support go1.22&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1220">#1220&lt;/a>] test: correct the cachekey in the benchmark test of balancer&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1196">#1196&lt;/a>] test: add just biz handler message error&lt;/li>
&lt;/ol>
&lt;hr>
&lt;p>&lt;strong>Thanks a lot to those community contributors who submit some pull requests or share your ideas for this version:&lt;/strong>
@DMwangnima @jizhuozhi @NX-Official @jieqiboh @Lvnszn @Skyenought&lt;/p></description></item><item><title>Blog: Delving Deeper: Enriching Microservices with Golang with CloudWeGo</title><link>https://www.cloudwego.io/blog/2024/02/21/delving-deeper-enriching-microservices-with-golang-with-cloudwego/</link><pubDate>Wed, 21 Feb 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/02/21/delving-deeper-enriching-microservices-with-golang-with-cloudwego/</guid><description>
&lt;p>What if there existed an RPC framework that provided not only high performance and extensibility but also a robust suite of features and a thriving community support?&lt;/p>
&lt;p>CloudWeGo, a high-performance extensible Golang and Rust RPC framework originally developed and open-sourced by &lt;a href="https://opensource.bytedance.com">ByteDance&lt;/a>, has caught my eye as it fits the bill perfectly.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Delving_Deeper_Enriching_Microservices_with_Golang_and_Rust_with_CloudWeGo/1.jpeg" alt="Image">&lt;/p>
&lt;h2 id="cloudwego-vs-other-rpc-frameworks">CloudWeGo VS Other RPC Frameworks&lt;/h2>
&lt;p>While &lt;a href="https://grpc.io">gRPC&lt;/a> and &lt;a href="https://thrift.apache.org">Apache Thrift&lt;/a> have served the microservice architecture well, &lt;a href="https://www.cloudwego.io">CloudWeGo&lt;/a>&amp;rsquo;s advanced features and performance metrics set it apart as a promising open source solution for the future.&lt;/p>
&lt;p>Built for the modern development landscape by embracing both &lt;a href="https://go.dev">Golang&lt;/a> and &lt;a href="https://www.rust-lang.org">Rust&lt;/a>, CloudWeGo delivers advanced features and excellent performance metrics. As proof of its performance, benchmark tests have shown that &lt;a href="https://github.com/cloudwego/kitex-benchmark">Kitex surpasses gRPC by over 4 times in terms of QPS and latency, with a throughput increased by 51% - 70%&lt;/a> in terms of QPS (Queries Per Second) and latency.&lt;/p>
&lt;p>This equips developers with a tool that doesn&amp;rsquo;t just meet but decidedly surpasses the performance requirements of modern microservices. Let&amp;rsquo;s delve into some specific use cases to understand CloudWeGo&amp;rsquo;s potential.&lt;/p>
&lt;h3 id="bookinfo-a-tale-of-traffic-handling">Bookinfo: A Tale of Traffic Handling&lt;/h3>
&lt;p>Consider the case of Bookinfo, a sample application provided by &lt;a href="https://istio.io">Istio&lt;/a>, rewritten using CloudWeGo&amp;rsquo;s &lt;a href="https://www.cloudwego.io/docs/kitex/">Kitex&lt;/a> for superior performance and extensibility.&lt;/p>
&lt;p>This use case is illustrative of how traffic-heavy services can significantly benefit from CloudWeGo&amp;rsquo;s performance promise. This integration also demonstrates how CloudWeGo stands above traditional Istio service mesh when it comes to traffic handling and performance.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Delving_Deeper_Enriching_Microservices_with_Golang_and_Rust_with_CloudWeGo/2.jpeg" alt="Image">&lt;/p>
&lt;p>With Kitex and &lt;a href="https://www.cloudwego.io/docs/hertz/">Hertz&lt;/a> handling traffic redirection, the Bookinfo project can manage high traffic volumes efficiently, ensuring swift responses and a better user experience.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/kitex/server&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">svr&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">echo&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewServer&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87">new&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">EchoImpl&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span> &lt;span style="color:#000">server&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">WithName&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;echo&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">listener&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">_&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">net&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Listen&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;tcp&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;:8888&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">svr&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Serve&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">listener&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The above code snippet is a simplified example of how the Bookinfo project can be rewritten using Kitex for better performance.&lt;/p>
&lt;h3 id="easy-note-the-magic-of-simplicity">Easy Note: The Magic of Simplicity&lt;/h3>
&lt;p>CloudWeGo&amp;rsquo;s commitment to simplifying complex tasks shines in its application to the Easy Note project. It leverages CloudWeGo to implement a full-process traffic lane. The note-taking platform needs to be responsive and efficient, a need fulfilled by CloudWeGo&amp;rsquo;s high-performance networking library, &lt;a href="https://www.cloudwego.io/docs/netpoll/">Netpoll&lt;/a>.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Delving_Deeper_Enriching_Microservices_with_Golang_and_Rust_with_CloudWeGo/3.jpeg" alt="Image">&lt;/p>
&lt;p>The integration of CloudWeGo has elevated the Easy Note application to compete effectively with other note-taking platforms, proving how simplicity can indeed lead to power.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/kitex/server&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">RPCService&lt;/span> &lt;span style="color:#204a87;font-weight:bold">struct&lt;/span>&lt;span style="color:#000;font-weight:bold">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">s&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">RPCService&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000">Handle&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">req&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">error&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">resp&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#000">Message&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Echo &amp;#34;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span> &lt;span style="color:#000">req&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Message&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">resp&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">rpcHandler&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">RPCService&lt;/span>&lt;span style="color:#000;font-weight:bold">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">svr&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">server&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewServer&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">rpcHandler&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">listener&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">_&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">net&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Listen&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;tcp&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;:8888&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">svr&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Serve&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">listener&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The snippet above gives a glimpse of how CloudWeGo helps to enhance the efficiency of the Easy Note application.&lt;/p>
&lt;h3 id="book-shop-e-commerce-made-easy">Book Shop: E-Commerce Made Easy&lt;/h3>
&lt;p>In the bustling e-commerce landscape, Book Shop stands as a testament to CloudWeGo&amp;rsquo;s capacity for seamless integration. Integrating middleware like &lt;a href="https://www.elastic.co/elasticsearch">Elasticsearch&lt;/a> and &lt;a href="https://redis.io">Redis&lt;/a> into a Kitex project to build a solid e-commerce system that rivals more complex platforms.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Delving_Deeper_Enriching_Microservices_with_Golang_and_Rust_with_CloudWeGo/4.jpeg" alt="Image">&lt;/p>
&lt;p>CloudWeGo&amp;rsquo;s ability to effectively integrate with popular technologies like Elasticsearch and Redis ensures that businesses need not compromise on choosing an open-source RPC framework.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/kitex/server&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">ItemService&lt;/span> &lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000;font-weight:bold">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">s&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">ItemService&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000">AddItem&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">item&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">Item&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">error&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Add to Elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Add to Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Return error if any&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#204a87;font-weight:bold">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">itemHandler&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">ItemService&lt;/span>&lt;span style="color:#000;font-weight:bold">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">svr&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">server&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewServer&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">itemHandler&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">listener&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">_&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">net&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Listen&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;tcp&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;:8888&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">svr&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Serve&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">listener&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The above snippet is a basic representation of how the Book Shop e-commerce system operates with CloudWeGo, Elasticsearch, and Redis.&lt;/p>
&lt;h3 id="freecar-driving-innovation">FreeCar: Driving Innovation&lt;/h3>
&lt;p>The FreeCar project is an excellent illustration of how CloudWeGo can revamp the operations in a time-sharing car rental system, posing a strong alternative to existing ride-hailing applications.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Delving_Deeper_Enriching_Microservices_with_Golang_and_Rust_with_CloudWeGo/5.jpeg" alt="Image">&lt;/p>
&lt;p>This real-world implementation demonstrates how CloudWeGo&amp;rsquo;s robust features can optimize operations, fostering efficiency and scalability in industries beyond tech.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/kitex/server&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">CarService&lt;/span> &lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000;font-weight:bold">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">s&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">CarService&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000">BookRide&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">rideRequest&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">RideRequest&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">RideConfirmation&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">error&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Business logic to handle ride booking&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Return confirmation or error&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#204a87;font-weight:bold">nil&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">rideHandler&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">CarService&lt;/span>&lt;span style="color:#000;font-weight:bold">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">svr&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">server&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewServer&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">rideHandler&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">listener&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">_&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">net&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Listen&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;tcp&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;:8888&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">svr&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Serve&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">listener&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The above snippet is a simplified representation of how FreeCar utilizes CloudWeGo.&lt;/p>
&lt;h2 id="what-draws-me-to-cloudwego">What Draws Me to CloudWeGo?&lt;/h2>
&lt;p>As I venture further into the landscape of alternative RPC frameworks, and explore the CloudWeGo project, several factors stand out:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Performance&lt;/strong>: In the world of microservices, performance could mean the difference between success and failure. CloudWeGo shines when it comes to performance, with QPS and latency scores that leave other RPC frameworks trailing.&lt;/li>
&lt;li>&lt;strong>Extensibility&lt;/strong>: As a developer, what you&amp;rsquo;ll appreciate most about Kitex is its promise of extensibility, allowing projects to swiftly adapt to growing demands and complexities.&lt;/li>
&lt;li>&lt;strong>Robustness&lt;/strong>: The rich feature set of CloudWeGo, including support for multiple message protocols, transport protocols, load balancing, circuit breakers, and rate limiting, offers an all-inclusive solution for designing and managing microservices.&lt;/li>
&lt;li>&lt;strong>Community Support&lt;/strong>: The fact that CloudWeGo is backed by ByteDance assures me of strong community support. The wealth of resources and discussions available can solve common issues and support continuous learning.&lt;/li>
&lt;li>&lt;strong>Real-world Applications&lt;/strong>: Practical applications in diverse projects demonstrate CloudWeGo’s versatility and scalability, affirming my trust in its effectiveness.&lt;/li>
&lt;/ul>
&lt;h1 id="embracing-the-future-of-microservices">Embracing the Future of Microservices&lt;/h1>
&lt;p>With each use case, CloudWeGo&amp;rsquo;s potential becomes increasingly clear. Developers can now build high-performing, extensible, and robust applications, harnessing the true essence of microservices - no matter if they prefer working with Golang or Rust.&lt;/p>
&lt;p>If you&amp;rsquo;re considering a new tool for your microservice architecture, especially if you are interested in Rust, &lt;a href="https://www.cloudwego.io/docs/">give CloudWeGo a try&lt;/a>. The future of microservices awaits you.&lt;/p></description></item><item><title>Blog: Enhancing Performance in Microservice Architecture with Kitex</title><link>https://www.cloudwego.io/blog/2024/01/29/enhancing-performance-in-microservice-architecture-with-kitex/</link><pubDate>Mon, 29 Jan 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/01/29/enhancing-performance-in-microservice-architecture-with-kitex/</guid><description>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/1.jpeg" alt="Image">&lt;/p>
&lt;h1 id="kitex-enhancing-performance-in-microservice-architecture">Kitex: Enhancing Performance in Microservice Architecture&lt;/h1>
&lt;h2 id="introduction">Introduction&lt;/h2>
&lt;p>The team at ByteDance initiated the creation of the Remote Procedure Call (RPC) framework, Kitex, alongside several related fundamental libraries in 2019. This endeavor originated from confronting functionality and performance challenges within our extensive microservice architecture. We also wanted to combine the knowledge and insights gathered from previous frameworks. This development project was officially released for open-source contribution on GitHub in 2021.&lt;/p>
&lt;p>From 2019 to 2023, our internal microservices have seen substantial growth. During this period, &lt;a href="https://www.cloudwego.io/docs/kitex/overview/">the Kitex framework&lt;/a> has undergone numerous cycles of optimization and testing to enhance its performance and efficiency. In this article, we share performance optimization techniques that we&amp;rsquo;ve systematically implemented over the past few years.&lt;/p>
&lt;h2 id="the-evolution-and-status-quo-of-kitex">The Evolution and Status Quo of Kitex&lt;/h2>
&lt;h3 id="understanding-the-need-for-an-rpc-framework">Understanding the Need for an RPC Framework&lt;/h3>
&lt;p>Although the Remote Procedure Call (RPC) framework has a long history, its wide-scale use as a crucial component aligns with the advent of microservice architecture. Therefore, it&amp;rsquo;s vital to revisit its historical developments and comprehend why an RPC framework is necessary.&lt;/p>
&lt;h4 id="background-monolithic-architecture-era">Background: Monolithic Architecture Era&lt;/h4>
&lt;p>In this era, system services exhibited the following features:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Distinct business logic was categorized via functions.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The performance pressure was on the database, prompting the evolution from manually distributed databases to an automated distributed structure.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>A typical business coding model during this period looked something like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Go" data-lang="Go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">BuySomething&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">userId&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">itemId&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">user&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">GetUser&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">userId&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">sth&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">GetItem&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">itemId&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">GetUser&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">userId&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">db&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">users&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">GetUser&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">userId&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">GetItem&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">itemId&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">db&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">items&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">GetItem&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">itemId&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/2.jpeg" alt="Image">&lt;/p>
&lt;p>This style of coding is straightforward, especially once built on top of a well-structured design pattern, can make it straightforward to refactor and write unit tests. Many IT systems still operate using this architecture.&lt;/p>
&lt;p>However, as online businesses rapidly developed, we encountered the following limitations in some of the larger internet projects:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>There&amp;rsquo;s a limit to computational power: the maximum computing power of a single request is less than or equal to the total computational power of a single server divided by the number of requests processed simultaneously.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>There&amp;rsquo;s a constraint around developmental efficiency: the growth of the code repository, team size, and code complexity do not have a linear relationship. This makes maintenance incrementally more challenging as the business grows, resulting in a more complicated online implementations.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="the-shift-microservice-architecture-era">The Shift: Microservice Architecture Era&lt;/h4>
&lt;p>To overcome the issues inherent in the monolithic architecture, the IT community embarked on a journey into the era of microservice architecture. Here&amp;rsquo;s an example of typical code used in a microservice architecture:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Go" data-lang="Go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">BuySomething&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">userId&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">itemId&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">user&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">client&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">GetUser&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">userId&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// RPC call&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">sth&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">client&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">GetItem&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">itemId&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// RPC call&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/3.jpeg" alt="Image">&lt;/p>
&lt;p>RPCs (Remote Procedure Call) allows business systems to call remote services as though invoking local methods. This reduces the complexity of understanding business operations to its most fundamental form and minimizes changes in business coding habits during the transition from a monolithic architecture to a microservice architecture.&lt;/p>
&lt;h2 id="the-cost-and-path-of-optimizing-rpc-performance">The Cost and Path of Optimizing RPC Performance&lt;/h2>
&lt;p>Before the introduction of RPC, the sole overhead in the following code is merely a function call, an operation at the nanosecond level, not accounting for inline optimization.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Go" data-lang="Go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">client&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">response&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">response&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#000">server&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">request&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// function call&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">server&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">request&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">response&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">response&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Message&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#000">request&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Message&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Upon transitioning to an RPC call, the overhead directly elevates to the millisecond level, a latency difference of 10^6, which highlights the high cost of RPC and indicates considerable room for optimization.&lt;/p>
&lt;pre tabindex="0">&lt;code>func client() (response) {
response = client.RPCCall(request) // rpc call - network
}
func server(request) (response) {
response.Message = request.Message
}
&lt;/code>&lt;/pre>&lt;p>The complete process of an RPC call is outlined below, and we will elaborate on our performance optimization practices for each step in the sections to follow.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/4.jpeg" alt="Image">&lt;/p>
&lt;h2 id="why-develop-our-custom-rpc-framework">Why Develop Our Custom RPC Framework?&lt;/h2>
&lt;p>Before delving into performance practices, let&amp;rsquo;s talk about why we opted to develop a new RPC framework. There are numerous existing frameworks available, so why did we need a new one? Some of the primary reasons include:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Internally at our company, we primarily use the Thrift protocol for communication. Most mainstream Go frameworks do not support the Thrift protocol, and extending to support multiple protocols isn&amp;rsquo;t a straightforward task.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Recognizing our company&amp;rsquo;s extremely high performance requirements, we realized that deep optimization across the entire operation chain was essential. The vast scale and complexity of our microservices demanded a bespoke, highly customizable, and scalable framework that could provide such flexibility and meet our rigorous performance standards.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h1 id="how-does-kitex-compare-to-other-frameworks">How Does Kitex Compare to Other Frameworks?&lt;/h1>
&lt;p>Kitex supports both the Thrift and gRPC protocols. Considering the lack of Thrift-compatible frameworks in the Go ecosystem, we used the gRPC protocol for our comparative study with the grpc-go framework. Check out the results:&lt;/p>
&lt;p>&lt;strong>gRPC Unary Comparison:&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/5.jpeg" alt="Image">&lt;/p>
&lt;p>&lt;strong>gRPC Streaming Comparison:&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/6.jpeg" alt="Image">&lt;/p>
&lt;h1 id="performance-optimization-practices-within-the-kitex-framework">Performance Optimization Practices within the Kitex Framework&lt;/h1>
&lt;p>Many performance optimization strategies used in Kitex aren&amp;rsquo;t exclusive to Go; however, for the sake of convenience, we&amp;rsquo;re using Go in our examples. In the following sections, we&amp;rsquo;ll introduce different performance optimization practices applied in Kitex, following the process of a RPC call.&lt;/p>
&lt;h2 id="optimizing-encoding-and-decoding">Optimizing Encoding and Decoding&lt;/h2>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/7.jpeg" alt="Image">&lt;/p>
&lt;h3 id="common-challenges-with-encoding-and-decoding">Common Challenges with Encoding and Decoding&lt;/h3>
&lt;p>Using Protobuf as an example, we encounter the following problems associated with encoding decoding operations:&lt;/p>
&lt;p>&lt;strong>Computational Overhead:&lt;/strong>&lt;/p>
&lt;p>a. Additional information needs to be retrieved through runtime reflection.&lt;/p>
&lt;p>b. There&amp;rsquo;s a need to invoke multiple functions and create several small objects, which adds to the processing overhead.&lt;/p>
&lt;p>&lt;strong>Garbage Collection (GC) Overhead:&lt;/strong>&lt;/p>
&lt;p>Memory reuse is a significant challenge, which often leads to the overhead of garbage collection operations during the encoding and decoding operations.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/8.jpeg" alt="Image">&lt;/p>
&lt;h3 id="code-generation-optimization-introducing-fastthrift--fastpb">Code Generation Optimization: Introducing FastThrift &amp;amp; FastPB&lt;/h3>
&lt;p>We&amp;rsquo;ve introduced encoding and decoding capabilities to Kitex by generating a large volume of code for both Thrift and Protobuf protocols. Since generated code can optimize preset runtime information, we can avoid additional operations during runtime and achieve several benefits.&lt;/p>
&lt;p>&lt;strong>Memory Reuse and Size Pre-calculation&lt;/strong>&lt;/p>
&lt;p>During serialization, we can invoke &lt;code>Size()&lt;/code> at a minimal cost and use it to pre-allocate a fixed-size memory block.&lt;/p>
&lt;p>Go code example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Go" data-lang="Go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">User&lt;/span> &lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Id&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Name&lt;/span> &lt;span style="color:#204a87;font-weight:bold">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">x&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">User&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000">Size&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">n&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">n&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+=&lt;/span> &lt;span style="color:#000">x&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">sizeField1&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">n&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+=&lt;/span> &lt;span style="color:#000">x&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">sizeField2&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">n&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// Framework Process&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">size&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Size&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">data&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#000">Malloc&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">size&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// allocate memory&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">Encode&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">user&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">data&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// encoding user object directly into the allocated memory to save one time of copy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">Send&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">data&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// send data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">Free&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">data&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// reuse the allocated memory at next Malloc&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Minimize Function Calls and Object Creation&lt;/strong>&lt;/p>
&lt;p>Reducing the costs of invoking functions and creating small objects can yield significant benefits. This approach is especially beneficial in a language like Go, which heavily utilizes garbage collection (GC).&lt;/p>
&lt;p>As depicted below, the underlying fastWriteField function gets inlined during compile-time. As a result, the serialization FastWrite function essentially conducts sequential writing into a fixed piece of memory. A similar approach applies to FastRead.&lt;/p>
&lt;p>Go code example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Go" data-lang="Go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">x&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">User&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000">FastWrite&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">buf&lt;/span> &lt;span style="color:#000;font-weight:bold">[]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">byte&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">offset&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">offset&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+=&lt;/span> &lt;span style="color:#000">x&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fastWriteField1&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">buf&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#000">offset&lt;/span>&lt;span style="color:#000;font-weight:bold">:])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">offset&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+=&lt;/span> &lt;span style="color:#000">x&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fastWriteField2&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">buf&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#000">offset&lt;/span>&lt;span style="color:#000;font-weight:bold">:])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">offset&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// inline&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">x&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">User&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000">fastWriteField1&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">buf&lt;/span> &lt;span style="color:#000;font-weight:bold">[]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">byte&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">offset&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">offset&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+=&lt;/span> &lt;span style="color:#000">fastpb&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">WriteInt32&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">buf&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#000">offset&lt;/span>&lt;span style="color:#000;font-weight:bold">:],&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">x&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Id&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">offset&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// inline&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">x&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">User&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000">fastWriteField2&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">buf&lt;/span> &lt;span style="color:#000;font-weight:bold">[]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">byte&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">offset&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">offset&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+=&lt;/span> &lt;span style="color:#000">fastpb&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">WriteString&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">buf&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#000">offset&lt;/span>&lt;span style="color:#000;font-weight:bold">:],&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">x&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Name&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">offset&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="optimization-results">Optimization Results&lt;/h3>
&lt;p>As a result of these optimizations, we managed to improve the optimization output from the previous contribution of 3.58% to a notable 0.98%.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/9.jpeg" alt="Image">&lt;/p>
&lt;h2 id="jit-substitution-for-code-generation-introducing-frugal-thrift">JIT Substitution for Code Generation: Introducing Frugal (Thrift)&lt;/h2>
&lt;p>After reaping gains from the hardcoded approach, we encountered the following feedback:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>The volume of the generated code increases linearly with the growth of fields.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The generated code depends on the user&amp;rsquo;s version of their respective Kitex command-line tool, which can lead to conflicts during collaborations with multiple contributors.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>The feedback encouraged us to consider if the previously generated code could be created automatically at runtime. The answer is &amp;lsquo;yes&amp;rsquo; - but it would require the adoption of Just-In-Time Compilation (JIT) as a method of code optimization.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/10.jpeg" alt="Image">&lt;/p>
&lt;h3 id="advantages-of-jit">Advantages of JIT&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>Registers utilization and deeper inlining: this improves the efficiency of function calls.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Core computational functions use fully optimized assembly code, which leads to improved performance.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="optimization-results-of-jit">Optimization Results of JIT&lt;/h3>
&lt;p>As a result of JIT optimization, we improved the optimization result from 3.58% to an impressive 0.78%.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/11.jpeg" alt="Image">&lt;/p>
&lt;h3 id="comparing-frugal-and-apache-thrift">Comparing Frugal and Apache Thrift&lt;/h3>
&lt;p>This section presents a performance comparison of Frugal and Apache Thrift in the context of encoding and decoding.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/12.jpeg" alt="Image">&lt;/p>
&lt;h2 id="optimizing-network-library">Optimizing Network Library&lt;/h2>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/13.jpeg" alt="Image">&lt;/p>
&lt;h3 id="native-go-net-challenges-in-rpc-scenarios">Native Go Net Challenges in RPC Scenarios&lt;/h3>
&lt;p>Native Go Net in RPC situations presents the following challenges:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Each connection corresponds to one coroutine - when there are numerous upstream and downstream instances, the sheer number of Goroutines can significantly influence performance. This is particularly detrimental for businesses with intensive instances.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>It is unable to automatically detect the connection&amp;rsquo;s shutdown state.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>When a struct undergoes NoCopy serialization, the output typically takes the form of a two-dimensional byte array. However, Go&amp;rsquo;s &lt;code>Write([]byte)&lt;/code> interface falls short as it does not support handling non-continuous memory data.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Despite being highly compatible, it&amp;rsquo;s provided by Go Runtime and not conducive or suitable for adding new features.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/14.jpeg" alt="Image">&lt;/p>
&lt;h4 id="go-coding-example">Go Coding Example&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Go" data-lang="Go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">name&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Steve Jobs&amp;#34;&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// 0xc000000020&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">req&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#000">Id&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87">int32&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span> &lt;span style="color:#000">Name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000">name&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// Encode to [][]byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">4&lt;/span> &lt;span style="color:#000">bytes&lt;/span>&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">10&lt;/span> &lt;span style="color:#000">bytes&lt;/span>&lt;span style="color:#000;font-weight:bold">],&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// no-copy encoding, 0xc000000020&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// Copy to []byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">buf&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">4&lt;/span> &lt;span style="color:#000">bytes&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">10&lt;/span> &lt;span style="color:#000">bytes&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// new address&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// Write([]byte)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">net&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Conn&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Write&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">buf&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="netpoll-optimization-practices">Netpoll Optimization Practices&lt;/h3>
&lt;p>Here are the main areas we focused on for optimization:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>Coroutine Optimization&lt;/strong>: As much as possible, coroutines are reused and the number of connections aren&amp;rsquo;t tied to the number of coroutines.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Buffer Layer&lt;/strong>: Netpoll supports zero-copy read and write, and it reuses memory to minimize GC overhead during encoding and decoding.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Customization for RPC Small Packets High Concurrency Scenarios&lt;/strong>: Includes coroutine scheduling optimization, TCP parameter tuning, and more.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Deep Customization for Internal Environments&lt;/strong>: Includes modifying the Go Runtime to improve scheduling priority and kernel support for batch system calls, among other things.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/15.jpeg" alt="Image">&lt;/p>
&lt;h2 id="communication-layer-optimization">Communication Layer Optimization&lt;/h2>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/16.jpeg" alt="Image">&lt;/p>
&lt;h3 id="intra-machine-communication-optimization-issues-with-communication-efficiency-under-service-mesh">Intra-Machine Communication Optimization: Issues with Communication Efficiency under Service Mesh&lt;/h3>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/17.jpeg" alt="Image">&lt;/p>
&lt;p>After introducing Service Mesh, the business process primarily communicates with another sidecar process on the same machine, which brings in an additional layer of delay.&lt;/p>
&lt;p>Traditional Service Mesh solutions commonly hijack iptables to facilitate traffic forwarding to the sidecar process. This could lead to substantial performance loss at all levels. Kitex has carried out several performance optimization attempts at the communication layer and has finally developed a systematic solution.&lt;/p>
&lt;h1 id="optimization-of-intra-machine-communication-uds-replaces-tcp">Optimization of Intra-machine Communication: UDS Replaces TCP&lt;/h1>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/18.jpeg" alt="Image">&lt;/p>
&lt;h2 id="performance-comparison-between-uds-and-tcp">Performance Comparison between UDS and TCP:&lt;/h2>
&lt;pre tabindex="0">&lt;code>======== IPC Benchmark - TCP ========
Type Conns Size Avg P50 P99
Client 10 4096 127μs 76μs 232μs
Client-R 10 4096 2μs 1μs 1μs
Client-W 10 4096 9μs 4μs 7μs
Server 10 4096 24μs 13μs 18μs
Server-R 10 4096 1μs 1μs 1μs
Server-W 10 4096 7μs 4μs 7μs
======== IPC Benchmark - UDS ========
Type Conns Size Avg P50 P99
Client 10 4096 118μs 75μs 205μs
Client-R 10 4096 3μs 2μs 3μs
Client-W 10 4096 4μs 1μs 2μs
Server 10 4096 24μs 11μs 16μs
Server-R 10 4096 4μs 2μs 3μs
Server-W 10 4096 3μs 1μs 2μs
&lt;/code>&lt;/pre>&lt;p>Our performance test indicates the following:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>UDS outperforms TCP in all measurements.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Nonetheless, the extent of improvement is not significant.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h1 id="optimization-of-intra-machine-communication-shmipc-replaces-uds">Optimization of Intra-Machine Communication: ShmIPC Replaces UDS&lt;/h1>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/19.jpeg" alt="Image">&lt;/p>
&lt;p>In pursuit of enhancing the efficiency of inter-process communication, we developed a communication mode based on shared memory. Shared memory communication throws in the complexity of managing the synchronization of various communication states across different processes.&lt;/p>
&lt;p>To tackle this, we utilized our communication protocol and retained &lt;strong>UDS&lt;/strong> as the event notification channel (IO Queue) and shared memory as the data transmission channel (Buffer).&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/20.jpeg" alt="Image">&lt;/p>
&lt;p>For a detailed technical understanding of shmipc, you can refer to our previously published article: &lt;a href="https://www.cloudwego.io/blog/2023/04/04/introducing-shmipc-a-high-performance-inter-process-communication-library/">Introducing Shmipc: A High Performance Inter-process Communication Library&lt;/a>.&lt;/p>
&lt;h2 id="performance-test">Performance Test:&lt;/h2>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/21.jpeg" alt="Image">&lt;/p>
&lt;h1 id="from-cross-machine-to-intra-machine-communication-a-pod-affinity-solution">From Cross-Machine to Intra-Machine Communication: A Pod Affinity Solution&lt;/h1>
&lt;p>Having previously optimized intra-machine communication, we found that it&amp;rsquo;s limited to the data plane communication between the service process and the Service Mesh.&lt;/p>
&lt;p>The peer service is possibly not hosted on the same machine. So, the question arises, how can we optimize cross-machine communication? One innovative approach we&amp;rsquo;re considering is converting cross-machine issues into intra-machine issues.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/22.jpeg" alt="Image">&lt;/p>
&lt;p>Achieving this in large-scale microservice communication calls for the cooperation of multiple architectural components. As such, we introduced the pod affinity solution to resolve this challenge:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Container Scheduling Layer Alteration: The container scheduling system will consider the relationship and instance situations of upstream and downstream services. It uses affinity scheduling to, as much as possible, assign the instances of upstream and downstream services to the same physical machine.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Traffic Scheduling Layer Alteration: The service control plane needs to identify which downstreams are connected to a certain upstream container. Bearing in mind the context of global load balancing, it calculates the dynamic weight of accessing downstream instances for each downstream instance, aiming to enable more traffic to facilitate intra-machine communication.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Framework Transformation: Extend custom support for the unique communication method of pod affinity. Based on the calculation results of the traffic scheduling layer, the request is dispatched to either the same machine instance or Mesh Proxy.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/23.jpeg" alt="Image">&lt;/p>
&lt;h1 id="microservice-online-tuning-practices">Microservice Online Tuning Practices&lt;/h1>
&lt;p>Apart from performance optimization at the framework level, the business logic itself is a significant contributor to the performance bottleneck. To combat this, we have accumulated several practical experiences and strategies.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/24.jpeg" alt="Image">&lt;/p>
&lt;h1 id="solving-latency-through-automated-gc-optimization">Solving Latency Through Automated GC Optimization&lt;/h1>
&lt;h2 id="challenges-with-gos-native-gc-strategy">Challenges with Go&amp;rsquo;s Native GC Strategy&lt;/h2>
&lt;p>Go&amp;rsquo;s Garbage Collection (GC) strategy was not specifically designed for microservice scenarios, and thus does not prioritize optimizing latency-sensitive businesses. However, RPC services often require low P99 latency.&lt;/p>
&lt;p>The essential principles of Go&amp;rsquo;s GC strategy are as follows:&lt;/p>
&lt;h3 id="gogc-principle">GOGC Principle:&lt;/h3>
&lt;p>The GOGC parameter sets a percentile value, defaulting to 100, to calculate the heap size required for the next GC trigger: &lt;code>NextGC = HeapSize + HeapSize * (GOGC / 100)&lt;/code>. This implies that under default settings, the heap size doubles after the last GC.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/25.jpeg" alt="Image">&lt;/p>
&lt;p>As an example, if a service&amp;rsquo;s active memory usage is 100MB, the GC is triggered every time the heap grows to 200MB, which may be unnecessary if this service has 4GB of memory.&lt;/p>
&lt;p>&lt;strong>Drawbacks:&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>In microservice environments, the service&amp;rsquo;s memory utilization rate is generally quite low, yet aggressive GC persists.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>For RPC scenarios, a sizable number of objects are inherently highly reusable. Performing frequent GC on these reusable objects degrades the reusability rate.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/26.jpeg" alt="Image">&lt;/p>
&lt;p>&lt;strong>Primary Requirement:&lt;/strong>&lt;/p>
&lt;p>Decrease the frequency of GC and enhance the reuse rate of resources in microservices, while maintaining safe levels of memory consumption.&lt;/p>
&lt;h2 id="gctuner-automated-gc-optimization-strategy">gctuner: Automated GC Optimization Strategy&lt;/h2>
&lt;p>Users can manipulate the desired aggressiveness of GC by setting a threshold, which could for example be set to &lt;code>memory_limit * 0.7&lt;/code>. If the memory used is below this value, GCPercent is maximized as much as possible.&lt;/p>
&lt;ul>
&lt;li>If memory utilization doesn&amp;rsquo;t reach the set threshold, the GOGC parameter is set to a larger value, whereas if it exceeds the limit, it is set to a smaller value.&lt;/li>
&lt;li>Regardless of the situation, GOGC is capped at a minimum of 50 and a maximum of 500.&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Advantages:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>GC is delayed when memory utilization is low.&lt;/li>
&lt;li>It reverts to the native GC strategy when memory utilization is high.&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Cautions:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>If other processes share the memory resources, ensuring a reserve of memory resources for these different processes is crucial.&lt;/li>
&lt;li>Services in which memory is likely to have excessively extreme peak values might not find this strategy beneficial.&lt;/li>
&lt;/ul>
&lt;p>gctuner is currently open-sourced &lt;a href="https://github.com/bytedance/gopkg/tree/develop/util/gctuner">on GitHub&lt;/a>.&lt;/p>
&lt;h1 id="concurrent-optimization">Concurrent Optimization&lt;/h1>
&lt;h2 id="what-is-the-real-cpu-utilization---the-container-deception">What Is the Real CPU Utilization? - The Container Deception&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pod&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">containers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">resources&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">limits&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">cpu&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;4&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The rapid advancement of container technology has largely affected the development of microservices. Currently, the majority of microservices, including numerous databases across the industry, operate within container environments. For the purpose of this discussion, we&amp;rsquo;ll only touch upon mainstream containers based on cgroup technology.&lt;/p>
&lt;p>A standard business development model involves developers acquiring a 4-core CPU container on the container platform. Developers usually assume that their program can utilize up to 4 CPUs simultaneously, and adjust their program configuration based on this understanding.&lt;/p>
&lt;p>Upon deployment, if you check upon the container and verify with the &amp;rsquo;top&amp;rsquo; command, all indicators seemingly adhere to the 4-core standard:&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/27.jpeg" alt="Image">&lt;/p>
&lt;p>Even when using &lt;code>cat /proc/cpuinfo&lt;/code> for inspection, you&amp;rsquo;ll witness exactly 4 CPUs.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">processor&lt;/span> &lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// ...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">processor&lt;/span> &lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// ...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">processor&lt;/span> &lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// ...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">processor&lt;/span> &lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// ...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>However, these are merely illusions concocted by the container to ease your mental load off programming. The underlying reason for creating such an illusion is to ensure traditional Linux Debug tools function seamlessly within the container environment.&lt;/p>
&lt;p>Contrarily, container technology based on cgroups imposes limits only on &lt;strong>CPU time&lt;/strong>, not on the number of CPUs. Suppose you log into the machine to verify the CPU number each thread of the process is using. In that case, you might be taken aback to discover that the sum exceeds the CPU limit set for the container:&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/28.jpeg" alt="Image">&lt;/p>
&lt;p>When a container requests 4 CPU units, it means it can run for an equivalent of 4 CPU time within a computation cycle (typically 100ms). It doesn&amp;rsquo;t imply that it can only use 4 physical CPUs, nor that at least 4 CPUs can be simultaneously utilized by the program. If the usage time surpasses the CPU limit set for the container, all processes within the container are paused until the end of the computation period. This could lead to the program experiencing lagging issues (throttled).&lt;/p>
&lt;h2 id="is-faster-downstream-parallel-processing-always-better---concurrency-vs-timeout">Is Faster Downstream Parallel Processing Always Better? - Concurrency vs. Timeout&lt;/h2>
&lt;p>Knowing the upper bound for physical parallel computing in a program is considerably high, we can leverage this insight to increase or decrease the number of working threads (GOMAXPROCS) or adjust the degree of concurrency within the program.&lt;/p>
&lt;p>Let&amp;rsquo;s consider a calling scenario where the business sends requests to the same upstream with four concurrent processes. Each request upstream requires 50ms of processing time. Based on this, the downstream sets the timeout time to &lt;strong>100ms&lt;/strong>.&lt;/p>
&lt;p>Though this seems reasonable, if, at that time, the upstream had only two CPUs available to handle requests (which also have to manage other work or perform Garbage Collection activities), the third RPC request would likely time out.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/29.jpeg" alt="Image">&lt;/p>
&lt;p>However, simply reducing concurrency isn&amp;rsquo;t always the solution and it doesn&amp;rsquo;t benefit all cases.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/30.jpeg" alt="Image">&lt;/p>
&lt;p>If upstream&amp;rsquo;s computational resources are abundantly available, increasing concurrency could efficiently utilize the processing power upstream.&lt;/p>
&lt;h2 id="balancing-resource-utilization--reserving-computational-capacity-for-other-processes">Balancing Resource Utilization – Reserving Computational Capacity for Other Processes&lt;/h2>
&lt;p>If there are multiple processes within the container, it&amp;rsquo;s essential to reserve resources for these operations. This consideration is particularly crucial in scenarios like the deployment of a Service Mesh data plane, where the same container operates as a sidecar.&lt;/p>
&lt;p>If a downstream process utilizes the entirety of the time slice allocated within a computation cycle, it&amp;rsquo;s highly probable that it&amp;rsquo;ll face resource throttling when it&amp;rsquo;s the upstream process&amp;rsquo;s turn, which could subsequently affect the service’s latency.&lt;/p>
&lt;h2 id="optimizing-service-concurrency-degree">Optimizing Service Concurrency Degree&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Adjust the Number of Work Threads&lt;/strong>: For instance, the &lt;code>GOMAXPROCS&lt;/code> directive in Go allows us to modify the number of working threads.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Alter the Concurrency of Requests in the Code&lt;/strong>: It&amp;rsquo;s essential for businesses to iteratively test and evaluate the trade-off between the latency gains from increasing concurrency and the stability loss at peak levels to determine an optimal concurrency value.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Use Batch Interfaces&lt;/strong>: If the business scenario allows, replacing the current interface with a batch interface could be a more effective strategy.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h1 id="looking-into-the-future-of-optimization">Looking into the Future of Optimization&lt;/h1>
&lt;h2 id="the-final-frontier-kernel">The Final Frontier: Kernel&lt;/h2>
&lt;p>Currently the only area we haven&amp;rsquo;t explored for optimization is the Kernel.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Enhancing_Performance_in_Microservice_Architecture_with_Kitex/31.jpeg" alt="Image">&lt;/p>
&lt;p>In online business environments, we often observe that the communication overhead of RPC accounts for more than 20% of the total overhead for services heavy on I/O operations, even after optimizing RPC to the level of intra-machine communication.&lt;/p>
&lt;p>At this point, we&amp;rsquo;ve optimized inter-process communication to its extremes. If we are to seek further improvements, we need to break through the existing constraints in Linux inter-process communication fundamentally.&lt;/p>
&lt;p>We&amp;rsquo;ve already made some preliminary strides in this area. We will continue to share updates on this topic in future articles, so stay tuned.&lt;/p>
&lt;h2 id="reassessing-the-tcp-protocol">Reassessing the TCP Protocol&lt;/h2>
&lt;p>In the context of internal data center communication, the TCP protocol displays some limitations:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Given the superior internal network quality and an incredibly low packet loss rate, many designs within TCP appear redundant.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>In situations of large-scale point-to-point communication, TCP long connections may inadvertently degrade into short connections.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>While the application layer uses &amp;ldquo;messages&amp;rdquo; as a unit, TCP data streams don&amp;rsquo;t offer clear message boundaries, which could complicate synchronization and message handling.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>This has led us to question whether we need to develop a proprietary data center protocol, better suited to handle RPC communication.&lt;/p>
&lt;h2 id="continuing-to-refine-existing-components">Continuing to Refine Existing Components&lt;/h2>
&lt;p>When it comes to existing components, we plan to continue our efforts to enhance their performance and applicability:&lt;/p>
&lt;p>&lt;strong>Frugal, the Thrift JIT Encoder/Decoder:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Introducing support for the ARM architecture.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Optimizing the backend with Static Single Assignment (SSA).&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Accelerating performance with Single Instruction, Multiple Data (SIMD) operations.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Netpoll Network Library:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Refactoring interfaces to ensure seamless integration with existing libraries in the Go ecosystem.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Implementing support for Shared Memory Communications over RDMA (SMC-R).&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Pod Affinity:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Expanding from same-machine to same-rack granularity, effectively reducing network latency and improving performance.&lt;/li>
&lt;/ul>
&lt;p>In this post, we explored optimizing microservices performance using Kitex, the RPC framework developed by ByteDance. We discussed various techniques, from encoding and decoding enhancements, JIT compilation, network library optimization, and communication layer upgrades, to automated GC optimization, concurrent processing strategies, and microservices online tuning practices.&lt;/p>
&lt;p>Kitex has demonstrated its ability to outperform other frameworks in testing comparisons, showcasing its strength in handling complex microservice architectures.&lt;/p>
&lt;p>We also briefly looked towards future optimizations, including kernel-level improvements, restructuring the TCP protocols, and further refinement of existing components. With continuous learning and improvements, we are driven to unlock the vast potential in microservice performance optimization, taking us one step closer to the realm of real-time computing.&lt;/p>
&lt;p>For any questions or discussions, you&amp;rsquo;re welcome to join our community on &lt;a href="https://github.com/cloudwego">GitHub&lt;/a> or &lt;a href="https://discord.gg/jceZSE7DsW">Discord&lt;/a>.&lt;/p></description></item><item><title>Blog: Harnessing the Power of Rust for Cloud Development with Volo</title><link>https://www.cloudwego.io/blog/2024/01/18/harnessing-the-power-of-rust-for-cloud-development-with-volo/</link><pubDate>Thu, 18 Jan 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/01/18/harnessing-the-power-of-rust-for-cloud-development-with-volo/</guid><description>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Harnessing_the_Power_of_Rust_for_Cloud_Development_with_Volo/1.jpeg" alt="Image">&lt;/p>
&lt;h2 id="i-introduction">I. Introduction&lt;/h2>
&lt;p>Every tool in the &lt;a href="https://www.cloudwego.io">CloudWeGo&lt;/a> open-source ecosystem has been developed with the aim of simplifying and revolutionizing how developers navigate the cloud environment. An essential part of this ecosystem is &lt;a href="https://www.cloudwego.io/docs/volo/">Volo&lt;/a>, a Rust RPC framework designed to provide a seamless and efficient communication infrastructure.&lt;/p>
&lt;p>This guide aims to provide in-depth insights into leveraging Volo in your projects. Built with &lt;a href="https://www.rust-lang.org">Rust&lt;/a>, Volo brings unique features and advantages into the mix.&lt;/p>
&lt;h2 id="ii-the-power-of-rust-based-volo-in-the-real-world">II. The Power of Rust-Based Volo in the Real World&lt;/h2>
&lt;p>As a part of the CloudWeGo family, Volo can make a significant impact in real-world applications. Its high-speed processing capabilities, when combined with the safety and concurrency advantages of Rust, can provide an efficient backbone to high-performance web services and applications.&lt;/p>
&lt;p>The beauty of Rust, which Volo encapsulates, is its ability to push beyond the performance boundaries typically associated with languages such as Go. While Go is highly efficient, it does reach a performance ceiling that may not lend itself to deep optimization. However, once a finely optimized Go service is rewritten in Rust, the benefits spring into view.&lt;/p>
&lt;p>Here, CPU gains generally rise above 30%, some even reaching over 50%. In some cases, a fourfold increase in CPU gains is observed. Memory gains are even more pronounced, regularly topping 50% and in some cases reaching as high as 90%.&lt;/p>
&lt;p>Beyond performance, Rust addresses the unpredictable jitter issues brought about by &lt;a href="https://tip.golang.org/doc/gc-guide">Go&amp;rsquo;s garbage collection (GC)&lt;/a>. In doing so, it helps businesses significantly reduce timeout/error rates, decrease P99 latency, and improve the service level agreements (SLA) of their offerings.&lt;/p>
&lt;p>Consider the infrastructure of an online marketplace&amp;rsquo;s back-end. Volo can facilitate seamless interactions between the users, the product database, and third-party services, making them more efficient and reliable.&lt;/p>
&lt;p>Another use case could be in the gaming industry, where Volo can help manage player data, game state, and real-time multiplayer interactions with low-latency and high reliability.&lt;/p>
&lt;p>Rust and Go are not adversaries but rather allies that complement each other, leveraging their respective strengths to compensate for any weaknesses. For applications where ultimate performance, low latency, memory bottlenecks, and stability are of paramount importance, even if it comes at the cost of some iteration speed loss, Rust is the go-to choice.&lt;/p>
&lt;p>These applications can fully benefit from Rust&amp;rsquo;s, and by extension Volo&amp;rsquo;s, unrivaled performance optimization and security. However, when performance sensitivity takes a backseat to high I/O operations, and when rapid development and iteration receives priority over stability, Go becomes the preferred choice.&lt;/p>
&lt;p>Rust&amp;rsquo;s vast applicability doesn&amp;rsquo;t stop at server-side business and architectural domains. Its exploratory and implementation journey extends to areas such as internal safety, kernel development, AI, frontend, and client-side development. As such, Volo, with its Rust foundation, carries this adaptability and flexibility, ready to conquer diverse domains and real-world challenges.&lt;/p>
&lt;h2 id="iii-getting-started-with-cloudwego">III. Getting Started With CloudWeGo&lt;/h2>
&lt;p>CloudWeGo provides a robust set of tools to work with, one of which is Volo. Here&amp;rsquo;s how you can kickstart your journey with Volo within the CloudWeGo ecosystem.&lt;/p>
&lt;h3 id="volo">Volo&lt;/h3>
&lt;h4 id="prerequisites">Prerequisites&lt;/h4>
&lt;p>If you don’t have the Rust development environment set up, please follow &lt;a href="https://www.rust-lang.org/tools/install">Install Rust&lt;/a> to download Rustup and install Rust. Volo supports Linux, macOS, and Windows systems by default.&lt;/p>
&lt;h4 id="install-the-cli-tool">Install the CLI tool&lt;/h4>
&lt;p>Volo provides CLI tools of the same name for initializing projects, managing IDLs, and more. To install Volo tool, run the following command: &lt;code>cargo install volo-cli&lt;/code>.&lt;/p>
&lt;p>Then run: &lt;code>volo help&lt;/code>&lt;/p>
&lt;p>You should see something similar to the following:&lt;/p>
&lt;pre tabindex="0">&lt;code>USAGE:
volo [OPTIONS] &amp;lt;SUBCOMMAND
OPTIONS:
-h, --help Print help information
-n, --entry-name &amp;lt;ENTRY_NAME The entry name, defaults to &amp;#39;default&amp;#39;. [default: default]
-v, --verbose Turn on the verbose mode.
-V, --version Print version information
SUBCOMMANDS: help Print this message or the help of the given subcommand(s)
idl manage your idl
&lt;/code>&lt;/pre>&lt;h2 id="iv-creating-a-sample-project-with-cloudwego">IV. Creating A Sample Project With CloudWeGo&lt;/h2>
&lt;p>When starting a new project with Volo, the following steps can guide you through the development of basic components.&lt;/p>
&lt;h3 id="thrift-project">Thrift project&lt;/h3>
&lt;p>&lt;strong>1. Write IDL&lt;/strong>&lt;/p>
&lt;p>To create a Thrift project, we need to write a Thrift IDL first. In your working directory, execute the following command:&lt;/p>
&lt;pre tabindex="0">&lt;code>mkdir volo-example &amp;amp;&amp;amp; cd volo-example
mkdir idl &amp;amp;&amp;amp; vim idl/volo_example.thrift
&lt;/code>&lt;/pre>&lt;p>Then, enter the following content:&lt;/p>
&lt;pre tabindex="0">&lt;code>namespace rs volo.example
struct Item {
1: required i64 id,
2: required string title,
3: required string content,
10: optional map&amp;lt;string, string&amp;gt; extra,
}
struct GetItemRequest {
1: required i64 id,
}
struct GetItemResponse {
1: required Item item,
}
service ItemService {
GetItemResponse GetItem (1: GetItemRequest req),
}
Init the server project
volo init volo-example idl/volo_example.thrift
&lt;/code>&lt;/pre>&lt;p>&lt;strong>Note:&lt;/strong> Here we use the &lt;code>init&lt;/code> command, followed by the name of our project, which means we need to generate template code. At the end, you need to specify an IDL used by the server.&lt;/p>
&lt;p>At this point, our entire directory structure looks like this:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-." data-lang=".">├── Cargo.toml
├── idl
│ └── volo_example.thrift
├── rust-toolchain.toml
├── src
│ ├── bin
│ │ └── server.rs
│ └── lib.rs
└── volo-gen
├── Cargo.toml
├── build.rs
├── src
│ └── lib.rs
└── volo.yml
&lt;/code>&lt;/pre>&lt;p>&lt;strong>2. Add logic code&lt;/strong>&lt;/p>
&lt;p>Open &lt;code>src/lib.rs&lt;/code> and add the method implementation to the impl block:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-pub" data-lang="pub">
impl volo_gen::volo::example::ItemService for S {
// This is the part of the code we need to add
async fn get_item(
&amp;amp;self,
_req: volo_gen::volo::example::GetItemRequest,
) -&amp;gt; core::result::Result&amp;lt;volo_gen::volo::example::GetItemResponse, volo_thrift::AnyhowError&amp;gt;
{
Ok(Default::default())
}
}
&lt;/code>&lt;/pre>&lt;p>&lt;strong>3. Execute&lt;/strong>&lt;/p>
&lt;pre tabindex="0">&lt;code>cargo update &amp;amp;&amp;amp; cargo build
&lt;/code>&lt;/pre>&lt;p>At this point, you will find &lt;code>volo_gen.rs&lt;/code> file under &lt;code>OUT_DIR Directory&lt;/code>. Then execute the following command to get our server running:&lt;/p>
&lt;pre tabindex="0">&lt;code>cargo run --bin server
&lt;/code>&lt;/pre>&lt;p>We now have our server running!&lt;/p>
&lt;h3 id="grpc-project">gRPC project&lt;/h3>
&lt;p>&lt;strong>1. Write IDL&lt;/strong>&lt;/p>
&lt;p>To create a gRPC project, we need to write a protobuf IDL first. In your working directory, execute the following command:&lt;/p>
&lt;pre tabindex="0">&lt;code>mkdir volo-example &amp;amp;&amp;amp; cd volo-example
mkdir idl &amp;amp;&amp;amp; vim idl/volo_example.proto
&lt;/code>&lt;/pre>&lt;p>Then, enter the following content:&lt;/p>
&lt;pre tabindex="0">&lt;code>syntax = &amp;#34;proto3&amp;#34;;
package volo.example;
message Item {
int64 id = 1;
string title = 2;
string content = 3;
map&amp;lt;string, string&amp;gt; extra = 10;
}
message GetItemRequest {
int64 id = 1;
}
message GetItemResponse {
Item item = 1;
}
service ItemService {
rpc GetItem(GetItemRequest) returns (GetItemResponse);
}
&lt;/code>&lt;/pre>&lt;p>&lt;strong>2. Init the server project&lt;/strong>&lt;/p>
&lt;pre tabindex="0">&lt;code>volo init --includes=idl volo-example idl/volo_example.proto
&lt;/code>&lt;/pre>&lt;p>&lt;strong>Note:&lt;/strong> Here we use the &lt;code>init&lt;/code> command, followed by the name of our project, which means we need to generate template code. At the end, you need to specify an IDL used by the server.&lt;/p>
&lt;p>At this point, our entire directory structure looks like this:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-." data-lang=".">├── Cargo.toml
├── idl
│ └── volo_example.proto
├── rust-toolchain.toml
├── src
│ ├── bin
│ │ └── server.rs
│ └── lib.rs
└── volo-gen
├── Cargo.toml
├── build.rs
├── src
│ └── lib.rs
└── volo.yml
&lt;/code>&lt;/pre>&lt;p>&lt;strong>3. Add logic code&lt;/strong>&lt;/p>
&lt;p>Open &lt;code>src/lib.rs&lt;/code> and add the method implementation to the impl block:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-pub" data-lang="pub">
impl volo_gen::volo::example::ItemService for S {
// This is the part of the code we need to add
async fn get_item(
&amp;amp;self,
_req: volo_grpc::Request&amp;lt;volo_gen::volo::example::GetItemRequest&amp;gt;,
) -&amp;gt; core::result::Result&amp;lt;volo_grpc::Response&amp;lt;volo_gen::volo::example::GetItemResponse&amp;gt;, volo_grpc::Status&amp;gt;
{
Ok(volo_grpc::Response::new(Default::default()))
}
}
&lt;/code>&lt;/pre>&lt;p>&lt;strong>4. Execute&lt;/strong>&lt;/p>
&lt;pre tabindex="0">&lt;code>cargo update &amp;amp;&amp;amp; cargo build
&lt;/code>&lt;/pre>&lt;p>At this point, you will find &lt;code>volo_gen.rs&lt;/code> file under &lt;code>OUT_DIR Directory&lt;/code>. Then execute the following command to get our server running:&lt;/p>
&lt;pre tabindex="0">&lt;code>cargo run --bin server
&lt;/code>&lt;/pre>&lt;p>If you followed the above steps, you&amp;rsquo;ll now have your server running!&lt;/p>
&lt;h2 id="v-troubleshooting-tips--faq">V. Troubleshooting Tips &amp;amp; FAQ&lt;/h2>
&lt;p>Like any technology, working with Volo might come up with its own set of challenges. Here are some tips to handle common issues:&lt;/p>
&lt;p>&lt;strong>- Compilation Errors:&lt;/strong> If you encounter any compilation errors, it&amp;rsquo;s recommended to double-check your Rust environment and Volo setup. Ensure that you have the latest stable version of Rust and that Volo is correctly installed and updated to the latest version.&lt;/p>
&lt;p>&lt;strong>- Runtime Issues:&lt;/strong> If your Volo application runs into issues during runtime, investigate the error messages and logs. Volo errors are designed to be descriptive and should guide you towards the problem source.&lt;/p>
&lt;p>&lt;strong>- Why is the code generated by &lt;code>volo-cli&lt;/code> separately split into the volo-gen crate?&lt;/strong>&lt;/p>
&lt;p>This separation is because Rust&amp;rsquo;s compilation operates on a crate-by-crate basis. Creating the generated code as a separate crate allows for better utilization of the compile cache (idl generally doesn&amp;rsquo;t change frequently).&lt;/p>
&lt;p>&lt;strong>- How compatible is it with Kitex?&lt;/strong>&lt;/p>
&lt;p>Volo is fully compatible with &lt;a href="https://www.cloudwego.io/blog/2024/01/10/mastering-golang-microservices-a-practical-guide-embrace-high-performance-with-kitex-and-hertz/">Kitex&lt;/a>, including functionalities like metadata transmission.&lt;/p>
&lt;h2 id="vi-conclusion">VI. Conclusion&lt;/h2>
&lt;p>This guide provided a comprehensive look into Volo, a powerful Rust-based component of the CloudWeGo ecosystem. With an understanding of how to set up and use Volo in your projects, you&amp;rsquo;re now equipped to harness the speed and efficiency that Volo brings to your cloud development tasks.&lt;/p>
&lt;p>As you continue to explore &lt;a href="https://www.cloudwego.io">CloudWeGo&lt;/a>, keep integrating its powerful features into your projects, and see the transformative impact it can have on your software development process.&lt;/p>
&lt;p>Stay curious, keep learning, and don&amp;rsquo;t hesitate to dive deeper into the boundless potential of CloudWeGo. Happy coding!&lt;/p></description></item><item><title>Blog: Hertz Release v0.8.0</title><link>https://www.cloudwego.io/blog/2024/01/12/hertz-release-v0.8.0/</link><pubDate>Fri, 12 Jan 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/01/12/hertz-release-v0.8.0/</guid><description>
&lt;p>In Hertz v0.8.0, in addition to the regular iterative optimization, we have also introduced an important feature.&lt;/p>
&lt;h2 id="partitioned-cookies">Partitioned cookies&lt;/h2>
&lt;p>In Hertz v0.8.0, we support the partitioned cookies feature.&lt;/p>
&lt;blockquote>
&lt;p>&lt;a href="https://github.com/cloudwego/hertz/pull/1041">https://github.com/cloudwego/hertz/pull/1041&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="background">Background&lt;/h3>
&lt;p>Third-party cookies provide the ability for cross-site tracking for the web, and their existence poses a huge threat to the privacy and security of web users. Chrome will disable third-party cookies for 1% of users starting from Quarter 1 of 2024, and gradually expand the disabling scope to 100% starting from the third quarter of 2024.
Partitioned Cookies Cookies Having Independent Partitioned State (CHIPS) serve as an alternative to third-party cookies, providing the ability to carry third-party cookies on cross-site requests.&lt;/p>
&lt;h4 id="set-partitioned-cookies-with-the-set-cookie-header">Set Partitioned Cookies with the Set-Cookie Header&lt;/h4>
&lt;pre tabindex="0">&lt;code>Set-Cookie header:
Set-Cookie: __Host-name=value; Secure; Path=/; SameSite=None; Partitioned;
&lt;/code>&lt;/pre>&lt;h3 id="how-to">How to&lt;/h3>
&lt;h4 id="upgrade-hertz-version">Upgrade Hertz version&lt;/h4>
&lt;p>Hertz added support for Partitioned Cookies in v0.8.0. You need to upgrade to &amp;gt; = v0.8.0 to use Partitioned Cookies.&lt;/p>
&lt;h4 id="how-to-use-partitioned-cookies">How to use Partitioned Cookies&lt;/h4>
&lt;p>Currently, Hertz supports Partitioned Cookies, but does not yet support passing whether it is Partitioned through SetCookie. We will add this feature in the next minor version. Before that, you can refer to the following code example to use Partitioned Cookies.&lt;/p>
&lt;pre tabindex="0">&lt;code>func SetPartitionedCookie(c *app.RequestContext, name, value string, maxAge int, path, domain string, sameSite protocol.CookieSameSite, secure, httpOnly bool) {
if path == &amp;#34;&amp;#34; {
path = &amp;#34;/&amp;#34;
}
cookie := protocol.AcquireCookie()
defer protocol.ReleaseCookie(cookie)
cookie.SetKey(name)
cookie.SetValue(url.QueryEscape(value))
cookie.SetMaxAge(maxAge)
// If name has the prefix of __Host，Path must be /
cookie.SetPath(path)
cookie.SetDomain(domain)
// Secure must be true。
cookie.SetSecure(secure)
cookie.SetHTTPOnly(httpOnly)
cookie.SetSameSite(sameSite)
cookie.SetPartitioned(true)
c.Response.Header.SetCookie(cookie)
}
func main() {
h := server.Default()
h.GET(&amp;#34;/partitioned&amp;#34;, func(ctx context.Context, c *app.RequestContext) {
SetPartitionedCookie(c, &amp;#34;user&amp;#34;, &amp;#34;hertz&amp;#34;, 1, &amp;#34;/&amp;#34;, &amp;#34;localhost&amp;#34;, protocol.CookieSameSiteNoneMode, true, true)
c.JSON(consts.StatusOK, utils.H{&amp;#34;partitioned&amp;#34;: &amp;#34;yes&amp;#34;})
})
h.Spin()
}
&lt;/code>&lt;/pre>&lt;p>Verify Set-Cookie Header&lt;/p>
&lt;pre tabindex="0">&lt;code>curl -v http://localhost:8888/partitioned
* Trying [::1]:8888...
* Connected to localhost (::1) port 8888
&amp;gt; GET /partitioned HTTP/1.1
&amp;gt; Host: localhost:8888
&amp;gt; User-Agent: curl/8.4.0
&amp;gt; Accept: */*
&amp;gt;
&amp;lt; HTTP/1.1 200 OK
&amp;lt; Server: hertz
&amp;lt; Date: Fri, 12 Jan 2024 07:01:02 GMT
&amp;lt; Content-Type: application/json; charset=utf-8
&amp;lt; Content-Length: 21
&amp;lt; Set-Cookie: user=hertz; max-age=1; domain=localhost; path=/; HttpOnly; secure; SameSite=None; Partitioned
&amp;lt;
* Connection #0 to host localhost left intact
{&amp;#34;partitioned&amp;#34;:&amp;#34;yes&amp;#34;}%
&lt;/code>&lt;/pre></description></item><item><title>Blog: Mastering Golang Microservices - A Practical Guide: Embrace High-Performance with Kitex and Hertz</title><link>https://www.cloudwego.io/blog/2024/01/10/mastering-golang-microservices-a-practical-guide-embrace-high-performance-with-kitex-and-hertz/</link><pubDate>Wed, 10 Jan 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/01/10/mastering-golang-microservices-a-practical-guide-embrace-high-performance-with-kitex-and-hertz/</guid><description>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Mastering_Golang_Microservices_A_Practical_Guide_Embrace_High_Performance_with_Kitex_and_Hertz/1.jpeg" alt="Image">&lt;/p>
&lt;h2 id="i-introduction">I. Introduction&lt;/h2>
&lt;p>The world of software development is fast-paced, and having reliable and efficient tools makes a significant difference.
This is where &lt;a href="https://github.com/cloudwego">CloudWeGo&lt;/a> with two of its major sub-projects - &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a> and &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a>, comes into play. A solution with the potential to transform the way developers navigate the cloud environment, thanks to its robust, open-source technology.&lt;/p>
&lt;p>Two of its standout components, Kitex and Hertz, are at the center of our focus in this guide. Kitex is an efficient and powerful RPC framework used for communication between microservices, while Hertz aids in the quick and efficient setup of web services and BFF services. Both are designed to simplify and enhance your development efforts.&lt;/p>
&lt;p>Our mission in this guide is simple: to facilitate your understanding of CloudWeGo, its powerful features, and how to harness them in your projects with a clear step-by-step handbook.
Whether you are a seasoned developer familiar with open-source technology or a newcomer exploring cloud development, this guide is designed to cater to your needs.&lt;/p>
&lt;p>Once done reading, you will be comfortable setting up CloudWeGo, initiating and developing a project, implementing testing, debugging, deploying your applications, and more.
We&amp;rsquo;ll also share some of the best practices when using CloudWeGo to ensure that you are maximizing the potential of the CloudWeGo open-source ecosystem. Let&amp;rsquo;s dive in!&lt;/p>
&lt;h2 id="ii-getting-started-with-cloudwego">II. Getting Started With CloudWeGo&lt;/h2>
&lt;p>As key components of CloudWeGo, Kitex &amp;amp; Hertz, are crucial to getting started. Ensuring you have a suitably configured environment with Golang is a pre-requisite. If you are working on a Windows platform, make sure the version of Kitex is v0.5.2 or higher. Hertz, on the other hand, is compatible across Linux, macOS, and Windows systems.&lt;/p>
&lt;p>Installing the CLI tool requires confirmation that the &lt;code>GOPATH&lt;/code> environment variable is correctly defined and accessible. This is followed by installing Kitex, Thriftgo, and Hertz. The correct setup can be verified by running their respective versions. If you encounter any problems, your troubleshooting should involve a check on the setup of the Golang development environment.&lt;/p>
&lt;h3 id="kitex--hertz">Kitex &amp;amp; Hertz&lt;/h3>
&lt;h4 id="prerequisites">Prerequisites&lt;/h4>
&lt;p>Before diving into CloudWeGo development with Kitex &amp;amp; Hertz, make sure you have set up the Golang development environment. Please follow the Install Go guide if you haven&amp;rsquo;t already.&lt;/p>
&lt;p>We highly recommend using the latest version of Golang, ensuring compatibility with three most recent minor release versions (currently &amp;gt;= v1.16).&lt;/p>
&lt;p>Additionally, make sure that &lt;code>GO111MODULE&lt;/code> is set to &lt;code>ON&lt;/code>.&lt;/p>
&lt;h3 id="install-the-cli-tool">Install the CLI tool&lt;/h3>
&lt;p>Let&amp;rsquo;s start by installing the CLI tools we will be working with.
Ensure the &lt;code>GOPATH&lt;/code> environment variable is properly defined (e.g., &lt;code>export GOPATH=~/go&lt;/code>), then add &lt;code>$GOPATH/bin&lt;/code> to the &lt;code>PATH&lt;/code> environment variable (e.g., &lt;code>export PATH=$GOPATH/bin:$PATH&lt;/code>). Make sure that &lt;code>GOPATH&lt;/code> is accessible.&lt;/p>
&lt;p>Next, install Kitex (&lt;code>go install github.com/cloudwego/kitex/tool/cmd/kitex@latest&lt;/code>), Thriftgo (for Thrift protocol - &lt;code>go install github.com/cloudwego/thriftgo@latest&lt;/code>), and Hertz (&lt;code>go install github.com/cloudwego/hertz/cmd/hz@latest&lt;/code>).&lt;/p>
&lt;p>Now, if you run &lt;code>kitex --version&lt;/code>, &lt;code>thriftgo --version&lt;/code>, and &lt;code>hz --version&lt;/code>, you should see output indicating the versions of each CLI tool:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ kitex --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vx.x.x
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ thriftgo --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>thriftgo x.x.x
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ hz --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vx.x.x
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Note:&lt;/strong> If you encounter any issues during the installation, it&amp;rsquo;s likely due to gaps in the setup of the Golang development environment. Usually, you can quickly find a solution by searching for the error message online.&lt;/p>
&lt;h2 id="iii-creating-a-sample-project">III. Creating A Sample Project&lt;/h2>
&lt;h3 id="kitex">Kitex&lt;/h3>
&lt;h4 id="get-the-example">Get the example&lt;/h4>
&lt;ol>
&lt;li>You can simply click &lt;a href="https://github.com/cloudwego/kitex-examples/archive/refs/heads/main.zip">here&lt;/a> to download the example.&lt;/li>
&lt;li>Or you can clone the sample repository &lt;code>git clone https://github.com/cloudwego/kitex-examples.git&lt;/code>.&lt;/li>
&lt;/ol>
&lt;h4 id="run-the-example">Run the example&lt;/h4>
&lt;h5 id="run-with-go">Run with go&lt;/h5>
&lt;ol>
&lt;li>Change to the &lt;code>hello&lt;/code> directory. Hello is a simple example of Kitex using the Thrift protocol.
&lt;code>cd kitex-examples/hello&lt;/code>&lt;/li>
&lt;li>Run server
&lt;code>go run .&lt;/code>&lt;/li>
&lt;li>Run client
open another terminal and &lt;code>go run ./client.&lt;/code>&lt;/li>
&lt;/ol>
&lt;h5 id="run-with-docker">Run with Docker&lt;/h5>
&lt;ol>
&lt;li>Go to the examples directory
&lt;code>cd kitex-examples&lt;/code>&lt;/li>
&lt;li>Build the example project
&lt;code>docker build -t kitex-examples&lt;/code>.&lt;/li>
&lt;li>Run the server
&lt;code>docker run --network host kitex-examples ./hello-server&lt;/code>&lt;/li>
&lt;li>Run the client
Open another terminal and run &lt;code>docker run --network host kitex-examples ./hello-client&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>Congratulations! You now have successfully used Kitex to complete an RPC.&lt;/p>
&lt;h3 id="hertz">Hertz&lt;/h3>
&lt;h5 id="quick-start">Quick Start&lt;/h5>
&lt;p>To create a sample project with Hertz, start by creating the &lt;code>hertz_demo&lt;/code> folder in the current directory and navigate to that directory. Then, create the &lt;code>main.go&lt;/code> file and add the following code:
package main&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;context&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/hertz/pkg/app&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/hertz/pkg/app/server&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/hertz/pkg/protocol/consts&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">h&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">server&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Default&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">h&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">GET&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/ping&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">func&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">c&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">app&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">RequestContext&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">JSON&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">consts&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">StatusOK&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">app&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">H&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;message&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;pong&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">h&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Spin&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Next, generate the &lt;code>go.mod&lt;/code> file (&lt;code>go mod init hertz_demo&lt;/code>), then tidy &amp;amp; get dependencies (&lt;code>go mod tidy&lt;/code>).&lt;/p>
&lt;p>To run the sample code, simply type &lt;code>go run hertz_demo&lt;/code>. If the server is launched successfully, you will see the following message:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>2022/05/17 21:47:09.626332 engine.go:567: &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>Debug&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> HERTZ: &lt;span style="color:#000">Method&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>GET &lt;span style="color:#000">absolutePath&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>/ping -- &lt;span style="color:#000">handlerName&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>main.main.func1 &lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>&lt;span style="color:#000">num&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span> handlers&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2022/05/17 21:47:09.629874 transport.go:84: &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>Info&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> HERTZ: HTTP server listening on &lt;span style="color:#000">address&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=[&lt;/span>::&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>:8888
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You can test the interface by typing &lt;code>curl http://127.0.0.1:8888/ping&lt;/code>. If everything is working correctly, you should see the following output:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;message&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;pong&amp;#34;&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="using-cli-tool-hz">Using CLI tool hz&lt;/h5>
&lt;p>You can also use the Hertz CLI tool to generate a sample project outside of the &lt;code>GOPATH&lt;/code>. Procedures include creating an IDL file named &lt;code>hello.thrift&lt;/code>, generating the sample code, obtaining the dependencies, and subsequently running the sample code.
Assuming you are working on a folder outside of &lt;code>GOPATH&lt;/code>, create an IDL file called &lt;code>hello.thrift&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-thrift" data-lang="thrift">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">namespace&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">go&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">hello.world&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">service&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">HelloService&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Hello&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Generate or complete the Sample Code using &lt;code>hz new -idl hello.thrift -module hertz_demo&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Note:&lt;/strong> since you&amp;rsquo;re currently not in &lt;code>GOPATH&lt;/code>, you&amp;rsquo;ll need to add &lt;code>-module&lt;/code> or &lt;code>-mod&lt;/code> flag to specify a custom module name. After execution, a scaffolding of the Hertz project is created in the current directory, with a ping interface for testing.&lt;/p>
&lt;p>Get dependencies (&lt;code>go mod tidy&lt;/code>), then run the sample code (&lt;code>go build -o hertz_demo &amp;amp;&amp;amp; ./hertz_demo&lt;/code>).&lt;/p>
&lt;p>If the server is launched successfully, you will see the same message as before, and you can test the interface using the same curl command. Congratulations, you&amp;rsquo;ve successfully launched the Hertz Server!&lt;/p>
&lt;h2 id="iv-testing-and-debugging-your-project">IV. Testing and Debugging Your Project&lt;/h2>
&lt;p>Testing and debugging your project are essential components whether you are working with Kitex or Hertz.
While dealing with Kitex errors, the &lt;code>IsKitexError&lt;/code> method in the kerrors package can be used.&lt;/p>
&lt;p>The Kitex framework automatically recovers all panics except those occurring within the goroutine created by the business code using the &lt;code>go&lt;/code> keyword.&lt;/p>
&lt;h3 id="kitex-1">Kitex&lt;/h3>
&lt;h4 id="exception-instruction">Exception Instruction&lt;/h4>
&lt;p>Check for Kitex errors using &lt;code>kerrors.IsKitexError(kerrors.ErrInternalException)&lt;/code>. You can check for a specified error type using &lt;code>errors.Is(err, kerrors.ErrNoResolver)&lt;/code>. Also, note that you can use &lt;code>IsTimeoutError&lt;/code> in kerrors to check whether it&amp;rsquo;s a timeout error.&lt;/p>
&lt;p>To get detailed error messages, all detailed errors are defined by &lt;code>DetailedError&lt;/code> in kerrors. You can use &lt;code>errors.As&lt;/code> to fetch specified &lt;code>DetailedError&lt;/code>.&lt;/p>
&lt;p>For example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;errors&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/kitex/client&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/kitex/pkg/kerrors&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">_&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">err&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">echo&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewClient&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;echo&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">client&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">WithResolver&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">nil&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">var&lt;/span> &lt;span style="color:#000">de&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">kerrors&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">DetailedError&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">ok&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">errors&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">As&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">err&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">de&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>DetailedError&lt;/code> provides the following methods to fetch a detailed message:&lt;/p>
&lt;ul>
&lt;li>&lt;code>ErrorType() error&lt;/code>: to get the basic error type&lt;/li>
&lt;li>&lt;code>Stack() string&lt;/code>: to get the stack (currently only works for &lt;code>ErrPanic&lt;/code>)&lt;/li>
&lt;/ul>
&lt;h3 id="handling-panic">Handling panic&lt;/h3>
&lt;p>Panic that occurs in the goroutine created by the business code using the go keyword must be recovered by the business code. To ensure the stability of the service, the Kitex framework will automatically recover all other panics.&lt;/p>
&lt;p>While checking for recovered panic in your middlewares, you can use &lt;code>ri.Stats().Panicked()&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// After calling next(...) in your middleware:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">ri&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">rpcinfo&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">GetRPCInfo&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000">stats&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">ri&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Stats&lt;/span>&lt;span style="color:#000;font-weight:bold">();&lt;/span> &lt;span style="color:#000">stats&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">!=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">nil&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000">panicked&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">err&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">stats&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Panicked&lt;/span>&lt;span style="color:#000;font-weight:bold">();&lt;/span> &lt;span style="color:#000">panicked&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// err is the object kitex get by calling recover()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="faq--answers">FAQ &amp;amp; Answers&lt;/h4>
&lt;p>&lt;strong>Q1: &lt;code>Not enough arguments&lt;/code> problem when installing the code generation tool&lt;/strong>&lt;/p>
&lt;p>Please try:
&lt;code>go mod：GO111MODULE=on go get github.com/cloudwego/kitex/tool/cmd/kitex@latest&lt;/code>&lt;/p>
&lt;p>&lt;strong>Q2: Why does &lt;code>set&lt;/code> in IDL become &lt;code>slice&lt;/code> in generated codes?&lt;/strong>&lt;/p>
&lt;p>Due to JSON serialization, the official Apache Thrift changed the generation type of &lt;code>set&lt;/code> from &lt;code>map&lt;/code> to &lt;code>slice&lt;/code> starting from v0.11.0. To ensure compatibility, Kitex follows this rule.&lt;/p>
&lt;p>&lt;strong>Q3: Why is there an underscore after some field names?&lt;/strong>&lt;/p>
&lt;p>The official implementation of Thrift forbids identifiers ending in &amp;ldquo;Result&amp;rdquo; and &amp;ldquo;Args&amp;rdquo; to avoid naming conflicts. When the type name, service name, and method name in the Thrift file start with &amp;ldquo;New&amp;rdquo; or end with &amp;ldquo;Result&amp;rdquo; or &amp;ldquo;Args&amp;rdquo;, an underscore is automatically added at the end of the name.&lt;/p>
&lt;p>&lt;strong>Q4: Does the code generated by a new interface overwrite &lt;code>handler.go&lt;/code>?&lt;/strong>&lt;/p>
&lt;p>Generated code under &lt;code>kitex_gen/&lt;/code> will be overwritten. However, &lt;code>handler.go&lt;/code> of the server will not be overwritten; new methods will be added correspondingly.&lt;/p>
&lt;p>&lt;strong>Q5: &amp;ldquo;Not enough arguments in call to &lt;code>iprot.ReadStructBegin&lt;/code> when compiling Thrift interface&lt;/strong>&lt;/p>
&lt;p>Kitex is based on Apache Thrift v0.13 and cannot be directly upgraded since there is a breaking change in Apache Thrift v0.14. Such issues usually arise if a new version of Thrift is pulled during upgrades.&lt;/p>
&lt;p>We recommend against using &lt;code>-u&lt;/code> parameters during upgrades. You can run the following command to fix the version: &lt;code>go mod edit -replace github.com/apache/thrift=github.com/apache/thrift@v0.13.0&lt;/code>&lt;/p>
&lt;h3 id="hertz-1">Hertz&lt;/h3>
&lt;h4 id="error-type--error-chain">Error Type &amp;amp; Error Chain&lt;/h4>
&lt;p>To handle errors more effectively, Hertz has predefined several error types:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ErrorTypeBind:&lt;/strong> Error in binding process&lt;/li>
&lt;li>&lt;strong>ErrorTypeRender:&lt;/strong> Error in rendering process&lt;/li>
&lt;li>&lt;strong>ErrorTypePrivate:&lt;/strong> Hertz private errors that business doesn&amp;rsquo;t need to be aware of&lt;/li>
&lt;li>&lt;strong>ErrorTypePublic:&lt;/strong> Hertz public errors that require external perception as opposed to Private&lt;/li>
&lt;li>&lt;strong>ErrorTypeAny:&lt;/strong> Other Error&lt;/li>
&lt;/ul>
&lt;p>Users should define corresponding errors according to these error types.
In addition to error definition conventions, Hertz also provides &lt;code>ErrorChain&lt;/code> capability to make it easier for businesses to bind all errors encountered during request processing to an error chain.&lt;/p>
&lt;p>The corresponding API for this is &lt;code>RequestContext.Error(err)&lt;/code>. Calling this API will tie the err to its corresponding request context. To get all the errors bound by the request context, use &lt;code>RequestContext.Errors&lt;/code>.&lt;/p>
&lt;h4 id="faq--answers-1">FAQ &amp;amp; Answers&lt;/h4>
&lt;p>&lt;strong>Q1: High Memory Usage&lt;/strong>&lt;/p>
&lt;p>Connections not Closing due to Client Non-standard Usage: If the client initiates a large number of connections without closing them, there can be a significant waste of resources over time, causing high memory usage problems.
To resolve this, configure &lt;code>idleTimeout&lt;/code> reasonably. Hertz Server will close the connection to ensure the server&amp;rsquo;s stability after the timeout. The default configuration is three minutes.&lt;/p>
&lt;p>&lt;strong>Q2: Vast Request/Response&lt;/strong>&lt;/p>
&lt;p>If the request and response are vast, the data will enter memory, causing significant pressure, especially when stream and chunk are not used. To resolve this, for very vast requests cases, use a combination of streaming and go net.&lt;/p>
&lt;p>&lt;strong>Q3: Common Error Code Checking&lt;/strong>&lt;/p>
&lt;p>The following error codes are commonly reported by the framework:&lt;/p>
&lt;ul>
&lt;li>404 (Access to the wrong port or No routes matched)&lt;/li>
&lt;li>417 (The server returns false after executing the custom &lt;code>ContinueHandler&lt;/code>)&lt;/li>
&lt;li>500 (Throwing the panic in middleware or in &lt;code>handlerFunc&lt;/code>)&lt;/li>
&lt;/ul>
&lt;p>For more details and solutions on these and other error codes, please refer to the &lt;a href="https://www.cloudwego.io/docs/kitex/getting-started/">Kitex User Guide&lt;/a>.&lt;/p>
&lt;h3 id="context-guide">Context Guide&lt;/h3>
&lt;p>Hertz also provides a standard &lt;code>context.Content&lt;/code> and a request context as input arguments in the function in the &lt;code>HandleFunc&lt;/code> Design. The handler/middleware function signature is:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">HandlerFunc&lt;/span> &lt;span style="color:#204a87;font-weight:bold">func&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">c&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">app&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">RequestContext&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="metadata-storage">Metadata Storage&lt;/h4>
&lt;p>Both contexts (c and ctx) have the ability to store values. The choice of which one to use depends on the life cycle of the stored value and the selected context should match. The &lt;code>ctx&lt;/code> is primarily used to store request-level variables, which are recycled after the request ends.&lt;/p>
&lt;p>It is characterized by high query efficiency (the bottom is map), unsafe coroutines and doesn&amp;rsquo;t implement the &lt;code>context.Context&lt;/code> Interface. The &lt;code>c&lt;/code> is passed as the context between middleware/handler. It has all the semantics of context.Content, is safe for coroutines, and all that requires the &lt;code>context.Content&lt;/code> interface as input arguments can just pass &lt;code>c&lt;/code> directly.&lt;/p>
&lt;h2 id="v-observability">V. Observability&lt;/h2>
&lt;p>Monitoring your application is critical. Both Kitex and Hertz provide a Tracer interface that can be implemented for efficient application monitoring. You can make the most of the numerous instrumentation controls and logging capabilities on offer.&lt;/p>
&lt;p>&lt;strong>Note:&lt;/strong> As a framework, it runs with business services. Once the code of services is built, it can be deployed at virtual machines, bare metal machines, or Docker containers as it should be.&lt;/p>
&lt;h3 id="kitex-2">Kitex&lt;/h3>
&lt;h4 id="configuration-and-options">Configuration and options&lt;/h4>
&lt;p>For more details, please check &lt;a href="https://www.cloudwego.io/zh/docs/kitex/tutorials/options/server_options/">server option&lt;/a>, &lt;a href="https://www.cloudwego.io/zh/docs/kitex/tutorials/options/client_options/">client option&lt;/a>, and &lt;a href="https://www.cloudwego.io/zh/docs/kitex/tutorials/options/call_options/">call option&lt;/a>.&lt;/p>
&lt;h5 id="observability">Observability&lt;/h5>
&lt;h6 id="instrumentation-control">Instrumentation Control&lt;/h6>
&lt;p>Kitex supports flexible enabling of basic and fine-grained Instrumentation. This includes a stats level, client tracing stats level control, server tracing stats level control, and more. For more details, please refer to the &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/observability/">Kitex User Guide&lt;/a>.&lt;/p>
&lt;h5 id="logging">Logging&lt;/h5>
&lt;p>Kitex supports default logger implementation, injection of custom loggers, and redirection of default logger output. For more details, instructions, and examples, please refer to the &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/observability/">Kitex User Guide&lt;/a>.&lt;/p>
&lt;h5 id="tracing">Tracing&lt;/h5>
&lt;p>Kitex’s OpenTelemetry extension provides support for tracing. For more details, instructions, and examples, please refer to the &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/observability/">Kitex User Guide&lt;/a>.&lt;/p>
&lt;h5 id="monitoring">Monitoring&lt;/h5>
&lt;p>The framework doesn’t provide any monitoring, but it provides a Tracer interface. This interface can be implemented by yourself and be injected via WithTracer Option. For more details, instructions, and examples, please refer to the &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/observability/">Kitex User Guide&lt;/a>.&lt;/p>
&lt;h3 id="hertz-2">Hertz&lt;/h3>
&lt;h4 id="configuration-and-options-1">Configuration and options&lt;/h4>
&lt;p>For more details, please check the &lt;a href="https://www.cloudwego.io/docs/hertz/reference/config/">configuration instructions&lt;/a>.&lt;/p>
&lt;h5 id="observability-1">Observability&lt;/h5>
&lt;h6 id="instrumentation">Instrumentation&lt;/h6>
&lt;p>Hertz supports flexible enabling of basic and fine-grained Instrumentation. This includes a stats level, stats level control, and more. For more details, please refer to the &lt;a href="https://www.cloudwego.io/docs/hertz/tutorials/observability/">Hertz User Guide&lt;/a>.&lt;/p>
&lt;h5 id="log">Log&lt;/h5>
&lt;p>Hertz provides a default way to print logs in the standard output. It also provides several global functions, such as &lt;code>hlog.Info&lt;/code>, &lt;code>hlog.Errorf&lt;/code>, &lt;code>hlog.CtxTracef&lt;/code>, and more, which are implemented in &lt;code>pkg/common/hlog&lt;/code>, to call the corresponding methods of the default logger. For more details, instructions, and examples, please refer to the &lt;a href="https://www.cloudwego.io/docs/hertz/tutorials/observability/">Hertz User Guide&lt;/a>.&lt;/p>
&lt;h5 id="tracing-1">Tracing&lt;/h5>
&lt;p>In microservices, link tracing is a very important capability, which plays an important role in quickly locating problems, analyzing business bottlenecks, and restoring the link status of a request.
Hertz provides the capability of link tracking and also supports user-defined link tracking. For more details, instructions, and examples, please refer to the &lt;a href="https://www.cloudwego.io/docs/hertz/tutorials/observability/">Hertz User Guide&lt;/a>.&lt;/p>
&lt;h5 id="monitoring-1">Monitoring&lt;/h5>
&lt;p>The framework doesn’t provide any monitoring, but it provides a Tracer interface. This interface can be implemented by yourself and be injected via WithTracer Option. For more details, instructions, and examples, please refer to the &lt;a href="https://www.cloudwego.io/docs/hertz/tutorials/observability/">Hertz User Guide&lt;/a>.&lt;/p>
&lt;h2 id="vi-best-practices-for-developing-with-cloudwego">VI. Best Practices for Developing with CloudWeGo&lt;/h2>
&lt;p>For a real-world application of Kitex and Hertz, you can explore projects like &lt;a href="https://github.com/cloudwego/biz-demo/tree/main/bookinfo">Bookinfo&lt;/a>, &lt;a href="https://github.com/cloudwego/biz-demo/tree/main/easy_note">Easy Note&lt;/a>, and &lt;a href="https://github.com/cloudwego/biz-demo/tree/main/book-shop">Book Shop&lt;/a>. Each of these scenarios demonstrate different business scenarios and use-cases for various CloudWeGo subprojects.&lt;/p>
&lt;p>Whether you&amp;rsquo;re dealing with merchant or consumer management, notes maintenance, or integrating different middleware, these projects provide valuable insights into the powerful capabilities of Kitex and Hertz in different contexts.&lt;/p>
&lt;p>This guide provides a comprehensive exploration of CloudWeGo&amp;rsquo;s powerful capabilities, particularly its subprojects, Kitex and Hertz. You now have a solid understanding of how to harness these tools effectively in your development projects.&lt;/p>
&lt;p>As you continue delving into CloudWeGo, remember to mix the tool&amp;rsquo;s powerful features with your creativity for impressive results in your software development journey.&lt;/p>
&lt;p>Stay curious, keep exploring, and stay tuned for our upcoming Rust-focused &lt;a href="https://github.com/cloudwego/volo">Volo&lt;/a> guide, which will introduce you to yet another exciting aspect of CloudWeGo. Happy coding!&lt;/p></description></item><item><title>Blog: Volo Release 0.9.0</title><link>https://www.cloudwego.io/blog/2024/01/04/volo-release-0.9.0/</link><pubDate>Thu, 04 Jan 2024 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2024/01/04/volo-release-0.9.0/</guid><description>
&lt;p>In Volo 0.9.0, we mainly changed the default generated HashSet/HashMap type to AHashMap/AHashSet, which is expected to bring certain performance improvements. Additionally, with the release of &lt;a href="https://blog.rust-lang.org/2023/12/28/Rust-1.75.0.html">Rust 1.75&lt;/a>, Volo is already available in stable rust.&lt;/p>
&lt;h2 id="break-change">Break Change&lt;/h2>
&lt;h3 id="modification-of-the-default-generated-hashset--hashmap-type">Modification of the default generated HashSet / HashMap type&lt;/h3>
&lt;p>In the new version of the generated code, the default generated HashMap/HashSet type is changed to AHashMap/AHashSet, which gives better performance than std map, refer to &lt;a href="https://github.com/tkaitchuck/aHash/blob/master/compare/readme.md">ahash&lt;/a>. In user code, you can directly replace the original use of &lt;code>std::collections::HashMap&lt;/code> with &lt;code>pilota::AHashMap&lt;/code> or &lt;code>ahash::AHashMap&lt;/code> according to the compiler error (pilota is essentially re-exported the AHashMap of ahash, so it is the same type).&lt;/p>
&lt;h3 id="remove-option-from-rpcinfo-field-type">Remove Option from RpcInfo field type&lt;/h3>
&lt;p>In this version, we have removed the Option wrapper from the RpcInfo fields, which should be transparent to most users who have not written their own layers. If there are users who use cx to write layers, they can remove the Option processing directly.&lt;/p>
&lt;h3 id="added-basicerror">Added BasicError&lt;/h3>
&lt;p>In this version, the BasicError branch is added to the enumeration error type of volo-thrift, which is mainly used to store the errors within the framework itself. It is expected that this will not affect the vast majority of users. If the users have matched the error type, they will need to add the processing of BasicError.&lt;/p>
&lt;h3 id="remove-max_frame_size-method">Remove max_frame_size method&lt;/h3>
&lt;p>max_frame_size in the volo-thrift client is not actually used due to interface changes during iteration and has been removed in this version. If the user needs to set max_frame_size, they can use the make_codec method to pass in a custom codec and use the &lt;a href="https://github.com/cloudwego/volo/blob/main/volo-thrift/src/codec/default/framed.rs#L33">with_max_frame_size&lt;/a> method in the MakeFramedCodec layer to set max_frame_size.&lt;/p>
&lt;h3 id="upgrade-hyper-to-version-10">Upgrade hyper to version 1.0&lt;/h3>
&lt;p>hyper removed hyper::Body in version 1.0 and introduced hyper::body::Incoming as the requested Body type. In volo-grpc, we have followed up on this change, and we expect that the vast majority of users who have not written their own layers will not be interested. If there are users who use the complete Service generics, just change &lt;code>Service&amp;lt;ServerContext, Request&amp;lt;hyper::Body&amp;gt;&amp;gt;&lt;/code> to &lt;code>Service&amp;lt;ServerContext, Request&amp;lt;hyper::body::Incoming&amp;gt;&amp;gt;&lt;/code>.&lt;/p>
&lt;h2 id="complete-release-note">Complete Release Note&lt;/h2>
&lt;p>For the complete Release Note, please refer to: &lt;a href="https://github.com/cloudwego/volo/compare/volo-0.8.0...volo-0.9.0">Volo Changelog&lt;/a>&lt;/p></description></item><item><title>Blog: Kitex Release v0.8.0</title><link>https://www.cloudwego.io/blog/2023/11/30/kitex-release-v0.8.0/</link><pubDate>Thu, 30 Nov 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/11/30/kitex-release-v0.8.0/</guid><description>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="features">Features&lt;/h3>
&lt;p>&lt;strong>1. gRPC Multi-Service Support&lt;/strong>&lt;/p>
&lt;p>Implemented multi-service registration for Kitex gRPC, please refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/advanced-feature/multi_service/">Multiple Services&lt;/a>.&lt;/p>
&lt;p>&lt;strong>2. Acquire Kitex RPCInfo&lt;/strong>&lt;/p>
&lt;p>Added methods for easy retrieval of RPC information from RPCInfo, please refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/acquire_rpcinfo/">Acquire RPC information&lt;/a>.&lt;/p>
&lt;h3 id="optimizations">Optimizations&lt;/h3>
&lt;p>&lt;strong>1. Map Generic Call&lt;/strong>&lt;/p>
&lt;p>Map generic call supports returning []byte for binary fields via SetBinaryWithByteSlice option.&lt;/p>
&lt;p>&lt;strong>2. RPCInfo asynchronous use&lt;/strong>&lt;/p>
&lt;p>Added an option to disable reusing RPCInfo, facilitating asynchronous usage, please refer to please refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/acquire_rpcinfo/#12-asynchronous-usage">Acquire RPC information&lt;/a>.&lt;/p>
&lt;h3 id="others">Others&lt;/h3>
&lt;p>Upgraded frugal to &lt;a href="https://github.com/cloudwego/frugal/releases/tag/v0.1.12">v0.1.12&lt;/a>, fixing some concurrency issues when compiling types, especially the issue when registering new modules which may conflict with sonic.&lt;br>
It&amp;rsquo;s STRONGLY SUGGESTED updating both frugal and sonic to the latest version by&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span> go get github.com/cloudwego/frugal@latest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> go get github.com/bytedance/sonic@latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h3 id="feature">Feature:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1051">#1051&lt;/a>] feat(grpc): support gRPC multi-service on a server&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1189">#1189&lt;/a>] feat(rpcinfo): add kitexutil methods for the convenience to fetch rpc information from RPCInfo&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1176">#1176&lt;/a>] feat(tool): add an environment variable to make it easier to debug kitex tool&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1173">#1173&lt;/a>] feat(rpcinfo): allow disable rpcinfo reuse for async reference&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1172">#1172&lt;/a>] feat(retry): client.WithSpecifiedResultRetry should have higher priority&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1150">#1150&lt;/a>] feat(proxy): add an interface to customize proxy middleware to replace the default implementation&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1159">#1159&lt;/a>] feat(generic): support returning []byte for binary fields in map generic&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1153">#1153&lt;/a>] feat(retry): add Extra for retry.FailurePolicy for better extension&lt;/p>
&lt;h3 id="optimize">Optimize:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1187">#1187&lt;/a>] optimize(tool): add an option to keep resp for kitex tool&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1183">#1183&lt;/a>] optimize(meshheader): retrieve rip from meshheader and write it to TransInfo&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1178">#1178&lt;/a>] optimize(bizErr): recurse to obtain BizErr to avoid additional Error encapsulation in the middle, resulting in unwrap results that are not BizErr&lt;/p>
&lt;h3 id="fix">Fix:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1126">#1126&lt;/a>] fix(generic): the issue of structs cache of generic call has dirty data under multiple services scene&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1168">#1168&lt;/a>] fix(tool): remove the pointer to java.Object in generated file for &lt;a href="https://github.com/kitex-contrib/codec-dubbo">CodecDubbo&lt;/a>&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1169">#1169&lt;/a>] fix(tool): empty struct generate wrong struct&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1166">#1166&lt;/a>] fix(generic): issue of deep copy function generation when map key type is binary&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1155">#1155&lt;/a>] fix(tool): add import package &amp;lsquo;context&amp;rsquo; for gRPC client.go&lt;/p>
&lt;h3 id="tests">Tests:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1177">#1177&lt;/a>] test: avoid port conflict&lt;/p>
&lt;h3 id="chore">Chore:&lt;/h3>
&lt;p>[&lt;a href="https://github.com/cloudwego/kitex/pull/1190">#1190&lt;/a>] chore: update thriftgo version to v0.3.3&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1186">#1186&lt;/a>] chore: update readme with examples and new blogs&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1185">#1185&lt;/a>] chore: add ci for windows&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1182">#1182&lt;/a>] chore: update dynamicgo to v0.1.6&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1152">#1152&lt;/a>] chore: update dynamicgo and sonic version&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1164">#1164&lt;/a>] chore: update frugal to v0.1.12 and allow disable frugal by build tag&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1161">#1161&lt;/a>] chore: update frugal to v0.1.10&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1157">#1157&lt;/a>] chore: update frugal to v0.1.9&lt;br>
[&lt;a href="https://github.com/cloudwego/kitex/pull/1151">#1151&lt;/a>] chore(test): upgrade mockey to latest to compatible with Go1.21&lt;/p></description></item><item><title>Blog: The Role of CloudWeGo in Modern Cloud-Native Applications</title><link>https://www.cloudwego.io/blog/2023/11/28/the-role-of-cloudwego-in-modern-cloud-native-applications/</link><pubDate>Tue, 28 Nov 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/11/28/the-role-of-cloudwego-in-modern-cloud-native-applications/</guid><description>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/The_Role_of_CloudWeGo_in_Modern_Cloud_Native_Applications/1.png" alt="Image">&lt;/p>
&lt;h1 id="i-introduction">I. Introduction&lt;/h1>
&lt;p>In the current era of infrastructure modernization, the term &amp;ldquo;Cloud-Native Applications&amp;rdquo; has emerged as a significant factor driving the evolution of the IT landscape. These applications inherently embody the concept of flexibility, scalability, and high availability and are built and delivered in a rapid, dynamic manner. They leverage modern application development frameworks and methodologies like microservices, containerization, and DevOps. Amidst the vast array of technologies accelerating the development and deployment of cloud-native applications is CloudWeGo, a notable player offering a distinctive edge to developers and organizations.&lt;/p>
&lt;p>&lt;a href="https://www.cloudwego.io">CloudWeGo&lt;/a>, a brainchild of &lt;a href="https://www.bytedance.com/en/">ByteDance&lt;/a>, has established itself as a set of microservices middleware. It comprises a collection of high-performance, highly extensible, and highly reliable projects focused on microservices communication and governance.
In the face of the rapidly escalating hybrid and cloud-native microservices environment, CloudWeGo has proved to be a powerful fine-tuned tool to cater to the explicit requirements of such architectures. This article will explore the critical role CloudWeGo plays in understanding, architecting, and leveraging modern cloud-native applications.&lt;/p>
&lt;p>In the following sections, we will delve deeper into what exactly CloudWeGo is, its role in facilitating robust cloud-native applications, its specific advantages, and successfully implemented practical use-cases. Our objective is to present a well-rounded view of CloudWeGo&amp;rsquo;s impact and potential in revolutionizing the way cloud-native applications are structured and operated.&lt;/p>
&lt;h1 id="ii-what-is-cloudwego-an-in-depth-look-at-its-foundations-components-and-simplification-of-hybrid-microservices-creation">II. What is CloudWeGo: An In-depth Look at its Foundations, Components, and Simplification of Hybrid Microservices Creation&lt;/h1>
&lt;p>CloudWeGo is no ordinary middleware, but an open-source project empowering developers worldwide. Conceptualized and developed by ByteDance, CloudWeGo is a powerful toolbox for building enterprise-grade cloud-native architectures. It embodies a framework with a triple threat of high performance, high extensibility, and high reliability, making it a force to be reckoned with in the world of microservices.&lt;/p>
&lt;p>At its core, CloudWeGo houses multiple components that serve as the building blocks of its robust architecture:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>&lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a>&lt;/strong>: This is the heartbeat of CloudWeGo - a high-performance RPC framework that serves as a conduit for communication between different services. Its major contribution lies in supporting seamless and efficient distributed system development.&lt;/li>
&lt;li>&lt;strong>&lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a>&lt;/strong>: Stepping in as the HTTP framework within CloudWeGo, Hertz plays a pivotal role in supporting different HTTP protocols. Its extensive capabilities provide a solid base for crafting efficient and adaptive cloud-native applications.&lt;/li>
&lt;li>&lt;strong>&lt;a href="https://github.com/cloudwego/netpoll">Netpoll&lt;/a>&lt;/strong>: Serving as the foundation for CloudWeGo&amp;rsquo;s RPC and HTTP frameworks, Netpoll is an integral network library tailored for high-performance I/O scenarios. It&amp;rsquo;s framed explicitly with an eye on Linux optimization, enabling effective and optimized networking operations.&lt;/li>
&lt;li>&lt;strong>&lt;a href="https://github.com/cloudwego/shmipc-go">Shmipc&lt;/a>&lt;/strong>: CloudWeGo&amp;rsquo;s inter-process communication library paves the way for efficient communication between different processes within the same system space. Shmipc eliminates unnecessary network I/O operations, bolstering overall operational efficiency and performance.&lt;/li>
&lt;li>&lt;strong>&lt;a href="https://github.com/cloudwego/volo">Volo&lt;/a>&lt;/strong>: A home-brewed Rust-based RPC framework by CloudWeGo. This project exemplifies the organization’s commitment to developing cutting-edge, high-performance applications, offering a fresh perspective for developers accustomed to Golang and looking to dabble in Rust.&lt;/li>
&lt;/ol>
&lt;p>CloudWeGo’s strategic packaging and unification of these core components results in a cohesive, versatile and scalable microservices middleware, simplifying the task of creating complex hybrid microservices. Enterprises today are no strangers to utilizing different technological frameworks, languages, and platforms to cater to diverse functionality requirements. This need for diversity often calls for a hybrid microservices setup, where teams build different microservices using disparate programming languages, each optimized for a specific task.&lt;/p>
&lt;p>With CloudWeGo, developers enjoy the flexibility of constructing and seamlessly integrating such heterogeneous services, all while maintaining high performance and reliability. The platform&amp;rsquo;s interoperability, inclusive of &lt;a href="https://grpc.io">gRPC&lt;/a>, &lt;a href="https://thrift.apache.org">Thrift&lt;/a>, and other custom protocols, ensures a smooth connection between different services, making the building of hybrid microservices a more straightforward task. By seamlessly weaving together diverse microservices, irrespective of their language of construction, CloudWeGo successfully simplifies the otherwise daunting process of creating hybrid microservices architectures.&lt;/p>
&lt;p>Whether you&amp;rsquo;re a seasoned veteran or a beginner developer just starting in the world of microservices, CloudWeGo simplifies the journey, making the complex and challenging world of hybrid microservices a little less daunting and a lot more exciting.&lt;/p>
&lt;h1 id="iii-role-of-cloudwego-in-cloud-native-applications">III. Role of CloudWeGo in Cloud-Native Applications&lt;/h1>
&lt;p>In our fast-paced digital world, cloud-native applications are revolutionizing how businesses function. By leveraging cloud computing capabilities, these applications aim to enhance scalability, flexibility, and resilience. They adhere to a diverse set of requirements and characteristics:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Microservices Architecture&lt;/strong>: Applications are segmented into smaller, loosely coupled services, each fulfilling a specific function, creating a landscape that enables easier scalability, maintenance, and deployment.&lt;/li>
&lt;li>&lt;strong>Containerization&lt;/strong>: Packaging applications into containers like &lt;a href="https://www.docker.com">Docker&lt;/a>, that encapsulate the code, dependencies, and configurations, ensures uniformity across different environments and expedites deployment.&lt;/li>
&lt;li>&lt;strong>Orchestration and Automation&lt;/strong>: Tools such as &lt;a href="https://kubernetes.io">Kubernetes&lt;/a> excellently manage containerized applications by automating deployment, scaling, and service management, ensuring high availability and optimal resource utilization.&lt;/li>
&lt;li>&lt;strong>DevOps Practices&lt;/strong>: The deployment of Continuous Integration/Continuous Deployment (CI/CD) pipelines accelerates the software delivery process. This approach promotes regular and reliable code updates, facilitated by automated testing, version control, and deployment.&lt;/li>
&lt;li>&lt;strong>Scalability and Elasticity&lt;/strong>: Applications must efficiently scale both vertically (expanding resources within a single node) and horizontally (adding more nodes) to cater to changing workloads. Resource scalability and autoscaling features facilitated through cloud-based resources, handle this necessity.&lt;/li>
&lt;li>&lt;strong>Resilience and Fault Tolerance&lt;/strong>: Robust cloud-native applications are engineered to gracefully handle failures. Incorporating redundancy, failover mechanisms, and self-healing facilities ensures functionality despite component failures.&lt;/li>
&lt;li>&lt;strong>Security and Compliance&lt;/strong>: Implementing robust security measures is pivotal. Inclusion of features like encryption, identity management, access control, and compliance with regulations such as &lt;a href="https://gdpr-info.eu">GDPR&lt;/a>, built into the application architecture, is a requisite.&lt;/li>
&lt;li>&lt;strong>Observability&lt;/strong>: Comprehensive tracking of performance and logging capabilities are key to detect issues, locate system bottlenecks, and garner insights into system behavior. Tools like &lt;a href="https://prometheus.io">Prometheus&lt;/a>, &lt;a href="https://grafana.com">Grafana&lt;/a>, and &lt;a href="https://www.jaegertracing.io">Jaeger&lt;/a> often support this functionality.&lt;/li>
&lt;li>&lt;strong>Cost Efficiency&lt;/strong>: Efficient resource usage is crucial to control costs in a cloud environment. To that end, leveraging cloud provider services effectively, employing auto-scaling, monitoring resource consumption, and optimizing performance end-to-end is a must.&lt;/li>
&lt;/ol>
&lt;p>Implementing these principles leads to the creation of agile, scalable, and resilient applications, perfectly suited for the dynamic demands of contemporary business environments in the cloud.&lt;/p>
&lt;p>Despite numerous benefits, constructing cloud-native applications poses several challenges:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Complexity in Architecture&lt;/strong>: Adopting a microservices architecture introduces complexity in managing multiple services, dependencies, and interactions.&lt;/li>
&lt;li>&lt;strong>Skill Set Requirements&lt;/strong>: Developing cloud-native applications calls for competency in multiple technologies, making it challenging for organizations to acquire and retain talent.&lt;/li>
&lt;li>&lt;strong>Security Concerns&lt;/strong>: The distributed environment elevates the potential attack surface. It&amp;rsquo;s crucial to ensure each service&amp;rsquo;s security, secure communication channels, and manage access control across all components.&lt;/li>
&lt;li>&lt;strong>Resilience and Fault Tolerance&lt;/strong>: Ensuring resilience and fault tolerance requires careful planning for fault detection, recovery, retries, and service availability assurance despite failures.&lt;/li>
&lt;li>&lt;strong>Networking Complexity&lt;/strong>: Communication between services and managing networking configurations in a microservices-based architecture can get intricate, adding service discovery, load balancing, and handling network latency to the list of challenges.&lt;/li>
&lt;li>&lt;strong>Continuous Monitoring and Observability&lt;/strong>: Implementing comprehensive monitoring and logging across microservices can be challenging, though it&amp;rsquo;s crucial for detecting issues and optimizing the system.&lt;/li>
&lt;/ol>
&lt;p>Overcoming these challenges requires the adoption of best practices, leveraging appropriate technologies, investing in skill development, and continually evolving strategies.&lt;/p>
&lt;p>That&amp;rsquo;s where CloudWeGo steps in as a comprehensive microservices solution:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Simplifying Architectural Complexity&lt;/strong>: CloudWeGo integrates rich microservices best practices. It facilitates easy construction of a microservices architecture, handling service mesh integration, reducing costs, and driving optimal performance.&lt;/li>
&lt;li>&lt;strong>Addressing Skill Set Requirements&lt;/strong>: CloudWeGo streamlines the learning curve by providing all-in-one solutions for different scenarios – microservices vs. monoliths, Golang vs. Rust, RPC vs. RESTful, Protobuf vs. Thrift.&lt;/li>
&lt;li>&lt;strong>Ensuring Security&lt;/strong>: CloudWeGo prioritizes security, incorporating several measures. It enables identity management, access controls, and continuous security audits due to its open-source nature and follows industry best practices to ensure application security.&lt;/li>
&lt;li>&lt;strong>Promoting Resilience and Fault Tolerance&lt;/strong>: The Governance module of CloudWeGo boosts resilience and fault tolerance. With features such as timeout control, circuit breaking, rate-limiting, and fallbacks integrated into the Kitex RPC framework, system reliability is assured.&lt;/li>
&lt;li>&lt;strong>Simplifying Networking&lt;/strong>: CloudWeGo supports most popular registry centers for service discovery and registry. It manages intricate networking concerns through both Kitex and Hertz, which have built-in support and detailed guides for integration.&lt;/li>
&lt;li>&lt;strong>Enhancing Observability&lt;/strong>: With in-built Logging, Tracing, and Monitoring capabilities aided by &lt;a href="https://opentelemetry.io">OpenTelemetry&lt;/a> implementation, CloudWeGo significantly improves the observability of cloud-native applications.&lt;/li>
&lt;/ol>
&lt;p>CloudWeGo also incorporates several specific features tailored for cloud-native applications such as high-performance, high extensibility, and high reliability. These offerings, combined with the power of its key components - Kitex, Hertz, Netpoll, Shmipc, and Volo - make CloudWeGo a versatile toolset for efficient and effective cloud-native application development.&lt;/p>
&lt;h1 id="iv-advantages-of-using-cloudwego">IV. Advantages of Using CloudWeGo&lt;/h1>
&lt;h3 id="cloudwego-synonymous-with-reliability">CloudWeGo: Synonymous with Reliability&lt;/h3>
&lt;p>In an environment that demands stability and dependability, CloudWeGo shines as a reliable framework for developers and enterprises. Its focus on meticulous quality assurance, including extensive code reviews and testing, ensures that potential issues are addressed early on before impacting a production environment. CloudWeGo&amp;rsquo;s strong emphasis on stability reflects in the remarkable care the community dedicates toward PR integration, thorough testing, and constant monitoring. The project&amp;rsquo;s frameworks are optimized to effortlessly handle high workloads, guaranteeing stability and reliability, even under considerable pressure. Being open-source, CloudWeGo encourages community members to contribute feedback, driving continual improvement and swift issue resolution while adhering to rigorous quality standards. As a result, CloudWeGo projects are trusted to deliver stable and dependable software solutions continually.&lt;/p>
&lt;h3 id="power-of-performance-the-role-of-netpoll">Power of Performance: The Role of Netpoll&lt;/h3>
&lt;p>CloudWeGo astounds with its high performance, a direct result of incorporating features like asynchronous RPC, streaming RPC, event-driven programming, high-performance non-blocking I/O networking through Netpoll, and support for protocols like HTTP/2. This powerful blend enables CloudWeGo projects to tackle demanding workloads and achieve impressive performance metrics. It marks a testament to CloudWeGo&amp;rsquo;s commitment to speed, responsiveness, and efficiency, ensuring admirable performance at an industrial production level.&lt;/p>
&lt;h3 id="flexibility-through-extensibility--interoperability">Flexibility Through Extensibility &amp;amp; Interoperability&lt;/h3>
&lt;p>A standout feature of CloudWeGo lies in its designed extensibility, allowing users to customize its functionality to suit their individual needs. CloudWeGo employs a modular or layered framework providing a set of interfaces and default implementation options.&lt;/p>
&lt;p>The layered design, evident in Kitex and Hertz, allows developers to infuse their implementations into the framework, customizing it for specific needs. This extensibility enables them to replace or enhance default implementations, adapting CloudWeGo to distinct use cases or seamless integration with other libraries and tools.&lt;/p>
&lt;p>The common open standard protocols like Thrift, HTTP and gRPC, supported by CloudWeGo, are language-independent, making it interoperable with other frameworks. Coupled with Kitex&amp;rsquo;s full support for &lt;a href="https://github.com/alibaba/hessian2-codec">Hessian2&lt;/a> protocol, it promotes interoperability with &lt;a href="https://dubbo.apache.org/en/index.html">Apache Dubbo&lt;/a> and more. This vast interoperability toolset ensures CloudWeGo&amp;rsquo;s strong presence in the cloud-native applications ecosystem, making it the ideal choice for developers on the hunt for a versatile yet powerful framework.&lt;/p>
&lt;p>By combining reliability, high performance, extensibility, and interoperability, CloudWeGo can be an invaluable asset for modern software development, setting a standard for what a comprehensive and robust framework should embody. Regardless of the complexity of the needs or the unique specifications of an application, CloudWeGo has something to offer to every developer. Our active community also ensures that the software stays relevant to the changing tech landscape, making your investment in learning and implementing CloudWeGo worthwhile.&lt;/p>
&lt;h1 id="v-real-world-use-cases-of-cloudwego">V. Real-World Use-Cases of CloudWeGo&lt;/h1>
&lt;p>CloudWeGo is designed for flexibility, managing to cater to a vast range of applications such as microservices-based applications, cloud-native applications, real-time applications, IoT applications, and more. Let&amp;rsquo;s explore some of its successful industry adoptions:&lt;/p>
&lt;h3 id="powering-the-gaming-industry">Powering the Gaming Industry&lt;/h3>
&lt;p>CloudWeGo offers a plethora of benefits for the gaming industry. The platform stands synonymous with increased scalability, optimized performance, and simplified business logic, made possible due to its resource-efficient components like rate limiting, monitoring, and service registration/discovery. Additionally, integration with OpenTelemetry offers valuable monitoring and diagnostics capabilities for developers to optimize game services and ensure an exceptional gaming experience.&lt;/p>
&lt;p>&lt;a href="https://www.tanwan.com/game/">Tanwan Games&lt;/a>, known for popular games such as &lt;a href="https://play.google.com/store/apps/details?id=com.twon.westwar">West War&lt;/a>, faced substantial technical challenges around instantaneous high concurrency during game launches, game updates, extensive data pushes from partners, and interface overloads.&lt;/p>
&lt;p>To overcome these challenges, they turned to CloudWeGo, employing the Hertz framework for HTTP services and the Kitex framework for RPC microservices. Additionally, they leveraged Nacos for service discovery and registration, OpenTelemetry for tracing, Prometheus for monitoring, and Kitex&amp;rsquo;s built-in rate-limiting strategies for traffic shaping. The tangible benefits of embracing CloudWeGo include:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Performance and stability improvement&lt;/strong>: As an example, each Pod of 1c2g succeeded in handling over 400 QPS, with the latency within the network being astonishingly low and rendering a failure rate close to 0%.&lt;/li>
&lt;li>&lt;strong>Enhanced development efficiency, simplified deployment processes, more convenient auto-scaling, increased business elasticity, and reduced costs&lt;/strong>.&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/The_Role_of_CloudWeGo_in_Modern_Cloud_Native_Applications/2.png" alt="Image">&lt;/p>
&lt;h3 id="safeguarding-the-financial-industrys-securities-products">Safeguarding the Financial Industry&amp;rsquo;s Securities&amp;rsquo; Products&lt;/h3>
&lt;p>CloudWeGo, especially through its Kitex framework, has made waves in the financial industry&amp;rsquo;s securities market as well. With the framework&amp;rsquo;s capabilities around service stress testing, efficiency, and secure communication, it became much easier for organizations to maintain stable communication between services within Kubernetes clusters.&lt;/p>
&lt;p>Let&amp;rsquo;s consider &lt;a href="https://www.huaxing.com">Huaxing Securities&lt;/a>, which utilized Kitex for developing its new business product. With carefully integrated tracing libraries for components like &lt;a href="https://gorm.io/index.html">Gorm&lt;/a>, &lt;a href="https://redis.io">Redis&lt;/a>, and &lt;a href="https://kafka.apache.org">Kafka&lt;/a>, they successfully migrated to OpenTelemetry tools like Jaeger for tracing and Prometheus for metrics monitoring. Moreover, they efficiently addressed Kitex&amp;rsquo;s different connection types in Kubernetes environments, resolving issues related to intra-cluster/cross-cluster calls, and achieved multiplexing connections along with seamless rolling upgrades.&lt;/p>
&lt;p>This meticulous implementation resulted in several evident benefits within a mere span of four months, such as rapid construction and launch of the new application, a comprehensive observability system encompassing Log, Trace, and Metrics around the Kitex RPC framework, and efficient cross-cluster invocations.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/The_Role_of_CloudWeGo_in_Modern_Cloud_Native_Applications/3.png" alt="Image">&lt;/p>
&lt;h3 id="elevating-e-commerce">Elevating E-commerce&lt;/h3>
&lt;p>The e-commerce industry faces high concurrency and performance challenges. When &lt;a href="https://semirshop.com">Semir&lt;/a> opted for Kitex as the RPC framework, they were able to significantly amplify their capacity to manage peak traffic and ensure synchronized order processing. In tandem with &lt;a href="https://istio.io">Istio&lt;/a>, they managed traffic utilizing the Ingress Gateway mesh entry management program and the VirtualService traffic handling logic, thus directing orders to a plethora of services within the mesh.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/The_Role_of_CloudWeGo_in_Modern_Cloud_Native_Applications/4.png" alt="Image">&lt;/p>
&lt;p>The benefits of integrating CloudWeGo were immediately evident:&lt;/p>
&lt;ul>
&lt;li>An improved ability to process a higher number of orders within a given timeframe.&lt;/li>
&lt;li>A shorter processing time even for a specified number of orders, with this performance gap becoming increasingly pronounced as the order volume increased.&lt;/li>
&lt;li>A substantial reduction in machine costs required to support the system.&lt;/li>
&lt;/ul>
&lt;h3 id="ai--machine-learning-implementations">AI &amp;amp; Machine Learning Implementations&lt;/h3>
&lt;p>The AI industry is host to a number of business challenges surrounding machine learning and large-scale model training scenarios. To ensure optimal GPU-related resource utilization and to contend with high costs, a shift from individual GPU clusters for each tenant to multi-tenant shared clusters became necessary. However, existing service infrastructure that was shared between tenants led to mutual performance issues, increased management costs, and a more complex system architecture.&lt;/p>
&lt;p>When it came to AI SaaS companies like &lt;a href="https://intl.ishumei.com/#HOME">NextData&lt;/a>, they embraced cloud-native technologies and Golang for rapid development and iteration, while a three-tiered microservices architecture allowed the access layer to handle user requests through HTTP with high-performance HTTP frameworks like Hertz.&lt;/p>
&lt;p>Upon deploying CloudWeGo, the access layer&amp;rsquo;s RPC client and the logical business layer&amp;rsquo;s RPC server &amp;amp; RPC client underwent refactoring with the Kitex framework, using the Thrift protocol to address limitations of the native Apache Thrift framework. Integration of services like rate limiting, circuit breaking, and overload protection allowed the system to adaptively resolve traffic-related stability issues.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/The_Role_of_CloudWeGo_in_Modern_Cloud_Native_Applications/5.png" alt="Image">&lt;/p>
&lt;p>Through case studies across diverse industries, from gaming to AI, it is evident that CloudWeGo can tackle a myriad of challenges while delivering optimal solutions, reflecting its commitment to versatility, power, and high-standard performance all in equal measure.&lt;/p>
&lt;h1 id="vi-conclusion">VI. Conclusion&lt;/h1>
&lt;p>In the exciting landscape of cloud-native application development, CloudWeGo stands out as a versatile, powerful, and adaptable solution. This post gave an overview of the project, taking us through its introduction, the critical role it plays in the industry, and its unique propositions in the world of cloud-native application development.&lt;/p>
&lt;p>We have looked at how CloudWeGo&amp;rsquo;s emphasis on interoperability, scalability, and performance makes it an outstanding choice for developers. We dug into its various features, including its frameworks and use of OpenTelemetry, providing a robust foundation for modern, cloud-based applications.&lt;/p>
&lt;p>We also unboxed the technical depth of CloudWeGo, examining how RPC like Kitex functions, and presented real-world examples of CloudWeGo implementation across various industries including gaming, financial securities, e-commerce, and AI. Each case deeply demonstrated how embracing CloudWeGo led to improved efficiency, stability, scalability, and a dramatic reduction in operational costs.&lt;/p>
&lt;p>Whether you’re a seasoned developer, a passionate gamer, or an AI enthusiast, CloudWeGo opens up a universe of possibilities, unlocking new avenues for innovation and creativity. Each success story mentioned here is a testament to CloudWeGo&amp;rsquo;s capability. A shared theme across all these cases is how CloudWeGo recognizes industry-specific challenges and addresses them with tailored, innovative solutions.&lt;/p>
&lt;p>There&amp;rsquo;s a world of cloud-native possibilities to explore, and CloudWeGo can be your companion on this journey. Dive into the unique benefits, the seamless experience, and the vast community that CloudWeGo offers. Explore CloudWeGo today and reinvent the way you develop cloud-native applications.&lt;/p></description></item><item><title>Blog: Volo Release 0.8.0</title><link>https://www.cloudwego.io/blog/2023/10/23/volo-release-0.8.0/</link><pubDate>Mon, 23 Oct 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/10/23/volo-release-0.8.0/</guid><description>
&lt;p>In Volo 0.8.0, we mainly refactored the Service trait and all previous places that used async_trait by using two newly stabilized features: AFIT (Async Fn In Trait) and RPITIT (Return Position Impl Trait In Traits). This not only brings a slight performance improvement, but also significantly enhances the usability of writing Service, as you can directly write async fn call.&lt;/p>
&lt;h2 id="break-change">Break Change&lt;/h2>
&lt;h3 id="service-trait-refactoring">Service trait refactoring&lt;/h3>
&lt;p>In the latest nightly, Rust&amp;rsquo;s two highly anticipated heavyweight features, AFIT (Async Fn In Trait) and RPITIT (Return Position Impl Trait In Traits), have been stabilized, which means that in two months, we can use volo in stable rust.&lt;/p>
&lt;p>Here&amp;rsquo;s a brief introduction to these two features:&lt;/p>
&lt;h4 id="rpitit">RPITIT&lt;/h4>
&lt;p>RPITIT means that we can now write impl trait in the return position of a function inside a trait, whereas previously we could only write it in regular functions, such as:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">fetch&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">key&lt;/span>: &lt;span style="color:#000">FastStr&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">impl&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Item&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now, we can write it directly inside a trait:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">trait&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Fetcher&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">fetch&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">key&lt;/span>: &lt;span style="color:#000">FastStr&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">impl&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Item&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="afit">AFIT&lt;/h4>
&lt;p>AFIT&amp;rsquo;s feature is that we can now define async fn directly in a trait (essentially syntactic sugar for RPITIT) and no longer need to use the #[async_trait] macro, for example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">trait&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Fetcher&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">fetch&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">key&lt;/span>: &lt;span style="color:#000">FastStr&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Item&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In fact, it&amp;rsquo;s just syntactic sugar, and the compiler will convert this async fn into the form of RPITIT mentioned above.&lt;/p>
&lt;p>For more information, please refer to: &lt;a href="https://github.com/rust-lang/rust/pull/115822">https://github.com/rust-lang/rust/pull/115822&lt;/a>&lt;/p>
&lt;h4 id="new-service-definition">New Service definition&lt;/h4>
&lt;p>The original definition of the new Service Trait is as follows:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">pub&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">trait&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Responses given by the service.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Errors produced by the service.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Process the request and return the response asynchronously.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">call&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cx&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span> &lt;span style="color:#000">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>: &lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">impl&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Send&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>A more understandable definition is as follows, and you can understand it directly:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">pub&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">trait&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Responses given by the service.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Errors produced by the service.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Process the request and return the response asynchronously.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">call&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cx&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span> &lt;span style="color:#000">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>: &lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Compared to the previous definition, the type Future associated type is removed, and the order of lifetimes in call is changed (the previous order was &lt;code>call&amp;lt;'cx, 's&amp;gt;&lt;/code>, which was a typo when it was first written, and now it&amp;rsquo;s changed back).&lt;/p>
&lt;h4 id="migration-guide">Migration Guide&lt;/h4>
&lt;ol>
&lt;li>Update Rust compiler to the latest nightly (rustup update) and all dependencies (volo, pilota, motore) to the latest version&lt;/li>
&lt;li>Run cargo check to see where the errors are, such as &amp;ldquo;type Future is not a member&amp;rdquo;, &amp;ldquo;associated type Future not found&amp;rdquo;, etc. We will use the following &lt;code>Service&lt;/code> as an example:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">impl&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Req&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">S&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Req&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">for&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">LogService&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">S&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">where&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">S&lt;/span>: &lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Req&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Send&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">&amp;#39;static&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Sync&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Cx&lt;/span>: &lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Config&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">volo_grpc&lt;/span>::&lt;span style="color:#000">context&lt;/span>::&lt;span style="color:#000">Config&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">&amp;#39;static&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Send&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Req&lt;/span>: &lt;span style="color:#204a87">Send&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">&amp;#39;static&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">S&lt;/span>::&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">S&lt;/span>::&lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">impl&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">call&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cx&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span> &lt;span style="color:#000">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>: &lt;span style="color:#000">Req&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">Self&lt;/span>::&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">where&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>: &lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">move&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tick&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">quanta&lt;/span>::&lt;span style="color:#000">Instant&lt;/span>::&lt;span style="color:#000">now&lt;/span>&lt;span style="color:#000;font-weight:bold">();&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ret&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">inner&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">call&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">elapsed&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">quanta&lt;/span>::&lt;span style="color:#000">Instant&lt;/span>::&lt;span style="color:#000">now&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#000">duration_since&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">tick&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tracing&lt;/span>::&lt;span style="color:#000">info!&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">rpc_type&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;rpcAccess&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cost&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">elapsed&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">as_micros&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">as&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">i64&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ret&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>Remove the line with &lt;code>type Future&lt;/code>&lt;/li>
&lt;li>Swap the lifetimes in &lt;code>fn call&amp;lt;'cx, 's&amp;gt;&lt;/code> and remove the &lt;code>where&lt;/code> statement below&lt;/li>
&lt;li>Add &lt;code>async&lt;/code> before &lt;code>fn call&lt;/code>, then change &lt;code>Self::Future&amp;lt;'cx&amp;gt;&lt;/code> to &lt;code>Result&amp;lt;Self::Response, Self::Error&amp;gt;&lt;/code>, and remove the &lt;code>async move&lt;/code> in the function body&lt;/li>
&lt;li>The final modified &lt;code>Service&lt;/code> is as follows:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">impl&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Req&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">S&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Req&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">for&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">LogService&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">S&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">where&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">S&lt;/span>: &lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Req&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Send&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">&amp;#39;static&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Sync&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Cx&lt;/span>: &lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Config&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">volo_grpc&lt;/span>::&lt;span style="color:#000">context&lt;/span>::&lt;span style="color:#000">Config&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">&amp;#39;static&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Send&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Req&lt;/span>: &lt;span style="color:#204a87">Send&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">&amp;#39;static&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">S&lt;/span>::&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">S&lt;/span>::&lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">call&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cx&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span> &lt;span style="color:#000">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>: &lt;span style="color:#000">Req&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tick&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">quanta&lt;/span>::&lt;span style="color:#000">Instant&lt;/span>::&lt;span style="color:#000">now&lt;/span>&lt;span style="color:#000;font-weight:bold">();&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ret&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">inner&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">call&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">elapsed&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">quanta&lt;/span>::&lt;span style="color:#000">Instant&lt;/span>::&lt;span style="color:#000">now&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#000">duration_since&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">tick&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tracing&lt;/span>::&lt;span style="color:#000">info!&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">rpc_type&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;rpcAccess&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cost&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">elapsed&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">as_micros&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">as&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">i64&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ret&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="handler-refactoring">Handler refactoring&lt;/h3>
&lt;p>In previous versions, Volo generated user handlers using async_trait for ease of use, but thanks to AFIT, we can now write async fn directly in traits, so we removed async trait (reducing one Box overhead).&lt;/p>
&lt;p>Therefore, after upgrading, you may initially encounter errors like &amp;ldquo;lifetime parameters or bounds not match&amp;rdquo;. In this case, simply remove the &lt;code>#[async_trait]&lt;/code> macro.&lt;/p>
&lt;h2 id="complete-release-note">Complete Release Note&lt;/h2>
&lt;p>For the complete Release Note, please refer to: &lt;a href="https://github.com/cloudwego/volo/compare/volo-0.5.4...volo-0.8.0">Volo Changelog&lt;/a>&lt;/p></description></item><item><title>Blog: Netpoll Release v0.5.1</title><link>https://www.cloudwego.io/blog/2023/10/18/netpoll-release-v0.5.1/</link><pubDate>Wed, 18 Oct 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/10/18/netpoll-release-v0.5.1/</guid><description>
&lt;h2 id="fix">Fix&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/289">#289&lt;/a>] fix: panic/fault when dial connection timeout&lt;/li>
&lt;/ol>
&lt;h2 id="optimise">Optimise&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/290">#290&lt;/a>] optimise: rm useless inputBarrier&lt;/li>
&lt;/ol></description></item><item><title>Blog: Kitex Release v0.7.2</title><link>https://www.cloudwego.io/blog/2023/09/27/kitex-release-v0.7.2/</link><pubDate>Wed, 27 Sep 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/09/27/kitex-release-v0.7.2/</guid><description>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="features">Features&lt;/h3>
&lt;p>&lt;strong>1. Retry: limit perncetage of retry requests&lt;/strong>&lt;/p>
&lt;p>The feature improves the usability of backup requests: if a request exceeds the retry delay threshold, a backup request will be sent; but if the request succeeds within the timeout threshold, it will not be treated as an error. Therefore large amount of backup requests may be sent due to a network jitter, which increases the pressure on the server and could even cause an avanlache.&lt;/p>
&lt;p>It&amp;rsquo;s recommended to update your current implementation:&lt;/p>
&lt;ol>
&lt;li>Initialize a RetryContainer with &lt;code>retry.NewRetryContainerWithPercentageLimit()&lt;/code> to limit the percentage of retry requests;&lt;/li>
&lt;li>Add an option &lt;code>client.WithCloseCallbacks(container.Close)&lt;/code> when initializing a client, in order to release relevant resources when the client is recycled.&lt;/li>
&lt;/ol>
&lt;h3 id="optimizations">Optimizations&lt;/h3>
&lt;p>&lt;strong>1. gRPC&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Send END_STREAM flag in unary call&lt;/li>
&lt;li>Fix grpc streaming tps decreasing and the selection logic of compressor&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>2. Long Connection Pool&lt;/strong>&lt;/p>
&lt;p>If &lt;code>MaxIdleGlobal&lt;/code> is not set, it is not limited by default, simplifying the configuration of long connection pools.&lt;/p>
&lt;h3 id="miscellaneous">Miscellaneous&lt;/h3>
&lt;ul>
&lt;li>Upgrade netpoll to &lt;a href="https://github.com/cloudwego/netpoll/releases/tag/v0.5.0">v0.5.0&lt;/a>&lt;/li>
&lt;li>Upgrade frugal to &lt;a href="https://github.com/cloudwego/frugal/releases/tag/v0.1.8">v0.1.8&lt;/a>, enable frugal when compiled on go1.21 (note: old versions of frugal are not adapted to go1.21)&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="full-release-log">Full Release Log&lt;/h2>
&lt;h3 id="feature">Feature:&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1117">#1117&lt;/a>] feat(retry): support retry percentage limit&lt;/li>
&lt;/ul>
&lt;h3 id="optimize">Optimize:&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1033">#1033&lt;/a>] optimize: no need to check svcInfo twice&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1115">#1115&lt;/a>] optimize: rm outdated framed suggestion&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1095">#1095&lt;/a>] optimize: add K_METHOD in serviceinline ctx&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1107">#1107&lt;/a>] optimize(connpool): set maxIdleGlobal to no limit if not set&lt;/li>
&lt;/ul>
&lt;h3 id="fix">Fix:&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1116">#1116&lt;/a>] fix: use the last rpcinfo to trace&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1104">#1104&lt;/a>] fix: move limiter handler to the last of the inbound handler to get rpcinfo in custom limiter&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1103">#1103&lt;/a>] fix: reset all fields of netpoll byte buffer when recycle it&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1106">#1106&lt;/a>] fix(grpc): fix grpc streaming tps decreasing and the selection logic of compressor&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1114">#1114&lt;/a>] fix(gRPC): client send END_STREAM flag in unary call (#1066)&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1096">#1096&lt;/a>] fix(tool): add backquote to handle filepath string invalid syntax under windows os&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1098">#1098&lt;/a>] fix(tool): fix import for codegen template when using slim and unknown fields&lt;/li>
&lt;/ul>
&lt;h3 id="tests">Tests:&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1124">#1124&lt;/a>] test: fix codegen script&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1122">#1122&lt;/a>] test: add codegen test&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1119">#1119&lt;/a>] test(connpool): modify the idleTimeout&lt;/li>
&lt;/ul>
&lt;h2 id="chore">Chore:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1133">#1133&lt;/a>] chore: update version v0.7.2&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1125">#1125&lt;/a>] chore: upgrade netpoll to v0.5.0&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1123">#1123&lt;/a>] perf: replace concurrent string builder with lock&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1118">#1118&lt;/a>] perf: optimize remote addr setter interface to reduce lock cost of Address()&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1110">#1110&lt;/a>] chore: upgrade netpoll to v0.4.2 pre-release&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1061">#1061&lt;/a>] chore: netpoll pre release v0.4.2&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1100">#1100&lt;/a>] chore: enable frugal on go1.21&lt;/li>
&lt;/ul></description></item><item><title>Blog: Netpoll Release v0.5.0</title><link>https://www.cloudwego.io/blog/2023/09/26/netpoll-release-v0.5.0/</link><pubDate>Tue, 26 Sep 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/09/26/netpoll-release-v0.5.0/</guid><description>
&lt;h2 id="optimize">Optimize&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/274">#274&lt;/a>] optimize: increase first bookSize to 8KB to reduce overhead for connection read at begin&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/273">#273&lt;/a>] optimize: ignore EOF when read a closed connection&lt;/li>
&lt;/ol>
&lt;h2 id="fix">Fix&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/283">#283&lt;/a>] fix: protect operator dont be detach twice&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/280">#280&lt;/a>] fix: detach operator race&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/278">#278&lt;/a>] fix: OnRequest should wait all readable data consumed when sender close connection&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/276">#276&lt;/a>] fix: compile error by miss package&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/238">#238&lt;/a>] fix: close conn when server OnRequest panic&lt;/li>
&lt;/ol>
&lt;h2 id="docs">Docs&lt;/h2>
&lt;ol>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/243">#243&lt;/a>] docs: rm outdated info&lt;/li>
&lt;/ol></description></item><item><title>Blog: Hertz Release v0.7.0</title><link>https://www.cloudwego.io/blog/2023/09/26/hertz-release-v0.7.0/</link><pubDate>Tue, 26 Sep 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/09/26/hertz-release-v0.7.0/</guid><description>
&lt;p>In version 0.7.0 of Hertz, in addition to regular iterative optimization, we also brought several important features.&lt;/p>
&lt;h2 id="refactor-binding">Refactor Binding&lt;/h2>
&lt;p>In version 0.7.0 of Hertz，we refactored the binding feature for Hertz&lt;/p>
&lt;blockquote>
&lt;p>&lt;a href="https://github.com/cloudwego/hertz/pull/541">https://github.com/cloudwego/hertz/pull/541&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="description-of-refactoring">Description Of Refactoring&lt;/h3>
&lt;p>In version 0.7.0 of Hertz，we refactored the binding feature for Hertz to better support user requirements。This refactoring has the following characteristics:&lt;/p>
&lt;ul>
&lt;li>Consistent functionality:
&lt;ul>
&lt;li>Binder: After the refactoring, we have implemented a default Binder within Hertz, which has the same functionality as before. The previous binding capabilities have been implemented as extensions under hertz-contrib.&lt;/li>
&lt;li>Validator: We are still using go-tagexpr as the default implementation to ensure consistent functionality.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Converged configuration:
&lt;ul>
&lt;li>Before the refactoring, the behavior of parameter binding was mostly configured through global parameters, which could lead to conflicts when multiple components were configured.&lt;/li>
&lt;li>After the refactoring, the binding and validation configurations are injected into the Hertz Engine through &lt;code>BindConfig&lt;/code> and &lt;code>ValidateConfig&lt;/code> struct using the &amp;lsquo;WithOption&amp;rsquo; function. This not only unifies the configuration format but also avoids configuration conflicts.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Customizable Binder and Validator:
&lt;ul>
&lt;li>Custom Binder: You can use &amp;ldquo;WithCustomBinder&amp;rdquo; to inject your own custom Binder. We have already provided an extension called hertz-contrib/binding/go_tagexpr.&lt;/li>
&lt;li>Custom Validator: You can use &amp;ldquo;WithCustomValidator&amp;rdquo; to inject your own custom Validator. We have also extended go-playground/validator for this purpose.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Performance improvements: The refactoring has resulted in improved binding performance compared to the previous version. Please refer to the benchmark data below for more details.&lt;/li>
&lt;/ul>
&lt;h3 id="usage">Usage&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">package&lt;/span> &lt;span style="color:#000">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/hertz/pkg/app/server/binding&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;github.com/cloudwego/hertz/pkg/app/server&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">bindConfig&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">binding&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewBindConfig&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">bindConfig&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">LooseZeroMode&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">h&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">server&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">New&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">server&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">WithBindConfig&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">bindConfig&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ce5c00;font-weight:bold">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">h&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Spin&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="benchmark-data">Benchmark Data&lt;/h3>
&lt;p>&lt;a href="https://github.com/cloudwego/hertz-benchmark/tree/main/binding">https://github.com/cloudwego/hertz-benchmark/tree/main/binding&lt;/a>&lt;/p>
&lt;h2 id="full-release-note">Full Release Note&lt;/h2>
&lt;p>The complete Release Note can refer to:&lt;/p>
&lt;ul>
&lt;li>Hertz: &lt;a href="https://github.com/cloudwego/hertz/releases/tag/v0.7.0">https://github.com/cloudwego/hertz/releases/tag/v0.7.0&lt;/a>&lt;/li>
&lt;li>Hz(scaffolding): &lt;a href="https://github.com/cloudwego/hertz/releases/tag/cmd%2Fhz%2Fv0.7.0">https://github.com/cloudwego/hertz/releases/tag/cmd%2Fhz%2Fv0.7.0&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Blog: Kitex Release v0.7.0</title><link>https://www.cloudwego.io/blog/2023/08/14/kitex-release-v0.7.0/</link><pubDate>Mon, 14 Aug 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/08/14/kitex-release-v0.7.0/</guid><description>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="features">Features&lt;/h3>
&lt;p>&lt;strong>1. gRPC Compression Support&lt;/strong>&lt;/p>
&lt;p>Implemented compression support for Kitex gRPC, allowing compression methods like gzip to reduce payload size.&lt;/p>
&lt;p>&lt;strong>2. GLS (Goroutine Local Storage)&lt;/strong>&lt;/p>
&lt;p>Utilized the &lt;a href="https://github.com/cloudwego/localsession">local-session&lt;/a> component for context propagation in fallback requests, addressing the issue of broken microservice chains caused by missing ctx.&lt;/p>
&lt;h3 id="optimizations">Optimizations&lt;/h3>
&lt;p>&lt;strong>1. Unserialized Unknown Fields&lt;/strong>&lt;/p>
&lt;p>Implemented unserialization of unknown fields, resulting in a performance improvement of approximately 6x to 7x on FastCodec. See details in &lt;a href="https://github.com/cloudwego/kitex/pull/1017">#1017&lt;/a>.&lt;/p>
&lt;p>&lt;strong>2. Integration with DynamicGo&lt;/strong>&lt;/p>
&lt;p>Integrated &lt;a href="https://github.com/cloudwego/dynamicgo">dynamicgo&lt;/a> into Kitex&amp;rsquo;s generic module to enhance performance of JSON/HTTP generic invocations (+50% to 200%).&lt;/p>
&lt;h3 id="others">Others&lt;/h3>
&lt;p>Upgraded Thriftgo library dependency to v0.3.0, adding support for Thriftgo reflection, enabling runtime access to IDL metadata.&lt;/p>
&lt;hr>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h3 id="feature">Feature:&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1053">#1053&lt;/a>] feat(retry): support to distinguish local retry request&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1058">#1058&lt;/a>] feat(retry): support delete retry policy dynamically&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1000">#1000&lt;/a>] feat(grpc): support grpc compress&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1018">#1018&lt;/a>] feat: use local-session to backup request context in case of missing&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1045">#1045&lt;/a>] feat(generic): support base64 codec for map generic&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1035">#1035&lt;/a>] feat(config): provide the ability to dynamically configure the rpctimeout config on the method hierarchy&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/825">#825&lt;/a>] feat(generic): integrate dynamicgo into kitex generic call&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1019">#1019&lt;/a>] feat(lb): interleaved weighted round-robin load balancer&lt;/li>
&lt;/ul>
&lt;h3 id="optimize">Optimize:&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1064">#1064&lt;/a>] optimize: check header max size when ttheader encode&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1017">#1017&lt;/a>] optimize: implement unknown field function without serialization&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1036">#1036&lt;/a>] optimize(protobuf): ignore err when (un)marshal empty req/resp&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1056">#1056&lt;/a>] optimize(tool): optimize struct ref&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1043">#1043&lt;/a>] optimize: add method info to the error message of the server handler panic for easy troubleshooting&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1025">#1025&lt;/a>] optimize: use Tags of ServerBasicInfo as default Tags of RegistryInfo&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1020">#1020&lt;/a>] optimize: add nil check for MethodInfo which get from ServiceInfo in client.Call to ignore panic&lt;/li>
&lt;/ul>
&lt;h3 id="fix">Fix:&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1073">#1073&lt;/a>] fix: fix failure retryer dump panic&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1067">#1067&lt;/a>] fix: slim template with deepcopy&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1055">#1055&lt;/a>] fix: ignore SIGHUP when run with nohup&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1048">#1048&lt;/a>] fix(retry): keep the behavior of retry policy consistent between initing and updating&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1047">#1047&lt;/a>] fix(tool): cli warning for unknown suffix&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1038">#1038&lt;/a>] fix(config): correct the function signature of the rpcinfo.TimeoutProvider implementation&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1034">#1034&lt;/a>] fix(generic): add case int16 into buildinTypeIntoString&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1023">#1023&lt;/a>] fix(generic): avoid dead-loop when marshal self-referenced struct&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1028">#1028&lt;/a>] fix:modify .licenserc.yaml&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1012">#1012&lt;/a>] fix: skip frugal on go 1.21&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/992">#992&lt;/a>] fix(grpc): use mcache to fix memory leak caused by grpc codec buffer to reuse memory incorrectly&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/994">#994&lt;/a>] fix(tool): fix kitex tool git repo pulling logic&lt;/li>
&lt;/ul>
&lt;h3 id="chore">Chore:&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1074">#1074&lt;/a>] chore: update thriftgo to v0.3.0&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1031">#1031&lt;/a>] chore: remove wechat group in readme&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1008">#1008&lt;/a>] chore: update dynamicgo to v0.1.1&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1006">#1006&lt;/a>] chore: remove unnecessary replace for frugal&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/1007">#1007&lt;/a>] chore: upgrade netpoll to v0.4.1&lt;/li>
&lt;/ul></description></item><item><title>Blog: Kitex Release v0.6.1</title><link>https://www.cloudwego.io/blog/2023/06/19/kitex-release-v0.6.1/</link><pubDate>Mon, 19 Jun 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/06/19/kitex-release-v0.6.1/</guid><description>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h2 id="hotfix">Hotfix:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/988">#988&lt;/a>] hotfix(code_gen): fix the problem of code generation with slim template failure&lt;/li>
&lt;/ul></description></item><item><title>Blog: CloudWeGo: A leading practice for building enterprise cloud native middleware!</title><link>https://www.cloudwego.io/blog/2023/06/15/cloudwego-a-leading-practice-for-building-enterprise-cloud-native-middleware/</link><pubDate>Thu, 15 Jun 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/06/15/cloudwego-a-leading-practice-for-building-enterprise-cloud-native-middleware/</guid><description>
&lt;h2 id="cloudwego-overview">CloudWeGo Overview&lt;/h2>
&lt;p>&lt;a href="https://www.cloudwego.io/">CloudWeGo&lt;/a> is a set of microservices middleware developed by ByteDance that can be used to quickly build enterprise-class cloud-native architectures. It is a collection of high-performance, high-extensible, and highly-reliable projects that are focused on microservices communication and governance. It contains many components, including the RPC framework &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a>, the HTTP framework &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a>, the basic network library Netpoll, inter-process communication library &lt;a href="https://github.com/cloudwego/shmipc-go">shmipc&lt;/a>, Rust-based RPC framework &lt;a href="https://github.com/cloudwego/volo">Volo&lt;/a> etc.&lt;/p>
&lt;h2 id="cloudwego-background">CloudWeGo Background&lt;/h2>
&lt;p>ByteDance uses Golang as its main development language, and supports the reliable communication of tens of thousands of Golang microservices. With our experience in microservices having undergone a massive traffic, we decided to offer open source software in order to enrich the community’s ecology and launched CloudWeGo in September 2021. CloudWeGo is not only an external open source project, but also a real ultra-large-scale enterprise-level project. We are looking forward to enriching the Golang product system of the cloud native community through CloudWeGo and helping other companies to build cloud-native architectures in a rapid and convenient way. We also hope to attract developers in the open source community, to maintain and improve this project together, provide support for multiple scenarios, and enrich product capabilities. Because the projects under CloudWeGo depend on many internal basic tool libraries, we also open sourced the basic Golang tool libraries used internally, and maintain them in &lt;a href="https://github.com/bytedance/gopkg">bytedance/gopkg&lt;/a>.&lt;/p>
&lt;p>Another language that we are committed to advancing is the Rust language that delivers exceptional performance, safety, and low-level control capabilities. Through our open-source projects and contributions, ByteDance aims to provide developers, enterprises, and Rustaceans with robust support in developing RPC microservices and building cloud-native distributed systems. ByteDance&amp;rsquo;s contribution includes the development of Volo, a lightweight, high-performance, scalable, and user-friendly Rust RPC framework. Leveraging the latest features of Rust, Volo showcases exceptional performance and efficiency. ByteDance has extensively used Volo within its own infrastructure, implementing multiple business and foundational components, surpassing expectations and highlighting its superiority compared to similar solutions written in other languages. Another project is Monoio, a thread-per-core Rust runtime with io_uring/epoll/kqueue. Monoio is designed to offer maximum efficiency and performance by leveraging advanced features of Rust and a unique IO abstraction that minimizes copying. Its inclusion within CloudWeGo ensures robust support for various scenarios and enhances the overall capabilities of the project.&lt;/p>
&lt;p>ByteDance&amp;rsquo;s dedication to Rust extends beyond Volo and Monoio. Through our commitment to simplicity and user-friendly tools, such as the Volo command-line tool, ByteDance actively contributes to lowering the barriers for developers to adopt Rust and leverage its full potential.&lt;/p>
&lt;h2 id="key-features">Key Features&lt;/h2>
&lt;p>Some of the key features of CloudWeGo include:&lt;/p>
&lt;h3 id="high-performance">&lt;strong>High performance&lt;/strong>:&lt;/h3>
&lt;p>Highly performant nature of CloudWeGo projects stems from our implementation of asynchronous RPC, streaming RPC, event-driven programming, and support for protocols like HTTP/2. These design choices and features work together to deliver superior speed, responsiveness, and efficiency, enabling CloudWeGo projects to handle demanding workloads and achieve excellent performance benchmarks.&lt;/p>
&lt;h3 id="high-extensibility">&lt;strong>High extensibility&lt;/strong>:&lt;/h3>
&lt;p>CloudWeGo is designed to allow users to customize and expand its functionality according to their specific requirements. CloudWeGo achieves this by providing a modular or layered design that offers a set of interfaces and default implementation options. By utilizing a modular design, CloudWeGo, as seen in Kitex and Hertz, allows users to extend or inject their own implementations into the framework. This means that developers have the flexibility to tailor the behavior of the framework to suit their needs. They can replace or enhance default implementations with their own custom implementations, enabling them to adapt CloudWeGo to specific use cases or integrate seamlessly with other libraries and tools.&lt;/p>
&lt;h3 id="high-reliability">&lt;strong>High reliability&lt;/strong>:&lt;/h3>
&lt;p>CloudWeGo prioritizes stability and dependability in its projects, providing a reliable framework for developers and enterprises. Through rigorous quality assurance, including code review and testing, potential issues are identified and addressed early on before they impact production environments. CloudWeGo as a whole emphasizes the prevention of any potential losses or disruptions. This is achieved through careful PR integration, extensive testing, and continuous monitoring. CloudWeGo optimizes projects to handle high workloads, ensuring stability and reliability even under heavy load. Feedback from the community helps drive improvements and prompt issue resolution. By adhering to strict quality standards, CloudWeGo projects strive to deliver stable and reliable software.&lt;/p>
&lt;h3 id="microservices-communication-and-governance">&lt;strong>Microservices communication and governance&lt;/strong>:&lt;/h3>
&lt;p>CloudWeGo&amp;rsquo;s Governance feature encompasses service governance modules such as service registry, discovery, load balancing, circuit breaker, rate limiting, retry, monitoring, tracing, logging, and diagnosis. These modules enhance the management, control, and reliability of services within the CloudWeGo framework. They enable dynamic service discovery, load distribution, fault tolerance, performance optimization, and comprehensive monitoring and diagnostics. The Governance feature ensures efficient and reliable service operations in the CloudWeGo ecosystem.&lt;/p>
&lt;p>Here are some of the benefits of using CloudWeGo:&lt;/p>
&lt;ul>
&lt;li>Speed: CloudWeGo offers the ability to accelerate application development by providing a set of pre-built components and libraries. These components and libraries provide essential functionalities, such as networking, database integration, security, and more. They are designed to be easily integrated into applications, reducing the need for building complex functionalities from scratch. With CloudWeGo&amp;rsquo;s speedy development ecosystem, developers can focus on their application&amp;rsquo;s core logic, leverage existing components, and deliver robust solutions in a shorter timeframe. This enables faster time-to-market, increased development efficiency, and ultimately enhances the overall speed of application development.&lt;/li>
&lt;li>Cost savings: By adopting CloudWeGo and its projects such as Kitex, Hertz, Sonic, and others, users can benefit from significant cost savings. This is achieved through reduced CPU and memory consumption compared to older frameworks or similar projects. CloudWeGo&amp;rsquo;s modern framework is designed to be highly optimized and efficient, resulting in minimized software development overhead. Internally at ByteDance, we moved to using the modern high-performance framework that has proven instrumental in saving substantial resources. With CloudWeGo, users can optimize their resource allocation and achieve cost efficiency while leveraging the powerful capabilities and features provided by the framework.&lt;/li>
&lt;li>Security: CloudWeGo prioritizes security, offering a range of features and measures to ensure application security. The framework incorporates secure design principles, implementing industry best practices. It provides built-in authentication and authorization mechanisms for secure user access control. By leveraging the Rust programming language, CloudWeGo benefits from its inherent security advantages, such as strong type safety and memory safety, reducing the risk of common vulnerabilities. The open-source nature of CloudWeGo allows for community contributions and wider security audits, ensuring continuous improvement and prompt vulnerability mitigation. With CloudWeGo, developers can build applications with confidence, knowing that security is prioritized at every level of the framework.&lt;/li>
&lt;/ul>
&lt;h2 id="use-cases">Use Cases&lt;/h2>
&lt;p>CloudWeGo can be used to build a variety of applications, including microservices-based applications, cloud-native applications, real-time applications, IoT applications, and other applications.
Some of the applications include:&lt;/p>
&lt;ul>
&lt;li>Microservices-based applications: CloudWeGo provides a comprehensive set of features for microservices communication and governance, such as service discovery, routing, and orchestration. This makes it easy to build and manage microservices-based applications.&lt;/li>
&lt;li>Cloud-native applications: CloudWeGo is designed to be used in cloud-native environments. It can be used to build applications that are scalable, reliable, and secure.&lt;/li>
&lt;li>Real-time applications: CloudWeGo supports streaming and asynchronous messaging. This makes it a good choice for building real-time applications, such as chat applications and streaming media applications.&lt;/li>
&lt;li>Other applications: CloudWeGo can be used to build a variety of other applications, such as web applications, mobile applications, gaming applications and enterprise applications. Let&amp;rsquo;s explore some of the industry adoption:
&lt;ul>
&lt;li>&lt;strong>Gaming&lt;/strong>: CloudWeGo offers several benefits for the gaming industry. It enables game developers to scale their infrastructure to handle increased player demands, optimize performance, and simplify their business logic through service splitting. With components like current limiting, monitoring, and service registration/discovery, CloudWeGo ensures efficient resource utilization, enhanced responsiveness, and seamless coordination between game components. Additionally, the integration with OpenTelemetry provides valuable monitoring and diagnostics capabilities for developers to optimize their game services and deliver an exceptional gaming experience. Overall, CloudWeGo empowers the gaming industry by providing a scalable, efficient, and streamlined infrastructure for game development and operations.&lt;/li>
&lt;li>&lt;strong>Security&lt;/strong>: In the security industry, CloudWeGo&amp;rsquo;s adoption, specifically through the Kitex framework, brings significant benefits. Organizations can establish observability systems to monitor and analyze the performance of security services. This enables the identification of potential issues and ensures smooth operation. CloudWeGo also offers solutions for service stress testing, allowing organizations to optimize performance and ensure stability during high-load scenarios. Additionally, CloudWeGo addresses challenges related to different connection types within Kubernetes clusters, enabling efficient and secure communication between services. The framework provides specific solutions tailored to the security industry, helping organizations overcome obstacles and optimize their security infrastructure effectively.&lt;/li>
&lt;li>&lt;strong>E-commerce&lt;/strong>: CloudWeGo&amp;rsquo;s Kitex framework offers a powerful solution for e-commerce companies dealing with high-concurrency and high-performance challenges. By integrating Kitex with technologies like Istio, businesses can significantly improve their ability to handle peak traffic and ensure synchronized order processing. This enables efficient communication with multiple e-commerce platforms and prevents issues like overselling. The adoption of CloudWeGo and Kitex, along with the use of a cloud-native service mesh like Istio, enhances the overall performance, scalability, and reliability of e-commerce systems, providing businesses with a competitive edge in the rapidly evolving e-commerce industry.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;p>To begin your journey with CloudWeGo projects, you can refer to our &lt;a href="https://www.cloudwego.io/docs/">comprehensive documentation&lt;/a>, which provides step-by-step instructions. Additionally, we regularly publish insightful blogs on various topics, including the latest innovations in &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a>, &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a>, &lt;a href="https://www.cloudwego.io/blog/2023/04/17/introducing-monoio-a-high-performance-rust-runtime-based-on-io-uring/">Monoio&lt;/a>, &lt;a href="https://github.com/cloudwego/shmipc-go">Shmipc&lt;/a>, and &lt;a href="https://github.com/cloudwego/volo">Volo&lt;/a>. We also publish best practices blogs and have a dedicated blog that explores best practices for using &lt;a href="https://www.cncf.io/blog/2023/01/11/kitex-proxyless-practice-traffic-lane-implementation-with-istio-and-opentelemetry/">Kitex without a proxy&lt;/a>. These resources serve as valuable references to help you make the most of CloudWeGo&amp;rsquo;s offerings and stay up-to-date with the latest developments in the ecosystem.&lt;/p>
&lt;h2 id="contributing">Contributing&lt;/h2>
&lt;p>The CloudWeGo project is subdivided into subprojects under:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a> (Kitex &amp;amp; Kitex ecosystem &amp;amp; kitex-contrib)&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> (Hertz &amp;amp; Hertz ecosystem &amp;amp; hertz-contrib)&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudwego/netpoll">Netpoll&lt;/a> (Netpoll &amp;amp; Netpoll ecosystem)&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudwego/shmipc-go">Shmipc&lt;/a> (shmipc-spec &amp;amp; shmipc-go)&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudwego/volo">Volo&lt;/a> (Volo &amp;amp; Volo ecosystem &amp;amp; volo-rs &amp;amp; Motore &amp;amp; Pilota)&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudwego/community">Website &amp;amp; Docs&lt;/a> (cloudwego.github.io &amp;amp; community)&lt;/li>
&lt;/ul>
&lt;p>Kitex is equipped with built-in governance strategies and expansion interfaces for frictionless integration into the microservice system. Hertz is a Go HTTP framework with high-performance and strong-extensibility for building micro-services. Netpoll is aimed at scenarios that demand high performance on RPC scenarios. Shmipc is a high performance inter-process communication library, built on Linux&amp;rsquo;s shared memory technology and uses unix or tcp connection to do process synchronization and finally implements zero copy communication across inter-processes. Volo is a high-performance and strong-extensibility Rust RPC framework that helps developers build microservices. Each component of CloudWeGo can be used separately.&lt;/p>
&lt;p>We welcome you to &lt;a href="https://github.com/cloudwego/community/blob/main/CONTRIBUTING.md">contribute&lt;/a> by submitting issues and PRs to build CloudWeGo together. Contributing to CloudWeGo involves various roles and responsibilities within the project&amp;rsquo;s GitHub organization. The roles include Member, Committer, Reviewer, Approver, and Maintainer. Members are active contributors in the community and are expected to participate in discussions and make multiple contributions to the project. Committers are active code contributors and play a role in reviewing and approving code contributions. Reviewers have expertise in the codebase and provide feedback on contributions. Approvers review and approve code contributions, ensuring their holistic acceptance. Maintainers are responsible for setting technical direction, making design decisions, and ensuring the overall health of a subproject. The responsibilities and privileges of each role vary, but they all contribute to the growth and success of CloudWeGo. The responsibilities of contributor roles in CloudWeGo are outlined in our &lt;a href="https://github.com/cloudwego/community/blob/main/COMMUNITY_MEMBERSHIP.md">community membership document&lt;/a>.&lt;/p>
&lt;p>We are excited for more developers to join, and also look forward to CloudWeGo helping more and more companies quickly build cloud-native architectures. Feel free to raise an issue in &lt;a href="https://github.com/cloudwego">Github&lt;/a> if you have any questions. Furthermore, you can join our &lt;a href="https://discord.gg/jceZSE7DsW">Discord&lt;/a> to keep updated with the latest news.&lt;/p>
&lt;h2 id="community-and-support">Community and Support&lt;/h2>
&lt;p>At ByteDance, we try to make the projects friendly to external users, and our internal projects will also use this open source project as a library for iterative development. CloudWeGo follows a key principle of maintaining one set of code internally and externally, iterating them as a whole. It has been gratifying to see Kitex gain 6000 stars, Hertz gain 3800+ stars and Netpoll gain 3600+ stars since its launch. More about all these projects can be found under our &lt;a href="https://github.com/cloudwego">cloudwego github repository&lt;/a>.&lt;/p>
&lt;h3 id="maintenance">Maintenance&lt;/h3>
&lt;p>A complete microservice system builds upon a basic cloud ecosystem. No matter how the microservices are developed; based on the public cloud, a private cloud or your own infrastructure, additional services (including service governance platform, monitoring, tracing, service registry and discovery, configuration and service mesh etc) and some customized standards are needed to provide better service governance. At Bytedance, we have complete internal services to support the microservice system, but these services can not be open sourced in the short term. So, how will CloudWeGo maintain a set of codes internally and externally, and iterate them as a whole?&lt;/p>
&lt;p>Projects in CloudWeGo are not coupled with internal ecosystem. For example, Netpoll is directly migrated to open source libraries, and our internal dependencies are adjusted to open source libraries. Kitex’s code is split into two parts, including the core of Kitex which has been migrated to the open source library, and the encapsulated internal library which will provide transparent upgrades for internal users. For open source users who use Kitex, they can also extend Kitex and integrate Kitex into their own microservice system. We hope, and expect, that more developers will contribute their own extensions to &lt;a href="https://github.com/kitex-contrib">kitex-contrib&lt;/a>, &lt;a href="https://github.com/hertz-contrib">hertz-contrib&lt;/a> and &lt;a href="https://github.com/volo-rs">volo-rs&lt;/a> providing help and convenience for more users.&lt;/p>
&lt;h2 id="conclusion">Conclusion&lt;/h2>
&lt;p>CloudWeGo is a rapidly growing project with a large and active community. It is a great choice for developers who are looking to build enterprise-class cloud native applications. If you are looking for a high-performance, extensible, and reliable middleware solution for your cloud native applications, then CloudWeGo is a great choice.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/logo.png" alt="image">&lt;/p></description></item><item><title>Blog: Netpoll Release v0.4.0</title><link>https://www.cloudwego.io/blog/2023/06/14/netpoll-release-v0.4.0/</link><pubDate>Wed, 14 Jun 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/06/14/netpoll-release-v0.4.0/</guid><description>
&lt;h2 id="feature">Feature:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/249">#249&lt;/a>] feat: add Detach function to support detach connection from its poller&lt;/li>
&lt;/ul>
&lt;h2 id="optimize">Optimize:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/250">#250&lt;/a>] optimize: WriteDirect implementation to avoid panic and duplicate creation of redundant LinkBufferNode when remainLen is 0&lt;/li>
&lt;/ul>
&lt;h2 id="bugfix">Bugfix:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/256">#256&lt;/a>] fix: close the poll that has already been created when calling the openPoll fails&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/251">#251&lt;/a>] fix: err to e0&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/226">#226&lt;/a>] fix: poller read all data before connection close&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/237">#237&lt;/a>] fix: shard queue state closed mistake&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/189">#189&lt;/a>] fix: close connection when readv syscall return 0, nil&lt;/li>
&lt;/ul>
&lt;h2 id="refactor">Refactor&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/233">#233&lt;/a>] refactor: simplify race and norace event loop&lt;/li>
&lt;/ul></description></item><item><title>Blog: Kitex Release v0.6.0</title><link>https://www.cloudwego.io/blog/2023/06/14/kitex-release-v0.6.0/</link><pubDate>Wed, 14 Jun 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/06/14/kitex-release-v0.6.0/</guid><description>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="feature">&lt;strong>Feature&lt;/strong>&lt;/h3>
&lt;p>&lt;strong>1. GRPC Metainfo Pass Through&lt;/strong>&lt;/p>
&lt;p>The gRPC client sets the header to ctx by default, and external methods can use &lt;code>GetHeaderMetadataFromCtx&lt;/code> to obtain meta information. It can be used to obtain meta information within transmeta and set it to rpcinfo, or to obtain header information within middlewares.&lt;/p>
&lt;p>&lt;strong>2. Kitex configuration module refactoring&lt;/strong>&lt;/p>
&lt;p>Added config items for retry, circuit breaker, timeout, and flow limiting to support [configmanager] (&lt;a href="https://github.com/cloudwego/configmanager">https://github.com/cloudwego/configmanager&lt;/a>) Middleware defined interfaces to support extended integration with external configuration centers.&lt;/p>
&lt;p>&lt;strong>3. Kitex - Tools&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Support for inserting deep copy function of an object in thrift generation code for deep copying source objects to destination objects. The use method is to add &lt;code>-deep-copy-api&lt;/code> parameter to the kitex command;&lt;/li>
&lt;li>Support for inserting IDL descriptor registration code into thrift generation code, which is used to register IDL descriptor information into the &lt;code>github.com/cloudwego/kitex/pkg/reflection/thrift&lt;/code> package after loading the corresponding generated code at runtime, and obtain descriptor information through the exposed functions. The use method is to add &lt;code>generate-reflection-info=true&lt;/code> to the &lt;code>thrift&lt;/code> parameter of kitex command, such as &lt;code>kitex -thrift generate-reflection-info=true&lt;/code>&amp;hellip; Kitex only supports IDL descriptor information registration in v1.12.0, richer query interfaces will be released in subsequent versions, and IDL descriptor registration function generation will also be modified to default generation.&lt;/li>
&lt;/ul>
&lt;h3 id="optimization">&lt;strong>Optimization&lt;/strong>&lt;/h3>
&lt;p>&lt;strong>1. Refactor the detection server to support detection of multiple protocols&lt;/strong>&lt;/p>
&lt;p>The old version of the detection server only supports http2 as the detection protocol. The v1.12.0 version supports users to pass-in the &lt;code>remote.ServerTransHandlerFactory&lt;/code> corresponding to the &lt;code>remote.ServerTransHandler&lt;/code> which implement &lt;code>detection.DetectableServerTransHandler&lt;/code> interface as indefinite parameters, and cooperate with the default &lt;code>remote.ServerTransHandler&lt;/code> to handle unmatched protocols to achieve a Kitex Server compatible with multiple protocols.&lt;/p>
&lt;p>&lt;strong>2. Consistency hash&lt;/strong>&lt;/p>
&lt;p>Function &lt;code>buildVirtualNodes&lt;/code> in Kitex consistency hash load balancer uses &lt;code>virtualFactorLen&lt;/code> to initialize a bytes array, and there may be insufficient space to accommodate the VirtualNodeLen number, resulting in the address part being overwritten.&lt;/p>
&lt;p>&lt;strong>3. Long Connection Pool Metrics&lt;/strong>&lt;/p>
&lt;p>Fix the issue that the records that long connection pool reuses connections successfully didn&amp;rsquo;t report.&lt;/p>
&lt;h3 id="other">&lt;strong>Other&lt;/strong>&lt;/h3>
&lt;p>Upgrade netpoll library dependency to v0.4.0 and support for [configmanager] ( &lt;a href="https://github.com/cloudwego/configmanager">https://github.com/cloudwego/configmanager&lt;/a> ) v0.2.0.&lt;/p>
&lt;hr>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h2 id="feature-1">Feature:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/923">#923&lt;/a>] feat(grpc): grpc client set header and trailer to context by default and provide api to get header from ctx&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/891">#891&lt;/a>] feat: support to service-inline rpc client and server, which can transfer the rpc call as func call. The feature needs to be used with the generation tool&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/946">#946&lt;/a>] feat: default server handler support executing Read function by trans pipeline&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/936">#936&lt;/a>] feat(config): add config items for retry/cb/rcptimeout/limiter&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/924">#924&lt;/a>] [&lt;a href="https://github.com/cloudwego/kitex/pull/939">#939&lt;/a>] feat(code_gen): support generating deepcopy apis&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/926">#926&lt;/a>] feat: support thrift reflection info registry&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/897">#897&lt;/a>] feat: support loop_service in custom template&lt;/li>
&lt;/ul>
&lt;h2 id="optimize">Optimize:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/961">#961&lt;/a>] optimize(tool): optimize kitex tool tpl with -use param&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/966">#966&lt;/a>] optimize(ttheader): add type check for headerFlags of TTheader&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/919">#919&lt;/a>] optimize: replace go func with GoFunc to avoid panic&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/960">#960&lt;/a>] optimize: make stats package public to reuse it in expanded repo&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/955">#955&lt;/a>] optimize: remove redundant onRead error log in gonet transerver&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/954">#954&lt;/a>] optimize: dont return error when transHandler not implement graceful shutdown&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/941">#941&lt;/a>] optimize(callopt): optimize the debug info of callopt to reduce the possibility of slice grow&lt;/li>
&lt;/ul>
&lt;h2 id="fix">Fix:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/963">#963&lt;/a>] fix(generic): generic-map writeInt8 fails on byte&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/901">#901&lt;/a>] fix(mux): mux connection asynccallback dont create new goroutine and server wait all crrst packets received by client&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/921">#921&lt;/a>] fix(loadbalance): fix consisthash byte[] length&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/922">#922&lt;/a>] fix(mux): fix the problem that output unreasonable error when exit if enable mux and use Kitex Protobuf&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/927">#927&lt;/a>] fix(connpool): long connection pool reports reuse success using reporter&lt;/li>
&lt;/ul>
&lt;h2 id="refactor">Refactor:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/958">#958&lt;/a>] refactor(errorHandler): refactor the definition of error handler to get more information to handle error&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/943">#943&lt;/a>] refactor(client): refactor client.Call to improve readability&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/560">#560&lt;/a>] refactor: refactor server detection trans handler to support custom registration&lt;/li>
&lt;/ul>
&lt;h2 id="tests">Tests:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/900">#900&lt;/a>] test(generic): add thrift reflection (using dynamicgo) generic call example&lt;/li>
&lt;/ul>
&lt;h2 id="chore">Chore:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/976">#976&lt;/a>] chore: upgrade netpoll to v0.4.0 and thriftgo to v0.2.11&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/956">#956&lt;/a>] chore: update configmanager version to v0.2.0&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/948">#948&lt;/a>] chore: format with goimports -local github.com/cloudwego/kitex&lt;/li>
&lt;/ul></description></item><item><title>Blog: Kitex Release v0.5.3</title><link>https://www.cloudwego.io/blog/2023/04/21/kitex-release-v0.5.3/</link><pubDate>Fri, 21 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/04/21/kitex-release-v0.5.3/</guid><description>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="feature">&lt;strong>Feature&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>Failure retry：add configuration to support disable timeout retry when do failure retry, which is for the non-idempotent request&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Codegen tool：support codegen in windows.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Error code: fine grained rpc timeout error code&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Thrift Fast Codec: support unknown fields&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Background of &amp;ldquo;unknown fields&amp;rdquo;: In Thrift, adding fields in the IDL is transparent to the party that has not updated the IDL. Updating the IDL and generating code is necessary to access new fields, which requires all downstream nodes to upgrade when a node on the invocation Chain updates the IDL.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;ldquo;Unknown fields&amp;rdquo; supports retaining unrecognized fields. For fields that do not exist in the IDL, they are read and set in the &lt;code>_unknownFields&lt;/code> field of the struct.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Usage: &lt;code>kitex -thrift keep_unknown_fields your.thrift&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="fix">&lt;strong>Fix&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>Result retry: fix the issue that the result retry becomes invalid after failure retry policy is modified dynamically&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h2 id="feature-1">Feature:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/887">#887&lt;/a>] feat(retry): add configuration to support disable timeout retry when do failure retry, which is for the non-idempotent request&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/881">#881&lt;/a>] feat(tool): support codegen in windows&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/880">#880&lt;/a>] feat(rpctimeout): fine grained rpc timeout error code&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/872">#872&lt;/a>] feat(thrift): support unknown fields in fast codec&lt;/li>
&lt;/ul>
&lt;h2 id="optimize">Optimize:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/884">#884&lt;/a>] optimize(rpcinfo): RPCInfo.To().Tag() use instance tag instead of remoteinfo tag firstly&lt;/li>
&lt;/ul>
&lt;h2 id="fix-1">Fix:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/896">#896&lt;/a>] fix(remoteinfo): fix the race problem caused by non-deepcopy CopyFrom of remoteinfo&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/892">#892&lt;/a>] fix(grpc): comment error log for the error of ReadFrame.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/889">#889&lt;/a>] fix(retry): result retry doesn’t work after failure retry policy is modified dynamically&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/866">#866&lt;/a>] fix(grpc): no need to set context return by sendMsg/recvMsg to the context of stream&lt;/li>
&lt;/ul>
&lt;h2 id="chore">Chore:&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/898">#898&lt;/a>] chore: modify template for PR to check the modification of user doc&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/854">#854&lt;/a>] style(nphttp2): keep struct receiver name same&lt;/li>
&lt;/ul></description></item><item><title>Blog: Introducing Monoio: a high-performance Rust Runtime based on io-uring</title><link>https://www.cloudwego.io/blog/2023/04/17/introducing-monoio-a-high-performance-rust-runtime-based-on-io-uring/</link><pubDate>Mon, 17 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/04/17/introducing-monoio-a-high-performance-rust-runtime-based-on-io-uring/</guid><description>
&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>Although Tokio is currently the &amp;lsquo;de facto&amp;rsquo; standard for Rust asynchronous runtime, there is still some distance to go to achieve the ultimate performance of network middleware.
In pursuit of this goal, the &lt;a href="https://github.com/cloudwego">CloudWeGo&lt;/a> Rust Team has explored providing asynchronous support for Rust based on io-uring and developed a universal gateway on this basis.&lt;/p>
&lt;p>This blog includes the following content:&lt;/p>
&lt;ol>
&lt;li>Introduction to Rust asynchronous runtime;&lt;/li>
&lt;li>Design essentials of &lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a>;&lt;/li>
&lt;li>Comparison and selection of runtime and application.&lt;/li>
&lt;/ol>
&lt;h2 id="rust-asynchronous-mechanism">Rust Asynchronous Mechanism&lt;/h2>
&lt;p>With the help of Rustc and LLVM, Rust can generate machine code that is efficient and secure enough.
However, besides computing logic, an application often involves I/O, especially for network middleware, where I/O takes up a considerable proportion.&lt;/p>
&lt;p>I/O operations require interaction with the operating system, and writing asynchronous programs is usually not a simple task. How does Rust solve these two problems?
For example, in C++, it is common to write callbacks, but we don&amp;rsquo;t want to do this in Rust because it may encounter many lifetimes related issues.&lt;/p>
&lt;p>Rust allows the implementation of a custom runtime to schedule tasks and execute syscalls, and provides unified interfaces such as Future.
In addition, Rust provides built-in async-await syntax sugar to liberate programmers from callback programming.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/1_2_en.png" alt="image">&lt;/p>
&lt;h3 id="example">Example&lt;/h3>
&lt;p>Let&amp;rsquo;s start with a simple example to see how this system works. When downloading two files in parallel, you can start two threads in any language to download each file and then wait for the threads to finish execution.
However, we don&amp;rsquo;t want to start unnecessary threads just to wait for IO. If we need to wait for IO, we want the threads to do something else and only perform the IO operation when it&amp;rsquo;s ready.&lt;/p>
&lt;p>This event-driven triggering mechanism is often encountered in C++ in the form of callbacks. Callbacks interrupt our sequential logic, making the code less readable.
Additionally, it&amp;rsquo;s easy to encounter issues with the lifecycle of variables that callbacks depend on, such as releasing a variable referenced by a callback before the callback is executed.&lt;/p>
&lt;p>However, in Rust, you only need to create two tasks and wait for them to finish execution.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/3.png" alt="image">&lt;/p>
&lt;p>In comparison to threads, asynchronous tasks are much more efficient in this example, but they don&amp;rsquo;t significantly complicate the programming.&lt;/p>
&lt;p>In the second example, let&amp;rsquo;s mock an asynchronous function called &lt;code>do_http&lt;/code> that directly returns 1. In reality, it could involve a series of asynchronous remote requests.
On top of that, we want to combine these asynchronous functions. Let&amp;rsquo;s assume we make two requests and add up the results, and finally add 1. This is the sum function in this example.
Using the &lt;code>async&lt;/code> and &lt;code>await&lt;/code> syntax, we can easily nest these asynchronous functions.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">#[inline(never)]&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">do_http&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87;font-weight:bold">i32&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">// do http request in async way
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">pub&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">sum&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87;font-weight:bold">i32&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">do_http&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">do_http&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This process is very similar to writing synchronous functions, which means it&amp;rsquo;s more procedural programming rather than state-oriented programming.
By using this mechanism, we can avoid the problem of writing a bunch of callbacks, bringing great convenience to programming.&lt;/p>
&lt;h3 id="the-secret-behind-asyncawait">The Secret Behind Async/Await&lt;/h3>
&lt;p>Through these two examples, we can see how async is used in Rust and how convenient it is to write code with it. But what is the underlying principle behind it?&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">#[inline(never)]&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">do_http&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87;font-weight:bold">i32&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">// do http request in async way
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">pub&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">sum&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87;font-weight:bold">i32&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">do_http&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">do_http&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/4.png" alt="image">&lt;/p>
&lt;p>The examples we just saw were written using Async and Await, which ultimately generates a structure that implements the Future trait.&lt;/p>
&lt;p>Async and Await is actually syntactic sugar that can be expanded into Generator syntax at the HIR (High-level Intermediate Representation) stage.
The Generator syntax is then further expanded by the compiler into a state machine at the MIR (Mid-level Intermediate Representation) stage.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/5.png" alt="image">&lt;/p>
&lt;h3 id="future-abstraction">Future Abstraction&lt;/h3>
&lt;p>The Future trait is defined in the standard library. Its interface is very simple, consisting of only one associated type and one poll method.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">pub&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">trait&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">poll&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#3465a4">self&lt;/span>: &lt;span style="color:#000">Pin&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cx&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#204a87">&amp;#39;_&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">Poll&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">pub&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">enum&lt;/span> &lt;span style="color:#000">Poll&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">T&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Ready&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">T&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pending&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The Future describes the interface exposed by the state machine:&lt;/p>
&lt;ol>
&lt;li>Driving the state machine execution: The Poll method, as the name suggests, drives the execution of the state machine. Given a task, it triggers the task to perform state transitions.&lt;/li>
&lt;li>Returning the execution result:
&lt;ol>
&lt;li>When encountering a blocking operation: Pending&lt;/li>
&lt;li>When execution is completed: Ready + return value&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;p>From this, we can see that the essence of an asynchronous task is to implement the state machine of a Future.
The program can manipulate it using the Poll method, which may indicate that it&amp;rsquo;s currently encountering a blocking operation or that the task has completed and returned a result.&lt;/p>
&lt;p>Since we have the Future trait, we can manually implement it. In doing so, the resulting code can be more readable compared to expanding with the Async and Await syntactic sugar.
Below is an example of manually generating a state machine. If we were to write it using the Async syntax, it might be as simple as an async function returning a 1.
However, when manually writing it, we need to define a custom struct and implement the Future trait for that struct.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// auto generate
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">do_http&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87;font-weight:bold">i32&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">// do http request in async way
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">// manually impl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">do_http&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">DOHTTPFuture&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">DoHTTPFuture&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000">DoHTTPFuture&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">impl&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">for&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">DoHTTPFuture&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">i32&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">poll&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#3465a4">self&lt;/span>: &lt;span style="color:#000">Pin&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">_cx&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#204a87">&amp;#39;_&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">Poll&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Poll&lt;/span>::&lt;span style="color:#000">Ready&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The essence of an async function is to return an anonymous structure that implements the Future trait. This type is automatically generated by the compiler,
so its name is not exposed to us. On the other hand, when manually implementing it, we define a struct called &lt;code>DoHTTPFuture&lt;/code> and implement the Future trait for it.
Its output type, just like the return value of an async function, is an i32. These two approaches are equivalent.&lt;/p>
&lt;p>Since we only need to immediately return the number 1 in this case without any waiting involved, we can simply return &lt;code>Ready(1)&lt;/code> in the poll implementation.&lt;/p>
&lt;p>In the previous example of &lt;code>sum&lt;/code>, it involved the composition of asynchronous logic: making two calls to &lt;code>do_http&lt;/code> and then adding the two results together.
If we were to manually implement this, it would be slightly more complex because it would involve two await points. Once await is involved, it essentially becomes a state machine.&lt;/p>
&lt;p>Why a state machine? Because each await point may potentially block, and the thread cannot stop and wait there. It must switch to execute other tasks.
In order to resume the previous task later, its corresponding state must be stored. Here, we define two states: &lt;code>FirstDoHTTP&lt;/code> and &lt;code>SecondDoHTTP&lt;/code>.
When implementing the poll function, we enter a loop where we match the current state and perform state transitions accordingly.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// auto generate
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">sum&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87;font-weight:bold">i32&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">do_http&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">do&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">http&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">// manually impl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">sum&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">SumFuture&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">SumFuture&lt;/span>::&lt;span style="color:#000">FirstDoHTTP&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">DoHTTPFuture&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">enum&lt;/span> &lt;span style="color:#000">SumFuture&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">FirstDoHTTP&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">DOHTTPFuture&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">SecondDoHTTP&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">DOHTTPFuture&lt;/span>&lt;span style="color:#a40000">，&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">i32&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">impl&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">for&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">SumFuture&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">i32&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">poll&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#3465a4">self&lt;/span>: &lt;span style="color:#000">Pin&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cx&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">Poll&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">this&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">get&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">mut&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">loop&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">match&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">this&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">SumFuture&lt;/span>::&lt;span style="color:#000">FirstDoHTTP&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">f&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">pinned&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">unsafe&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pin&lt;/span>::&lt;span style="color:#000">new_unchecked&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">f&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">};&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">match&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">pinned&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">poll&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">cx&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Poll&lt;/span>::&lt;span style="color:#000">Ready&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">this&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">SumFuture&lt;/span>::&lt;span style="color:#000">SecondDoHTTP&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">DOHTTPFuture&lt;/span>&lt;span style="color:#a40000">，&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Poll&lt;/span>::&lt;span style="color:#000">Pending&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">return&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pol&lt;/span>::&lt;span style="color:#000">Pending&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">SumFuture&lt;/span>::&lt;span style="color:#000">SecondDoHTTP&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">f&lt;/span>&lt;span style="color:#a40000">，&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">prev_sum&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">pinned&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">unsafe&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pin&lt;/span>::&lt;span style="color:#000">new_unchecked&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">f&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">};&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">return&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">match&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">pinned&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">poll&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cx&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Poll&lt;/span>::&lt;span style="color:#000">Ready&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Poll&lt;/span>::&lt;span style="color:#000">Ready&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">prev_sum&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Poll&lt;/span>::&lt;span style="color:#000">Pending&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pol&lt;/span>::&lt;span style="color:#000">Pending&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">};&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="the-relationship-between-task-future-and-runtime">The Relationship between Task, Future and Runtime&lt;/h3>
&lt;p>Let&amp;rsquo;s use the example of TcpStream&amp;rsquo;s Read/Write to illustrate the entire mechanism and the relationship between components.&lt;/p>
&lt;p>First, when we create a TCP stream, the component internally registers it with a poller. This poller can be thought of as a wrapper for epoll (the specific driver used depends on the platform).&lt;/p>
&lt;p>Now, let&amp;rsquo;s go through the steps in order. We have a task that needs to be spawned for execution. Essentially, spawning a task means putting it into the task queue of the runtime.
The runtime will continuously take tasks from the task queue and execute them. Execution involves advancing the state machine, which means invoking the poll method of the task. This brings us to the second step.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/6_en.png" alt="image">&lt;/p>
&lt;p>We execute the poll method, which is essentially implemented by the user. Within this task, the user will invoke TcpStream&amp;rsquo;s read/write functions.
Internally, these functions eventually make system calls to perform their functionality. However, before executing the syscall, certain conditions must be met,
such as the file descriptor (fd) being ready for reading or writing. If it doesn&amp;rsquo;t meet these conditions, even if we execute the syscall,
we will only receive a WOULD_BLOCK error, resulting in wasted performance. Initially, we assume that newly added fds are both readable and writable,
so the first poll will execute the syscall. If there is no data to read or the kernel&amp;rsquo;s write buffer is full, the syscall will return a WOULD_BLOCK error.
Upon detecting this error, we modify the readiness record and set the relevant read/write for that fd as not ready. At this point, we can only return Pending.&lt;/p>
&lt;p>Next, we move to the fourth step. When all the tasks in our task queue have finished execution and all tasks are blocked on I/O, it means that none of the I/O operations are ready.
The thread will continuously block in the poller&amp;rsquo;s wait method, which can be thought of as something similar to epoll_wait. When using io_uring for implementation, this may correspond to another syscall.&lt;/p>
&lt;p>At this point, entering a syscall is reasonable because there are no tasks to execute, and there is no need to continuously poll the I/O status.
Entering a syscall allows the CPU time slice to be yielded to other tasks on the same machine. If any I/O operation becomes ready, we will return from the syscall,
and the kernel will inform us which events on which fds have become ready. For example, if we are interested in the readability of a specific fd, it will inform us that the fd is ready for reading.&lt;/p>
&lt;p>We need to mark the readiness of the fd as readable and wake up the tasks waiting on it. In the previous step, there was a task waiting here, dependent on the I/O being readable.
Now that the condition is met, we need to reschedule it. Waking up essentially means putting the task back into the task queue. Implementation-wise, this is achieved through the wake-related methods of a Waker.
The handling behavior of wake is implemented by the runtime, and the simplest implementation is to use a deque to store tasks, pushing them in when waking.
More complex implementations may consider mechanisms such as task stealing and distribution for cross-thread scheduling.&lt;/p>
&lt;p>When this task is polled again, it will perform TcpStream read internally. It will find that the I/O is in a readable state, so it will execute the read syscall,
and at this point, the syscall will execute correctly, and TcpStream read will return Ready to the outside.&lt;/p>
&lt;h3 id="waker">Waker&lt;/h3>
&lt;p>Earlier, we mentioned the Waker. Now let&amp;rsquo;s discuss how the Waker works. We know that a Future is essentially a state machine, and each time it is polled, it returns Pending or Ready.
When it encounters an IO block and returns Pending, who detects the IO readiness? And how is the Future driven again once the IO is ready?&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">pub&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">trait&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">poll&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#3465a4">self&lt;/span>: &lt;span style="color:#000">Pin&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cx&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#204a87">&amp;#39;_&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">Poll&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">pub&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;a&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">//obtain the Waker used to wake up the Task.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">waker&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span> &lt;span style="color:#000">a&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Waker&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">//mark field, can be ignored
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">_marker&lt;/span>: &lt;span style="color:#000">PhantomData&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;a&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">())&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;a&lt;/span> &lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Inside the Future trait, in addition to containing the mutable borrow of its own state machine, there is another important component called Context.
Currently, the Context only has one meaningful member, which is the Waker. For now, we can consider the Waker as a trait object constructed and implemented by the runtime.
Its implementation effect is that when we wake this Waker, the task is added back to the task queue and may be executed immediately or later.&lt;/p>
&lt;p>Let&amp;rsquo;s take another example to understand the whole process:&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/7.png" alt="image">&lt;/p>
&lt;p>When a user calls &lt;code>listener.accept()&lt;/code> to generate an &lt;code>AcceptFut&lt;/code> and waits:&lt;/p>
&lt;ol>
&lt;li>The &lt;code>fut.await&lt;/code> internally calls the &lt;code>poll&lt;/code> method of the Future using the &lt;code>cx&lt;/code> (Context).&lt;/li>
&lt;li>Inside the &lt;code>poll&lt;/code>, a syscall is executed.&lt;/li>
&lt;li>There are no incoming connections, so the kernel returns &lt;code>WOULD_BLOCK&lt;/code>.&lt;/li>
&lt;li>The Waker in the &lt;code>cx&lt;/code> is cloned and stored in the associated structure of &lt;code>TcpListener&lt;/code>.&lt;/li>
&lt;li>The current poll returns Pending to the outside.&lt;/li>
&lt;li>The Runtime has no tasks to execute, so the control is transferred to the Poller.&lt;/li>
&lt;li>The Poller executes &lt;code>epoll_wait&lt;/code> and enters a syscall to wait for IO readiness.&lt;/li>
&lt;li>It searches for and marks all ready IO states.&lt;/li>
&lt;li>If there is an associated Waker, it wakes and clears it.&lt;/li>
&lt;li>The task waiting for accept is added back to the execution queue and is polled again.&lt;/li>
&lt;li>Another syscall is executed.&lt;/li>
&lt;li>12/13, Kernel returns the syscall result, and poll returns Ready.&lt;/li>
&lt;/ol>
&lt;h3 id="runtime">Runtime&lt;/h3>
&lt;ol>
&lt;li>Let&amp;rsquo;s start with the executor. It has an executor and a task queue. Its job is to continuously take tasks from the queue and drive their execution. When all tasks have completed and it must wait, it hands over control to the Reactor.&lt;/li>
&lt;li>Once the Reactor receives control, it interacts with the kernel and waits for IO readiness. After IO is ready, we need to mark the readiness state of that IO and wake up the tasks associated with it.
After waking up, the control is handed back to the executor. When the executor executes the task, it will invoke the capabilities provided by the IO component.&lt;/li>
&lt;li>The IO component needs to provide these asynchronous interfaces. For example, when a user wants to use TcpStream, they need to use a TcpStream provided by the runtime instead of the standard library directly.
Secondly, the component should be able to register its file descriptor (fd) with the Reactor. Thirdly, when the IO is not ready, we can place the waker associated with that task in the relevant area.&lt;/li>
&lt;/ol>
&lt;p>That&amp;rsquo;s roughly how the asynchronous mechanism in Rust works.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/8_en.png" alt="image">&lt;/p>
&lt;h2 id="monoio-design">Monoio Design&lt;/h2>
&lt;p>&lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a> is a thread-per-core Rust runtime with io_uring/epoll/kqueue. And it is designed to be the most efficient and performant thread-per-core Rust runtime with good platform compatibility.&lt;/p>
&lt;p>The following will describe the key points of the &lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a> Runtime design in four parts:&lt;/p>
&lt;ol>
&lt;li>Async IO interface based on GAT (Generic Associated Types).&lt;/li>
&lt;li>Driver detection and switching transparent to the upper layer.&lt;/li>
&lt;li>Balancing performance and functionality.&lt;/li>
&lt;li>Providing compatibility with the Tokio interface.&lt;/li>
&lt;/ol>
&lt;h3 id="pure-async-io-interface-based-on-gat">Pure async IO interface based on GAT&lt;/h3>
&lt;p>First, let&amp;rsquo;s introduce two notification mechanisms. The first one is similar to epoll, which is a notification based on readiness states. The second one is the io-uring mode, which is a &amp;ldquo;completion notification&amp;rdquo; based mode.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/9_en.png" alt="image">&lt;/p>
&lt;p>In the readiness-based mode, tasks wait and detect IO readiness through epoll, and only perform syscalls when the IO is ready.
However, in the completion notification-based mode, Monoio can be lazier: it simply tells the kernel what the current task wants to do and then lets go.&lt;/p>
&lt;p>io_uring allows users and the kernel to share two lock-free queues: the submission queue (SQ) is written by user-space programs and consumed by the kernel,
while the completion queue (CQ) is written by the kernel and consumed by user-space. The enter syscall can be used to submit the SQEs (Submission Queue Entries) in the queue to the kernel,
and optionally, it can also enter and wait for CQEs (Completion Queue Entries).&lt;/p>
&lt;p>In syscall-intensive applications, using io_uring can significantly reduce the number of context switches, and io_uring itself can also reduce data copying in the kernel.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/10_en.png" alt="image">&lt;/p>
&lt;p>The differences between these two modes will greatly influence the design of the Runtime and IO interface. In the first mode, there is no need to hold the buffer while waiting;
the buffer is only needed when executing the syscall. Therefore, in this mode, users can pass the &lt;code>&amp;amp;mut Buffer&lt;/code> when calling the actual poll (e.g., poll_read).
In the second mode, once submitted to the kernel, the kernel can access the buffer at any time, and &lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a> must ensure the validity of the buffer before the corresponding CQE for that task returns.&lt;/p>
&lt;p>If existing async IO traits (such as Tokio/async-std, etc.) are used, passing a reference to the buffer during read/write may result in memory safety issues such as Use-After-Free (UAF).
For example, if the user pushes the buffer pointer into the uring SQ when calling read, but immediately drops the created Future (&lt;code>read(&amp;amp;mut buffer)&lt;/code>) and drops the buffer,
this behavior does not violate Rust&amp;rsquo;s borrowing rules, but the kernel will still access freed memory, potentially stomping on memory blocks allocated by the user program later on.&lt;/p>
&lt;p>One solution in this case is to capture ownership of the buffer. When generating the Future, the ownership is given to the Runtime, so the user cannot access the buffer in any way,
thus ensuring the validity of the pointer before the kernel returns the CQE. This solution is inspired by the approach used in Tokio-uring.&lt;/p>
&lt;p>&lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a> defines the &lt;code>AsyncReadRent&lt;/code> trait. The term &amp;ldquo;Rent&amp;rdquo; refers to borrowing, where the Runtime takes the buffer from the user first and returns it later.
The type &lt;code>ReadFuture&lt;/code> here has a lifetime generic, which is made possible by GAT (Generic Associated Types). GAT is now stable and can be used in the stable version.
When implementing the associated Future, the &lt;code>TAIT&lt;/code> trait can be used directly with the async/await syntax, which is much more convenient and user-friendly compared to manually defining Futures.
This feature is not yet stable (it is now called &lt;code>impl trait in assoc type&lt;/code>).&lt;/p>
&lt;p>However, transferring ownership introduces new issues. In the readiness-based mode, canceling IO only requires dropping the Future. Here, if the Future is dropped,
it may lead to data flow errors on the connection (as the Future might be dropped at the moment when the syscall has already succeeded).
Additionally, a more serious problem is that the buffer captured by the Future will definitely be lost. To address these two issues, Monoio supports IO traits with cancellation capabilities.
When canceled, a &lt;code>CancelOp&lt;/code> is pushed, and the user needs to continue waiting for the original Future to complete (as it has been canceled, it is expected to return within a short time).
The corresponding syscall may succeed or fail and return the buffer.&lt;/p>
&lt;h3 id="automatic-driver-detection-and-switching-for-higher-level">Automatic Driver Detection and Switching for Higher Level&lt;/h3>
&lt;p>The second feature is automatic driver detection and switching for high level components.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">trait&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">OpAble&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">uring_op&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">io_uring&lt;/span>::&lt;span style="color:#000">squeue&lt;/span>::&lt;span style="color:#000">Entry&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">legacy_interest&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#204a87">Option&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ready&lt;/span>::&lt;span style="color:#000">Diirection&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">usize&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">legacy_call&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">io&lt;/span>::&lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">u32&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>Specify the driver through features or code, and conditionally perform runtime detection.&lt;/li>
&lt;li>Expose a unified IO interface, namely AsyncReadRent and AsyncWriteRent.&lt;/li>
&lt;li>Implement internally using the OpAble unified component (abstracting Read, Write, and other operations).&lt;/li>
&lt;/ol>
&lt;p>Specifically, for operations such as accept, connect, read, write, etc., which are implemented as OpAble, they correspond to the following three functions:&lt;/p>
&lt;ol>
&lt;li>uring_op: Generates the corresponding uring SQE.&lt;/li>
&lt;li>legacy_interest: Returns the direction of read/write it is interested in.&lt;/li>
&lt;li>legacy_call: Executes the syscall directly.&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/11_en.png" alt="image">&lt;/p>
&lt;p>The entire process will submit a structure that implements OpAble to the driver. It will then return something that implements the Future.
When polling or dropping, it will specifically dispatch to one of the two driver implementations, using one or two of the three functions mentioned.&lt;/p>
&lt;h3 id="performance">Performance&lt;/h3>
&lt;p>Performance is the starting point and the major advantage of &lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a>. In addition to the improvements brought by io_uring, it is designed as a thread-per-core Runtime.&lt;/p>
&lt;ol>
&lt;li>All tasks run only on fixed threads, without task stealing.&lt;/li>
&lt;li>The task queue is a thread-local structure, operated without locks or contention.&lt;/li>
&lt;/ol>
&lt;p>High performance stems from two aspects:&lt;/p>
&lt;ol>
&lt;li>High performance within the Runtime: Essentially equivalent to direct syscall integration.&lt;/li>
&lt;li>High performance in user code: Structures are designed to be thread-local and avoid crossing thread boundaries as much as possible.&lt;/li>
&lt;/ol>
&lt;p>Comparison of task stealing and thread-per-core mechanisms:&lt;/p>
&lt;p>In the case of using Tokio, there may be very few tasks on one thread, while another thread has a high workload. In this situation, the idle thread can steal tasks from the busy thread,
which is similar to how it works in Go. This mechanism allows for better utilization of the CPU and can achieve good performance in general scenarios.&lt;/p>
&lt;p>However, cross-thread operations themselves incur overhead, and when multiple threads operate on data structures, locks or lock-free structures are required.
Lock-free does not mean there is no additional overhead. Compared to purely thread-local operations, cross-thread lock-free structures can impact cache performance,
and CAS (Compare and Swap) operations may involve some unnecessary loops. Moreover, this threading model also affects user code.&lt;/p>
&lt;p>For example, suppose we need an SDK internally to collect some metrics from this program and aggregate them before reporting.
Achieving optimal performance can be challenging with a Tokio-based implementation. However, with a thread-per-core Runtime structure,
we can place the aggregated map in thread-local storage without any locks or contention issues. Each thread can start a task that periodically clears and reports the data in the thread-local storage.
In scenarios where tasks may cross thread boundaries, we would need to use a global structure to aggregate the metrics and have a global task for reporting data.
It becomes challenging to use lock-free data structures for aggregation in such scenarios.&lt;/p>
&lt;p>Therefore, both threading models have their advantages. The thread-per-core model achieves better performance for tasks that can be processed independently.
Sharing fewer resources leads to better performance. However, the drawback of the thread-per-core model is that it cannot fully utilize the CPU when the workload is unevenly distributed among tasks.
For specific scenarios such as gateway proxies, the thread-per-core model is more likely to fully utilize hardware performance and achieve good horizontal scalability.
Popular solutions like Nginx and Envoy employ this threading model.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/12_en.png" alt="image">&lt;/p>
&lt;p>We have conducted some benchmarks, and &lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a> demonstrates excellent performance scalability. As the number of CPU cores increases, you only need to add the corresponding threads.&lt;/p>
&lt;h3 id="functionality">Functionality&lt;/h3>
&lt;p>Thread-per-core does not imply the absence of cross-thread capabilities. Users can still use some shared structures across threads, which are unrelated to the Runtime. The Runtime provides the ability to wait across threads.&lt;/p>
&lt;p>Tasks are executed within the local thread but can wait for tasks on other threads. This is an essential capability. For example, if a user needs to fetch remote configurations with a single thread and distribute them to all threads,
they can easily implement this functionality based on this capability.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/13.png" alt="image">&lt;/p>
&lt;p>The essence of cross-thread waiting is for a task on another thread to wake up the local thread. In the implementation, we mark the ownership of tasks in the Waker.
If the current thread is not the task&amp;rsquo;s owner thread, the Runtime will send the task to its owner thread using a lock-free queue.
If the target thread is in a sleep state (e.g., waiting for IO in a syscall), the Runtime will wake it up using a pre-installed eventfd.
After being awakened, the target thread will process the cross-thread waker queue.&lt;/p>
&lt;p>In addition to providing the ability for cross-thread waiting, &lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a> also offers the spawn_blocking capability for users to execute heavy computational logic without affecting other tasks in the same thread.&lt;/p>
&lt;h3 id="compatibility-interfaces">Compatibility Interfaces&lt;/h3>
&lt;p>Since many components (such as Hyper) are bound to Tokio&amp;rsquo;s IO traits, and as mentioned earlier, it is not possible to unify these two IO traits due to the underlying drivers.
This can create difficulties in terms of ecosystem compatibility. For some non-hot-path components, it is necessary to allow users to use them in a compatible manner, even if it incurs some performance cost.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Monoio_Open_Source/14.png" alt="image">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// tokio way
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tcp&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tokio&lt;/span>::&lt;span style="color:#000">net&lt;/span>::&lt;span style="color:#000">TcpStream&lt;/span>: &lt;span style="color:#000">connect&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;1.1.1.1.1:80&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">unwrap&lt;/span>&lt;span style="color:#000;font-weight:bold">();&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">// monoio way(with monoio-compat)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tcp&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">monoio_compat&lt;/span>::&lt;span style="color:#000">StreamWrapper&lt;/span>::&lt;span style="color:#000">new&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">monoio_tcp&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">monoio_tcp&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">monoio&lt;/span>::&lt;span style="color:#000">net&lt;/span>::&lt;span style="color:#000">TcpStream&lt;/span>::&lt;span style="color:#000">connect&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;1.1.1.1:80&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">unwrap&lt;/span>&lt;span style="color:#000;font-weight:bold">();&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">// both of them implements tokio:: io::AsyncReadd and tokio:: io: AsyncWrite
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We provide a wrapper that includes a buffer, and when users use it, they need to incur an additional memory copy overhead.
Through this approach, we can wrap components of Monoio into Tokio-compatible interfaces, allowing them to be used with compatible components.&lt;/p>
&lt;h2 id="runtime-comparison--applications">Runtime Comparison &amp;amp; Applications&lt;/h2>
&lt;p>This section discusses some runtime comparison options and their applications.&lt;/p>
&lt;p>We have already mentioned the comparison between uniform scheduling and thread-per-core. Now let&amp;rsquo;s focus on their application scenarios.
For a large number of lightweight tasks, the thread-per-core mode is suitable. This is particularly applicable to applications such as proxies, gateways, and file IO-intensive tasks, making Monoio an excellent choice.&lt;/p>
&lt;p>Additionally, while Tokio aims to be a general cross-platform solution, &lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a> was designed from the beginning with a focus on achieving optimal performance, primarily using io_uring.
Although it can also support epoll and kqueue, they serve as fallback options. For example, kqueue is primarily included to facilitate development on macOS, but it is not intended for actual production use (support for Windows is planned in the future).&lt;/p>
&lt;p>In terms of ecosystem, Tokio has a comprehensive ecosystem, while &lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a> lags behind in this aspect. Even with the compatibility layer, there are inherent costs.
Tokio&amp;rsquo;s task stealing can perform well in many scenarios, but it has limited scalability. On the other hand, Monoio demonstrates good scalability, but it has certain limitations in terms of business scenarios and programming models.
Therefore, Monoio is well-suited for scenarios such as proxies, gateways, and data aggregation in caches. It is also suitable for components that perform file IO, as io_uring excels in handling file IO.
Without io_uring, there is no true asynchronous file IO available in Linux; only with io_uring can this be achieved. Monoio is also suitable for components that heavily rely on file IO, such as database-related components.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>Tokio&lt;/th>
&lt;th>Monoio&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Scene&lt;/td>
&lt;td>General, task stealing&lt;/td>
&lt;td>Specific, thread-per-core&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Platform&lt;/td>
&lt;td>Cross-platform, epoll/kqueue/iocp&lt;/td>
&lt;td>Specific, io_uring, epoll/kqueue as fallback&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Ecosystem&lt;/td>
&lt;td>comprehensive&lt;/td>
&lt;td>Relatively lacking&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Horizontal extensibility&lt;/td>
&lt;td>Not Good Enough&lt;/td>
&lt;td>Good&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Application&lt;/td>
&lt;td>General business&lt;/td>
&lt;td>Proxy, Gateway, cache, data aggregate, etc&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Tokio-uring is actually a layer built on top of Tokio, somewhat like a distribution layer. Its design is elegant, and we have also referenced many of its designs, such as the ownership transfer mechanism.
However, it is still based on Tokio and runs uring on top of epoll, without achieving full transparency for users. When implementing components, one can only choose between using epoll or using uring.
If uring is chosen, the resulting binary cannot run on older versions of Linux. On the other hand, Monoio addresses this issue well and supports dynamic detection of uring availability.&lt;/p>
&lt;h3 id="applications-of-monoio">Applications of Monoio&lt;/h3>
&lt;ol>
&lt;li>Monoio Gateway: A gateway service based on the &lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a> ecosystem. In optimized version benchmarks, its performance surpasses that of Nginx.&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudwego/volo">Volo&lt;/a>: An RPC framework open-sourced by the &lt;a href="https://github.com/cloudwego">CloudWeGo&lt;/a> team, currently being integrated. The PoC version demonstrates a 26% performance improvement compared to the Tokio-based version.
We have also conducted some internal business trials, and in the future, we will focus on improving compatibility and component development to make Monoio even more user-friendly.&lt;/li>
&lt;/ol></description></item><item><title>Blog: Introducing Shmipc: A High Performance Inter-process Communication Library</title><link>https://www.cloudwego.io/blog/2023/04/04/introducing-shmipc-a-high-performance-inter-process-communication-library/</link><pubDate>Tue, 04 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/04/04/introducing-shmipc-a-high-performance-inter-process-communication-library/</guid><description>
&lt;p>We are excited to introduce an open source project - &lt;strong>Shmipc&lt;/strong>, a &lt;strong>high performance inter-process communication library&lt;/strong> developed by ByteDance.
It is built on Linux&amp;rsquo;s &lt;strong>shared memory technology&lt;/strong> and uses unix or tcp connection to do process synchronization and finally implements
zero copy communication across inter-processes. In IO-intensive or large-package scenarios, it has better performance.&lt;/p>
&lt;p>There isn&amp;rsquo;t much information on this area, so the open-source of Shmipc would like to contribute by providing a valuable reference.
In this blog, we would like to cover some of the main &lt;strong>design ideas&lt;/strong> of Shmipc, the &lt;strong>problems&lt;/strong> encountered during the adoption process and the subsequent &lt;strong>evolution plan&lt;/strong>.&lt;/p>
&lt;ul>
&lt;li>Design: &lt;a href="https://github.com/cloudwego/shmipc-spec">https://github.com/cloudwego/shmipc-spec&lt;/a>&lt;/li>
&lt;li>Implementation in Golang: &lt;a href="https://github.com/cloudwego/shmipc-go">https://github.com/cloudwego/shmipc-go&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="background-and-motivation">Background and Motivation&lt;/h2>
&lt;p>At ByteDance, Service Mesh has undergone a lot of performance optimization during its adoption and evolution. The &lt;strong>traffic interception&lt;/strong> of Service Mesh is
achieved by &lt;strong>inter-process communication&lt;/strong> between the mesh proxy and the microservice framework&amp;rsquo;s &lt;strong>agreed-upon addresses&lt;/strong>, which performs better than iptables solutions.
However, conventional optimization methods no longer bring significant performance improvements. Therefore, we shifted our focus to inter-process communication, and &lt;strong>Shmipc&lt;/strong> was born.&lt;/p>
&lt;h2 id="design-ideas">Design Ideas&lt;/h2>
&lt;h3 id="zero-copy">Zero Copy&lt;/h3>
&lt;p>The two most widely used inter-process communication methods in production environments are unix domain sockets and TCP loopback (localhost:$PORT),
and their performance differences are not significant from the benchmark. From a technical standpoint, both require copying communication data between user space and kernel space.
In the RPC scenario, there are four memory copies in inter-process communication during a single RPC process, with two copies in the request path and two copies in the response path.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Shmipc_Open_Source/zero_copy.png" alt="image">&lt;/p>
&lt;p>Although sequential copying on modern CPUs is very fast, eliminating up to four memory copies can still save CPU usage in large packet scenarios.
With the zero-copy feature based on shared memory communication, we can easily achieve this. However, to achieve zero-copy, there will be many additional tasks surrounding shared memory itself, such as:&lt;/p>
&lt;ol>
&lt;li>In-depth serialization and deserialization of microservice frameworks. We hope that when a Request or Response is serialized, the corresponding binary data is already in shared memory,
rather than being serialized to a non-shared memory buffer and then copied to a shared memory buffer.&lt;/li>
&lt;li>Implementing a process synchronization mechanism. When one process writes data to shared memory, another process does not know about it, so a synchronization mechanism is needed for notification.&lt;/li>
&lt;li>Efficient memory allocation and recycling. Ensuring that the allocation and recycling mechanism of shared memory across processes has a low overhead to avoid masking the benefits of zero-copy features.&lt;/li>
&lt;/ol>
&lt;h3 id="synchronization-mechanism">Synchronization Mechanism&lt;/h3>
&lt;p>Consider different scenarios:&lt;/p>
&lt;ol>
&lt;li>On-demand real-time synchronization. Suitable for online scenarios that are extremely sensitive to latency. Notify the other process after each write operation is completed.
There are many options to choose from on Linux, such as TCP loopback, unix domain sockets, event fd, etc. Event fd has slightly better benchmark performance,
but passing fd across processes introduces too much complexity. The performance improvement it brings is not very significant in IPC, and the trade-off between
complexity and performance needs to be carefully considered. At ByteDance, we chose unix domain sockets for process synchronization.&lt;/li>
&lt;li>Periodic synchronization. Suitable for offline scenarios that are not sensitive to latency. Access the custom flag in shared memory through high-interval sleep
to determine whether there is data written. However, note that sleep itself also requires a system call and has greater overhead than reading and writing with unix domain sockets.&lt;/li>
&lt;li>Polling synchronization. Suitable for scenarios where latency is very sensitive but the CPU is not as sensitive. You can complete it by polling the custom flag in shared memory on a single core.&lt;/li>
&lt;/ol>
&lt;p>Overall, on-demand real-time synchronization and periodic synchronization require system calls to complete,
while polling synchronization does not require system calls but requires running a CPU core at full capacity under normal circumstances.&lt;/p>
&lt;h3 id="batching-io-operations">Batching IO Operations&lt;/h3>
&lt;p>In online scenarios, real-time synchronization is required on demand for each data write, which requires a process synchronization operation (Step 4 in the figure below).
Although the latency issue is resolved, to demonstrate the benefits of zero-copy on performance, the number of packets that require interaction needs to be greater than a relatively large threshold.
Therefore, an IO queue was constructed in shared memory to complete batch IO operation, enabling benefits to be demonstrated even in small packet IO-intensive scenarios.&lt;/p>
&lt;p>The core idea is that when a process writes a request to the IO queue, it notifies the other process to handle it.
When the next request comes in(corresponding to IO Event 2~N in the figure, an IO Event can independently describe the position of a request in shared memory),
if the other process is still processing requests in the IO queue, there is no need to send a notification. Therefore, the more dense the IO, the better the batching effect.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Shmipc_Open_Source/share_memory.jpeg" alt="image">&lt;/p>
&lt;p>In addition, in offline scenarios, scheduled synchronization itself is a form of batch processing for IO, and the effect of batch processing can
effectively reduce the system calls caused by process synchronization. The longer the sleep interval, the lower the overhead of process synchronization.&lt;/p>
&lt;p>As for polling synchronization, there is no need to consider batch IO operation because this mechanism itself is designed to reduce process synchronization overhead.
Polling synchronization directly occupies a CPU core, which is equivalent to defaulting to maximizing the synchronization mechanism overhead to achieve extremely low synchronization latency.&lt;/p>
&lt;h2 id="performance">Performance&lt;/h2>
&lt;h3 id="benchmark">Benchmark&lt;/h3>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Shmipc_Open_Source/benchmark.png" alt="image">&lt;/p>
&lt;p>The X-axis represents the size of the data packet, and the Y-axis represents the time required for one Ping-Pong in microseconds, with smaller values being better.
It can be seen that in small packet scenarios, Shmipc can also achieve some benefits compared to unix domain sockets, and &lt;strong>performance improves as packet size increases&lt;/strong>.&lt;/p>
&lt;p>&lt;strong>Source&lt;/strong>: &lt;code>git clone https://github.com/cloudwego/shmipc-go &amp;amp;&amp;amp; go test -bench=BenchmarkParallelPingPong -run BenchmarkParallelPingPong&lt;/code>&lt;/p>
&lt;h3 id="production-environment">Production Environment&lt;/h3>
&lt;p>In the Service Mesh ecosystem of ByteDance&amp;rsquo;s production environment, we have applied Shmipc in &lt;strong>over 3,000 services and more than 1 million instances&lt;/strong>.
Different business scenarios show different benefits, with the &lt;strong>highest&lt;/strong> benefit being a &lt;strong>24% reduction&lt;/strong> in overall resource usage for the risk control business.
Of course, there are also scenarios with no obvious benefits or even deterioration. However, significant benefits can be seen in &lt;strong>both large packet and IO-intensive scenarios&lt;/strong>.&lt;/p>
&lt;h2 id="lessons-learned">Lessons Learned&lt;/h2>
&lt;p>During the adoption process at ByteDance, we also encountered some pitfalls that caused some online accidents, which are quite valuable for reference.&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Shared memory leak&lt;/strong>. The shared memory allocation and recovery in the IPC process involve two processes and can easily lead to shared memory leaks if not careful.
Although the problem is very tricky, as long as it can be discovered actively when a leak occurs and there are observation methods to troubleshoot the leak afterwards, it can be solved.
&lt;ol>
&lt;li>Active discovery. By increasing some statistics and summarizing them in the monitoring system, active discovery can be achieved, such as the total memory size allocated and recovered.&lt;/li>
&lt;li>Observation methods. When designing the layout of shared memory, adding some metadata enables us to analyze shared memory dumped by the built-in debug tool at the time of the leak,
providing information on how much memory is leaked, what is in it, and some metadata related to this content.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>&lt;strong>Packet congestion&lt;/strong>. Packet congestion is the most troublesome problem, which can cause serious consequences due to various reasons. We once had a packet congestion accident in a certain business,
which was caused by the depletion of shared memory due to large packets. During the fallback to the normal path, there was a design defect, which caused a small probability of packet congestion.
A valuable reference is to &lt;strong>increase integration testing and unit testing&lt;/strong> in more scenarios to kill packet congestion in the cradle instead of explaining the investigation process and root cause.&lt;/li>
&lt;li>&lt;strong>Shared memory trampling&lt;/strong>. &amp;lsquo;&lt;strong>memfd&lt;/strong>&amp;rsquo; should be used as much as possible to share memory, rather than the path of &amp;lsquo;mmap&amp;rsquo; file system.
In the early days, the &amp;lsquo;mmap&amp;rsquo; file system path was used for shared memory. The startup process of Shmipc and the path of shared memory were specified by environment variables,
and the boot process was injected into the application process. There is a situation where the application process may fork a process, which inherits the environment variables of the application process
and also integrates Shmipc. The forked process and the application process mmaped the same shared memory, resulting in trampling.
In ByteDance&amp;rsquo;s accident scenario, the application process used the golang plugin mechanism to load &lt;code>.so&lt;/code> from the outside to run, and the &lt;code>.so&lt;/code> integrated with Shmipc and ran in the application process.
It could see all the environment variables, so it and the application process mmaped the same shared memory, resulting in undefined behavior during the operation.&lt;/li>
&lt;li>&lt;strong>Sigbus coredump&lt;/strong>. In the early days, shared memory is achieved through mmaping files under the &lt;code>/dev/shm/&lt;/code> path (tmpfs), and most application services were running in docker container instances.
Container instances have capacity limits on tmpfs (which can be observed through df -h). This may cause a Sigbus error when the shared memory of mmap exceeds this limit.
There will be no error reported by mmap itself, but the application process will crash when it accesses memory beyond the limit during runtime.
To solve this problem, use &amp;lsquo;&lt;strong>memfd&lt;/strong>&amp;rsquo; to share memory, as in the third point.&lt;/li>
&lt;/ol>
&lt;h2 id="roadmap">RoadMap&lt;/h2>
&lt;ol>
&lt;li>Integrate with the Golang RPC framework &lt;a href="https://github.com/cloudwego/kitex">CloudWeGo/Kitex&lt;/a>。&lt;/li>
&lt;li>Integrate with the Golang HTTP framework &lt;a href="https://github.com/cloudwego/hertz">CloudWeGo/Hertz&lt;/a>。&lt;/li>
&lt;li>Open-source Rust version of Shmipc and integrate with the Rust RPC framework &lt;a href="https://github.com/cloudwego/volo">CloudWeGo/Volo&lt;/a>。&lt;/li>
&lt;li>Open-source C++ version of Shmipc.&lt;/li>
&lt;li>Introduce a timed synchronization mechanism for offline scenarios.&lt;/li>
&lt;li>Introduce a polling synchronization mechanism for scenarios with extreme latency requirements.&lt;/li>
&lt;li>Empower other IPC scenarios, such as IPC between Log SDK and Log Agent, IPC between Metrics SDK and Metrics Agent, etc.&lt;/li>
&lt;/ol>
&lt;h2 id="conclusion">Conclusion&lt;/h2>
&lt;p>We hope that this article can provide a basic understanding of Shmipc and its design principles. More implementation details and usage methods
can be found in the projects of &lt;a href="https://github.com/cloudwego/shmipc-spec">shmipc-spec&lt;/a> and &lt;a href="https://github.com/cloudwego/shmipc-go">shmipc-go&lt;/a>.
Issues and PRs are always welcomed to the Shmipc project as well as the &lt;a href="https://github.com/cloudwego">CloudWeGo&lt;/a> community.
We also hope that Shmipc can help more developers and enterprises build high-performance cloud-native architectures in the IPC field.&lt;/p></description></item><item><title>Blog: Volo Release 0.4.1</title><link>https://www.cloudwego.io/blog/2023/03/20/volo-release-0.4.1/</link><pubDate>Mon, 20 Mar 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/03/20/volo-release-0.4.1/</guid><description>
&lt;p>In Volo 0.4.1, in addition to the usual bugfixes, some new features have been introduced.&lt;/p>
&lt;h2 id="more-detailed-thrift-decode-error-messages">More detailed Thrift Decode error messages&lt;/h2>
&lt;p>Previous versions of Thrift Decode error messages reported only the most basic errors, without any context.
For example, it contained the following structural relationships&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-thrift" data-lang="thrift">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">struct&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">A&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">required&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">B&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">b&lt;/span>&lt;span style="color:#a40000">.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">struct&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">B&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">required&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">C&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#a40000">.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">struct&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">C&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">required&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#a40000">.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If an error occurs while decoding field &lt;code>a&lt;/code> of struct &lt;code>C&lt;/code>. In the previous version the error message was only reported for the field &lt;code>a&lt;/code>, but in the current version the Decode error path message is reported in the process &lt;code>A&lt;/code> -&amp;gt; &lt;code>B&lt;/code> -&amp;gt; &lt;code>C&lt;/code>, which makes it easier to catch bugs&lt;/p>
&lt;h2 id="framework-stats-information">Framework stats information&lt;/h2>
&lt;p>&lt;a href="https://github.com/cloudwego/volo/pull/149">#149&lt;/a> adds more stats information for framework. Users can handle this data in the middleware itself, for example by logging or reporting to the monitoring system.&lt;/p>
&lt;h2 id="support-partial-key-listening-in-discover-for-service-discovery">Support partial key listening in Discover for service discovery&lt;/h2>
&lt;p>&lt;a href="https://github.com/cloudwego/volo/pull/155">#155&lt;/a> Support for partial key listening in Discover for service discovery, which reduces unnecessary listening and improves performance.&lt;/p>
&lt;h2 id="full-release-note">Full Release Note&lt;/h2>
&lt;p>For the full Release Notes, please refer to: &lt;a href="https://github.com/cloudwego/volo/compare/volo-0.3.2...volo-0.4.1">Volo Changelog&lt;/a>&lt;/p></description></item><item><title>Blog: Kitex Release v0.5.0</title><link>https://www.cloudwego.io/blog/2023/03/08/kitex-release-v0.5.0/</link><pubDate>Wed, 08 Mar 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/03/08/kitex-release-v0.5.0/</guid><description>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="feature">&lt;strong>Feature&lt;/strong>&lt;/h3>
&lt;p>&lt;strong>1. Fallback: Support fallback for client-side&lt;/strong>&lt;/p>
&lt;p>When the RPC requests fail, users usually have some degradation measures to ensure the effective response (for example, construct the default response after the request timeout or circuit breaker).
Kitex&amp;rsquo;s Fallback supports the processing of all error requests. At the same time, because business errors are usually returned through the Resp (BaseResp field), Kitex also supports the processing of Resp.
Refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/service-governance/fallback/">Fallback&lt;/a>.&lt;/p>
&lt;p>&lt;strong>2. Kitex - gRPC: Client add TLS option configuration&lt;/strong>&lt;/p>
&lt;p>Setup via client.WithGRPCTLSConfig option.&lt;/p>
&lt;p>&lt;strong>3. Kitex - Tool&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Support customized scaffold templates&lt;/strong>, refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/code-gen/custom_tpl/">Custom Scaffold Template&lt;/a>&lt;/li>
&lt;li>&lt;strong>Support specifying the directory for generating code&lt;/strong>, refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/code-gen/code_generation/#-gen-path">Code Generation Tool -gen-path&lt;/a>&lt;/li>
&lt;li>&lt;strong>Support using protoc plugin&lt;/strong>, refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/code-gen/code_generation/#-protobuf-plugin">Code Generation Tool -protobuf-plugin&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="optimization">&lt;strong>Optimization&lt;/strong>&lt;/h3>
&lt;p>&lt;strong>1. Loadbalance：Use Weighted Round Robin algo as default Loadbalance policy&lt;/strong>&lt;/p>
&lt;p>The old version uses Weight Random to do the loadbalance by default. Random can achieve the global balance. However, in the case of a small number of server instances, there is a large probability of random continuous access to the same instance, resulting in an increase in the maximum concurrent requests of downstream nodes. Therefore, the new version adjusts the default policy to Weight Round Robin.
Refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/service-governance/loadbalance/">Loadbalance&lt;/a>&lt;/p>
&lt;p>&lt;strong>2. Goroutine Resource of Connection Pool&lt;/strong>&lt;/p>
&lt;p>When the old version uses a long connection, each client corresponds to a goroutine resource cleaning connection. When there are many clients, it will cause too many goroutines. The new version changes to share the goroutine to avoid the number of goroutines increasing with the number of clients.&lt;/p>
&lt;h3 id="other">&lt;strong>Other&lt;/strong>&lt;/h3>
&lt;p>Upgrade the frugal and pid dependency lib to support go 1.20.&lt;/p>
&lt;hr>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h3 id="feature-1">Feature&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/840">#840&lt;/a>] feat(fallback): support fallback ability for kitex client-side, usage guide refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/service-governance/fallback/">Fallback&lt;/a>&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/841">#841&lt;/a>] feat(tool): add GetResult() and GetFirstArgument() methods for service params of protobuf&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/791">#791&lt;/a>] feat(tool): merge two ways of passing extensions, to support two ways at sametime&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/797">#797&lt;/a>] feat(loadbalance): use smooth weighted round robin algo as default Loadbalance policy&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/760">#760&lt;/a>] feat(grpc): support TLS config in kitex grpc client&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/781">#781&lt;/a>] feat(tool): supports custom templates&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/783">#783&lt;/a>] feat(ttheader): add encode logic for gdpr token in TransInfo&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/775">#775&lt;/a>] feat(tool): support custom generate path&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/687">#687&lt;/a>] feat(tool): add protoc plugin flag&lt;/li>
&lt;/ul>
&lt;h3 id="optimize">Optimize&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/750">#750&lt;/a>] optimize(generic): generic call write zero value for required and default fields to meet the specification of apache thrift and keep consistent with normal thrift encode of Kitex.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/739">#739&lt;/a>] optimize(generic): modify the url routing to align with Hertz for HTTP generic call&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/752">#752&lt;/a>] optimize(ttheader): attach part of ttheader binary into error when readKVInfo failed, which is useful for troubleshooting&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/821">#821&lt;/a>] optimize(config): add DeepCopy() &amp;amp; Equals() to circuitbreaker.CBConfig and retry.Policy&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/827">#827&lt;/a>] optimize: revise the remoteInfo of retry call, using the remoteInfo of the RPCCall that returns&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/762">#762&lt;/a>] optimize(tool): add go mod auto replace to thrift 0.13 in thrift mode&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/755">#755&lt;/a>] optimize: improve client error msg when ctx cancel or timeout&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/756">#756&lt;/a>] optimize: use sync.Cond as the profiler event trigger&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/753">#753&lt;/a>] optimize: add recover for client&amp;rsquo;s Close&lt;/li>
&lt;/ul>
&lt;h3 id="fix">Fix&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/734">#734&lt;/a>] fix(retry): fix the panic problem caused by concurrent read and write of rpcinfo under backup retry&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/837">#837&lt;/a> &lt;a href="https://github.com/cloudwego/kitex/pull/842">#842&lt;/a>] fix(metahandler): adjust MetainfoHandler to the top of the MetaHandlers array to ensure that the logic of custom MetaHandlers that depends on MetainfoHandler works&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/812">#812&lt;/a>] fix: use detectionHandler to perform protocol detection in windows environment to support gRPC&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/851">#851&lt;/a>] fix: upgrade frugal to v0.1.6 for missing stop field&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/845">#845&lt;/a>] fix: fix the problem that RPCStat report status as success when biz handler return err&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/822">#822&lt;/a>] fix(loadbalance): don&amp;rsquo;t share balancer factory when loadbalance is defined by user&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/732">#732&lt;/a>] fix(mux): mux server waits for shardqueue close before shutdown&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/795">#795&lt;/a>] fix(grpc): zero first byte of grpc data frame, which could be random data from mcache&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/668">#668&lt;/a>] fix: fix race problem in queue.go/queue @dugenkui03&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/743">#743&lt;/a>] fix: use sharedTicker for long conn pool to prevent goroutine numbers increase as the number of client increases&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/799">#799&lt;/a>] fix(util): should return when get at least one GOPATH @StellarisW&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/807">#807&lt;/a>] fix(codec): fix fastpb nil ptr when struct fields are all default values&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/794">#794&lt;/a>] fix(tool): fix fastpb codegen by updating dependency&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/787">#787&lt;/a>] fix(tool): the import did not use the new method to render when template append content&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/785">#785&lt;/a>] fix(tool): remove useless combine service files&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/754">#754&lt;/a>] fix: fix the usage of metainfo in grpc scene&lt;/li>
&lt;/ul>
&lt;h3 id="refactor">Refactor&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/814">#814&lt;/a> &lt;a href="https://github.com/cloudwego/kitex/pull/843">#843&lt;/a>] refactor(trans): return error in onRead of defaultServerHandler and close conn in outer method&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/816">#816&lt;/a>] refactor(utils): add utils.GetEnvLogDir and deprecate utils.GetLogDir&lt;/li>
&lt;/ul>
&lt;h3 id="test--docs--chore">Test &amp;amp; Docs &amp;amp; Chore&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/839">#839&lt;/a> &lt;a href="https://github.com/cloudwego/kitex/pull/693">#693&lt;/a>] test: import mockey repo and add usage demo of mockey unit test&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/806">#806&lt;/a>] test(transmeta):add some test cases for tansmeta package&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/761">#761&lt;/a>] docs: update README.md @fuergaosi233&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/817">#817&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/832">#832&lt;/a>] chore: upgrade dependency lib to adapt go 1.20&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/772">#772&lt;/a>] chore: modify kitex gen code meta file name from kitex.yaml to kitex_info.yaml&lt;/li>
&lt;/ul></description></item><item><title>Blog: Hertz Release v0.6.0</title><link>https://www.cloudwego.io/blog/2023/03/02/hertz-release-v0.6.0/</link><pubDate>Thu, 02 Mar 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/03/02/hertz-release-v0.6.0/</guid><description>
&lt;p>In version 0.6.0 of Hertz, in addition to regular iterative optimization, we also brought several important features.&lt;/p>
&lt;h2 id="http-trailer-support">HTTP Trailer support&lt;/h2>
&lt;p>In Hertz v0.6.0, we support encoding and parsing of HTTP Trailer.&lt;/p>
&lt;blockquote>
&lt;p>&lt;a href="https://github.com/cloudwego/hertz-examples/tree/main/trailer">https://github.com/cloudwego/hertz-examples/tree/main/trailer&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>Write Trailer&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// server&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">handler&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">c&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">app&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">RequestContext&lt;/span>&lt;span style="color:#000;font-weight:bold">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Header&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Trailer&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#000">Set&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;Hertz&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Good&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// client&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">req&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Header&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Trailer&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#000">Set&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;Hertz&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Good&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>Read Trailer&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// server&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">handler&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">c&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">app&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">RequestContext&lt;/span>&lt;span style="color:#000;font-weight:bold">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Header&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Trailer&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#000">Get&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;Hertz&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">// client&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">resp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Header&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Trailer&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#000">Get&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;Hertz&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="http11-supports-for-response-writer-hijacking">HTTP/1.1 supports for Response Writer hijacking&lt;/h2>
&lt;p>In Hertz v0.6.0, we extended the HTTP/1.1 write request approach. Based on the original write request flow, we support users to hijack the Response Writer in the business handler/middleware to achieve a more flexible write request approach.&lt;/br>
In simple terms, all the original &amp;ldquo;underlying write&amp;rdquo; logic is unified behind the handler/middleware return, which has two obvious limitations.&lt;/p>
&lt;ol>
&lt;li>The user has no control over the timing of the request flush to the other end&lt;/li>
&lt;li>For the scenario of incremental data generation &amp;amp; real-time writing to the peer by chunk, the usage is relatively complicated and restrictive on top of the old architecture&lt;/li>
&lt;/ol>
&lt;p>Based on this, we extend a Writer that provides the ability to flush request headers and request bodies on its own, while providing support for users to send chunk data on demand. See &lt;a href="https://github.com/cloudwego/hertz/pull/610">https://github.com/cloudwego/hertz/pull/610&lt;/a> for a detailed implementation.&lt;/p>
&lt;h3 id="major-changes">Major Changes&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>Added an interface definition that extends Writer, &lt;code>Writers&lt;/code> that implement this interface can be used to hijack Response Writer:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">ExtWriter&lt;/span> &lt;span style="color:#204a87;font-weight:bold">interface&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">io&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Writer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Flush&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#204a87;font-weight:bold">error&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Finalize will be called by framework before the writer is released.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Implementations must guarantee that Finalize is safe for multiple calls.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Finalize&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#204a87;font-weight:bold">error&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Provides a &lt;code>Chunk Writer&lt;/code> that implements the above interface (you can refer to this for similar requirements): &lt;code>chunkedBodyWrite&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>HTTP/1.1 does the corresponding processing (skipping the default write request logic) for Response write operations where the Writer has been hijacked, and finally calls the &lt;code>Finalize()&lt;/code> method of the &lt;code>ExtWriter&lt;/code> interface to complete a request write back&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="usage">Usage&lt;/h3>
&lt;p>As above, Hertz provides a default &lt;code>ExtWriter&lt;/code> implementation to meet the user&amp;rsquo;s active flush needs in the handler/middleware, and it is very simple to use.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">h&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">GET&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/flush/chunk&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">func&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Context&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">c&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">app&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">RequestContext&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Hijack the writer of response&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">HijackWriter&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">resp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewChunkedBodyWriter&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">GetWriter&lt;/span>&lt;span style="color:#000;font-weight:bold">()))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">for&lt;/span> &lt;span style="color:#000">i&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000">i&lt;/span> &lt;span style="color:#000;font-weight:bold">&amp;lt;&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">10&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000">i&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">++&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Write&lt;/span>&lt;span style="color:#000;font-weight:bold">([]&lt;/span>&lt;span style="color:#204a87">byte&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">fmt&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Sprintf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;chunk %d: %s&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">i&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">strings&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Repeat&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;hi~&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">i&lt;/span>&lt;span style="color:#000;font-weight:bold">))))&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// nolint: errcheck&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Flush&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// nolint: errcheck&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">time&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Sleep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">200&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span> &lt;span style="color:#000">time&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Millisecond&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="scaffolding-tool-usage-optimization--best-practices">Scaffolding Tool Usage Optimization &amp;amp; Best Practices&lt;/h2>
&lt;p>In hz v0.6.0, we have made a number of optimizations to the organization of the generated code, allowing for a more flexible code organization&lt;/p>
&lt;h3 id="major-optimization">Major Optimization&lt;/h3>
&lt;ul>
&lt;li>The &lt;code>new&lt;/code> command supports the &amp;ldquo;router_dir&amp;rdquo; option and works with the existing &amp;ldquo;handler_dir&amp;rdquo; and &amp;ldquo;model_dir&amp;rdquo; to fully customize the path to the IDL generation product; it also persists these custom options in the &amp;ldquo;.hz&amp;rdquo; file, which can be read automatically during &lt;code>update&lt;/code>, reducing the complexity of the command&lt;/li>
&lt;li>Add the ability to search up the &amp;ldquo;go.mod&amp;rdquo; file so that hertz can share the same &amp;ldquo;go module&amp;rdquo; with other projects when it is a subproject&lt;/li>
&lt;li>Add the ability to reference third-party IDL products in the &amp;ldquo;handler&amp;rdquo;, so that IDL products can be maintained separately in the third-party repository and not stored in the project directory, further enhancing IDL management capabilities&lt;/li>
&lt;/ul>
&lt;h3 id="best-practices">Best Practices&lt;/h3>
&lt;p>We have rewritten &amp;ldquo;&lt;a href="https://github.com/cloudwego/biz-demo/pull/26">biz-demo/easy-note&lt;/a>&amp;rdquo; with &amp;ldquo;hz v0.6.0&amp;rdquo; to take advantage of the following hz features&lt;/p>
&lt;ul>
&lt;li>Generate hertz client call code for accessing &amp;ldquo;api server&amp;rdquo; based on IDL using the capabilities of &amp;ldquo;hz client&amp;rdquo;&lt;/li>
&lt;li>Reorganize the &amp;ldquo;api server&amp;rdquo; code with custom &amp;ldquo;router_dir&amp;rdquo;, &amp;ldquo;handler_dir&amp;rdquo;, and &amp;ldquo;model_dir&amp;rdquo; options, and remove the &amp;ldquo;biz&amp;rdquo; directory restriction&lt;/li>
&lt;li>Use the ability to &amp;ldquo;search up go.mod&amp;rdquo; so that &amp;ldquo;api server&amp;rdquo; can share the same &amp;ldquo;go module&amp;rdquo; as a subproject of &amp;ldquo;easy-note&amp;rdquo;&lt;/li>
&lt;li>Use the ability of &amp;ldquo;handler to refer to third-party IDL products&amp;rdquo; and the ability of &amp;ldquo;hz model&amp;rdquo; to store IDL products separately in the &amp;ldquo;easy-note&amp;rdquo; project and not in the &amp;ldquo;api server&amp;rdquo; subproject&lt;/li>
&lt;/ul>
&lt;h2 id="full-release-note">Full Release Note&lt;/h2>
&lt;p>The complete Release Note can refer to:&lt;/p>
&lt;ul>
&lt;li>Hertz: &lt;a href="https://github.com/cloudwego/hertz/releases/tag/v0.6.0">https://github.com/cloudwego/hertz/releases/tag/v0.6.0&lt;/a>&lt;/li>
&lt;li>Hz(scaffolding): &lt;a href="https://github.com/cloudwego/hertz/releases/tag/cmd%2Fhz%2Fv0.6.0">https://github.com/cloudwego/hertz/releases/tag/cmd%2Fhz%2Fv0.6.0&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Blog: Getting Started with Hertz: Performance Testing Guide</title><link>https://www.cloudwego.io/blog/2023/02/24/getting-started-with-hertz-performance-testing-guide/</link><pubDate>Fri, 24 Feb 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/02/24/getting-started-with-hertz-performance-testing-guide/</guid><description>
&lt;h2 id="background">Background&lt;/h2>
&lt;p>On September 8, 2021, ByteDance officially announced the open-sourcing of &lt;a href="https://github.com/cloudwego">CloudWeGo&lt;/a>.
CloudWeGo is a set of microservices middleware developed by ByteDance, characterized by high performance, strong scalability, and high stability.
It focuses on solving the difficulties of microservices communication and governance, and meets the demands of different businesses in different scenarios.
On June 21, 2022, the CloudWeGo team has officially open-sourced &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a>, ByteDance&amp;rsquo;s largest HTTP framework. Hertz has gained a lot of attention from users since its release,
and has received 3K+ stars by now. Many users have tested it themselves, and we are very grateful for your attention and support.
This blog aims to share the scenarios and technical issues that developers need to be aware of when conducting load testing on Hertz.
These suggestions can help users better optimize Hertz based on real HTTP scenarios to better fit their business needs and achieve optimal performance.
Users can also refer to the official load testing project &lt;a href="https://github.com/cloudwego/hertz-benchmark">hertz-benchmark&lt;/a> for more details.&lt;/p>
&lt;h2 id="characteristics-of-http-microservices">Characteristics of HTTP Microservices&lt;/h2>
&lt;p>&lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> was born out of large-scale microservices practice at ByteDance, and is naturally designed for microservices scenarios.
Therefore, in the following, we will first introduce the characteristics of the HTTP microservices to facilitate developers&amp;rsquo; deeper understanding of &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a>&amp;rsquo;s design considerations.&lt;/p>
&lt;ul>
&lt;li>&lt;strong>HTTP Communication Model&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>Communication between microservices typically follows a Ping-Pong model. In addition to conventional throughput performance metrics, developers also need to consider the average latency of each HTTP request.
While increasing the number of machines can quickly resolve throughput bottlenecks, reducing latency, which significantly affects user experience, is not as easy.&lt;/p>
&lt;p>In the environment of microservices, a single call often requires collaboration from multiple microservices. Even if each node has low latency, the final latency on the entire chain can be amplified.
Therefore, latency is a more critical metric for developers to pay attention to in microservices. &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> has made certain optimizations for latency while ensuring throughput.&lt;/p>
&lt;ul>
&lt;li>&lt;strong>The Use of Long and Short Connections&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>Since establishing a TCP connection requires a three-way handshake, the overhead of creating a new connection for each request can be very high for latency-sensitive services.
Therefore, it is recommended to use persistent connections to complete requests whenever possible. In HTTP 1.1, Long connections are also the default option.
However, there is no silver bullet, as maintaining connections also consumes resources, and the horizontal scalability of persistent connections is not as good as that of short connections.
Therefore, in some scenarios, long connections may not be suitable. For example, in a scenario where configurations need to be pulled periodically,
the connection establishment delay may not have a significant impact on configurations, and it may be more appropriate to use short connections if horizontal scalability is a concern when the configuration center is under high load.&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Packet Size&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>The package size of a service depends on the actual business scenario. In HTTP scenarios, data can be placed in query, path, header, body, etc., and different locations have different effects on parsing.
HTTP header is an identifier protocol, and the framework does not know how many headers there are until it finds a specific identifier. Therefore, the framework needs to receive all the headers before it can complete the parsing,
which is not very friendly to the framework&amp;rsquo;s memory model. &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> has also made special optimizations for header parsing, allocating enough buffer space for headers to reduce the overhead of cross-package copying during header processing.&lt;/p>
&lt;p>Meanwhile, in the internal statistics of online services at ByteDance, it was found that most packages are within 1K (but too small packages have no practical significance, such as a fixed return of &amp;ldquo;hello world&amp;rdquo;).
At the same time, there is no upper limit on the size of large packages, and various package sizes are involved. Therefore, &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> has focused on optimizing the performance (throughput and latency) of packages within the most commonly used range of 128k or less.&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Concurrency Quantity&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>Each instance may have multiple upstreams and will not only accept requests from a single instance. Moreover, HTTP 1 doesn&amp;rsquo;t support multiplexing,
and each connection can only handle one request at a time. Therefore, the Server needs to accept multiple connections and process them simultaneously.&lt;/p>
&lt;p>Different services have different connection utilization rates. For example, load testing services have high connection utilization rates, and a new request is made immediately after the completion of the previous request.
Some services have low connection utilization rates, even though they are long-lived, they are only used once. The connection models used by these two services are not the same.&lt;/p>
&lt;p>For the former, the goroutine per connection model should be used to reduce the overhead of context switching. For the latter, a coroutine pool should be used to reduce the scheduling overhead of too many goroutines.
&lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> supports both models, and users can choose the appropriate configuration based on their business needs.&lt;/p>
&lt;h2 id="load-testing-for-http-scenarios">Load Testing for HTTP Scenarios&lt;/h2>
&lt;h3 id="using-scenarios-that-resemble-real-usage">Using Scenarios That Resemble Real Usage&lt;/h3>
&lt;p>There are many load testing projects on GitHub and performance testing reports available online, but they may not be tailored to your specific needs.
For example, in a real-world scenario, would you create a project that only responds with &lt;strong>&lt;code>hello world&lt;/code>&lt;/strong> no matter what the client sends? Unfortunately, many load testing projects do just that.&lt;/p>
&lt;p>Before conducting load testing, consider your actual usage scenarios, such as:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Long vs Short Connections&lt;/strong>: Determine whether using long or short connections is more suitable for your scenario.&lt;/li>
&lt;li>&lt;strong>Estimating Connection Usage&lt;/strong>: If using long connections and connection usage is high (which is the case in most scenarios), use the default configuration.
If connection usage is low, consider adding the configuration option &lt;strong>&lt;code>server.WithIdleTimeout(0)&lt;/code>&lt;/strong> to modify the goroutine per connection model to a coroutine pool model and conduct comparative testing.&lt;/li>
&lt;li>&lt;strong>Determining Data Location and Size&lt;/strong>: As mentioned earlier, data in different locations (such as query, header, body, etc.) and of different sizes can affect the framework&amp;rsquo;s performance.
If the performance of all frameworks is similar, consider using a different data transmission location.&lt;/li>
&lt;li>&lt;strong>Determining Concurrency Quantity&lt;/strong>: Some services are lightweight on business logic but heavy on framework, resulting in high framework concurrency.
Conversely, some services are heavy on business logic but light on framework, resulting in low framework concurrency.&lt;/li>
&lt;/ul>
&lt;p>If you just want to test the performance of the framework, you can use the common scenario: &lt;strong>long connection, high connection usage, 1k body, 100 concurrency&lt;/strong>, and so on.
The &lt;a href="https://github.com/cloudwego/hertz-benchmark">hertz-benchmark&lt;/a> repository also uses this default load test configuration.
At the same time, the &lt;a href="https://github.com/cloudwego/hertz-benchmark">hertz-benchmark&lt;/a> repository also provides configuration options for users to modify headers, body, and concurrency, making it easy to customize the load test to fit their own needs.&lt;/p>
&lt;h3 id="determine-the-target-of-load-testing">Determine the Target of Load Testing&lt;/h3>
&lt;p>Measuring the performance of an RPC framework requires thinking from two perspectives: the Client perspective and the Server perspective. In a large-scale business architecture,
the upstream Client may not necessarily use the downstream framework, and the downstream services called by developers are also likely to be different. This is even more complicated when considering the situation of Service Mesh.&lt;/p>
&lt;p>Some load testing projects usually conduct load testing for Client and Server processes in a hybrid deployment, and then obtain performance data for the &lt;strong>entire framework&lt;/strong>, which may not be consistent with the actual operation in production.&lt;/p>
&lt;p>If you want to conduct load testing the Server, you should give the Client as many resources as possible and push the Server to the limit, and vice versa.
If both the Client and Server are only given 4 cores for load testing, developers will not be able to determine the performance data under which perspective, let alone provide actual reference for online services.&lt;/p>
&lt;h3 id="use-dedicated-cpus">Use Dedicated CPUs&lt;/h3>
&lt;p>Although online applications usually share CPUs among multiple processes, in a load testing scenario, both the Client and Server processes are extremely busy. Sharing CPUs at this time will result in a large number of context switches, which will make the data less reliable and prone to large fluctuations.&lt;/p>
&lt;p>Therefore, we recommend isolating Client and Server processes on different CPUs or different dedicated machines. If you want to further avoid the impact of other processes, you can also use the nice -n -20 command to increase the scheduling priority of the load testing process.&lt;/p>
&lt;p>In addition, if conditions permit, using physical machines instead of virtual machines on cloud platforms will make the test results more rigorous and reproducible.&lt;/p>
&lt;h2 id="performance-data-reference">Performance Data Reference&lt;/h2>
&lt;p>On the premise of meeting the above requirements, we compared the load testing result of multiple frameworks based on the latest version. The pressure test code is in the &lt;a href="https://github.com/cloudwego/hertz-benchmark">hertz-benchmark&lt;/a> repository.
With the goal of fully filling the load of Server, &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> has the lowest P99 latency of all the frameworks tested, and the throughput is also in the first tier and under continuous optimization.&lt;/p>
&lt;ul>
&lt;li>CPU: AMD EPYC 7Y83 64-Core Processor 2.7GHz
&lt;ul>
&lt;li>limits: server 4-CPUs，client 16-CPUS&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>OS：Debian GNU/Linux 10 (buster)&lt;/li>
&lt;li>Go 1.19&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudwego/hertz/releases/tag/v0.3.2">hertz v0.3.2&lt;/a>，&lt;a href="https://github.com/valyala/fasthttp/releases/tag/v1.40.0">fasthttp v1.40.0&lt;/a>，
&lt;a href="https://github.com/gin-gonic/gin/releases/tag/v1.8.1">gin v1.8.1&lt;/a>，&lt;a href="https://github.com/gofiber/fiber/releases/tag/v2.38.1">fiber v2.38.1&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Hertz-benchmark/1.png" alt="image">&lt;/p>
&lt;p align="center">Comparison of throughput and latency of four frameworks&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Hertz-benchmark/2.png" alt="image">&lt;/p>
&lt;p align="center">Comparison of throughput and latency of three frameworks&lt;/p>
&lt;h2 id="conclusion">Conclusion&lt;/h2>
&lt;p>As a very large scale enterprise microservices HTTP framework, &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> was designed to solve a variety of problems in the large-scale microservices scenario.
In the process of promotion, we encountered all kinds of services and solved many kinds of problem.
Based on those experience, we wrote this blog. As a developer, you are always welcome to choose the right tool for your own scenario based on the testing guide provided above.
If you have any questions, feel free to raise an &lt;a href="https://github.com/cloudwego/hertz/issues">Issue&lt;/a>.&lt;/p></description></item><item><title>Blog: Volo Release 0.3.2</title><link>https://www.cloudwego.io/blog/2023/02/07/volo-release-0.3.2/</link><pubDate>Tue, 07 Feb 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/02/07/volo-release-0.3.2/</guid><description>
&lt;p>In Volo 0.3.2 version, in addition to general bugfixes, there are many improvements.
In particular, it is very much appreciated that there are community contributors who have brought us important features.&lt;/p>
&lt;h2 id="trait-support-for-thrift-asynchronous-codec">Trait support for Thrift asynchronous codec&lt;/h2>
&lt;p>&lt;a href="https://github.com/ii64">@ii64&lt;/a> brought us the definition of Thrift asynchronous codec Trait in &lt;a href="https://github.com/cloudwego/volo/pull/123">#123&lt;/a> as well as the implementation of Binary and Apache Compact Protocol.
Before that he also contributed the underlying implementation of codec to Pilota!&lt;/p>
&lt;h2 id="support-for-grpc-graceful-shutdown">Support for gRPC graceful shutdown&lt;/h2>
&lt;p>&lt;a href="https://github.com/iGxnon">@iGxnon&lt;/a> brought us support for gRPC graceful shutdown in &lt;a href="https://github.com/cloudwego/volo/pull/127">#127&lt;/a>!&lt;/p>
&lt;h2 id="version-update-for-metainfo-and-faststr">Version update for metainfo and faststr&lt;/h2>
&lt;p>In this release, we updated the versions of metainfo and faststr so that metainfo also supports faststr to minimize memory allocation and copy in as many scenarios as possible to optimize performance.&lt;/p>
&lt;p>faststr is a string library we modify with reference to smol_str, which implements a zero-cost clone of immutable string.&lt;/p>
&lt;p>In addition, FastStr has an incompatible change: previously it implemented &lt;code>From&lt;/code> for all &lt;code>AsRef&amp;lt;str&amp;gt;&lt;/code>, but doing so causes the additional memory allocation and copy overhead when using &lt;code>into&lt;/code> directly.
In the new version of 0.2, we only implement &lt;code>From&lt;/code> for &lt;code>'static str&lt;/code>、&lt;code>String&lt;/code>、&lt;code>Arc&amp;lt;str&amp;gt;&lt;/code>、&lt;code>Arc&amp;lt;String&amp;gt;&lt;/code>.
There&amp;rsquo;s no overhead for these four types to use &lt;code>into&lt;/code> to convert to FastStr, in a form that avoids memory allocation and copy problems inadvertently brought on by the user.&lt;/p>
&lt;p>The old version of &lt;code>From&lt;/code> essentially called &lt;code>FastStr::new(s)&lt;/code>, so if there was an incompatibility problem, you could simply call &lt;code>FastStr::new&lt;/code> explicitly instead.&lt;/p>
&lt;h2 id="pilota-supports-faststr-generation-for-protobuf-codec">Pilota supports FastStr generation for Protobuf codec&lt;/h2>
&lt;p>By supporting FastStr generation for Protobuf codec in Pilota, we can bring our performance optimization capabilities to PB and gRPC.&lt;/p>
&lt;p>After upgrading, we need to use &lt;code>use pilota::prost::message::Message;&lt;/code> instead of &lt;code>use prost::Message;&lt;/code> introduced previously.&lt;/p>
&lt;h2 id="full-release-notes">Full Release Notes&lt;/h2>
&lt;p>For the full Release Notes, please refer to: &lt;a href="https://github.com/cloudwego/volo/compare/volo-0.3.0...volo-0.3.2">Volo Changelog&lt;/a>&lt;/p></description></item><item><title>Blog: Hertz Release v0.5.0</title><link>https://www.cloudwego.io/blog/2023/01/12/hertz-release-v0.5.0/</link><pubDate>Thu, 12 Jan 2023 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2023/01/12/hertz-release-v0.5.0/</guid><description>
&lt;p>In version 0.5.0 of Hertz, in addition to regular iterative optimization, we also brought several important features.&lt;/p>
&lt;h2 id="network-layer-and-protocol-layer-support-stream-based-interface">Network layer and protocol layer support stream-based interface&lt;/h2>
&lt;blockquote>
&lt;p>&lt;a href="https://github.com/cloudwego/hertz/pull/467">https://github.com/cloudwego/hertz/pull/467&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>In the Hertz v0.5.0 version, we have further enhanced the scalability of the Hertz transport layer &amp;amp; protocol layer, supporting the seamless connection of the stream-based transport layer protocol QUIC, and the &lt;a href="https://github.com/cloudwego/hertz/issues/458">HTTP3 protocol&lt;/a> built on top of it.
In addition, on this basis, we have added and improved functions such as &amp;ldquo;ALPN&amp;rdquo; (application layer protocol negotiation), &amp;ldquo;QUIC/TLS parallel monitoring&amp;rdquo; (QUIC/TLS parallel monitoring), &amp;ldquo;Alt-Svc&amp;rdquo; (alternative service).&lt;/p>
&lt;h3 id="major-changes">Major Changes&lt;/h3>
&lt;h4 id="transport-layer">Transport layer&lt;/h4>
&lt;p>On the basis of ensuring compatibility performance, we have added an abstract stream-based network connection interface &lt;code>StreamConn&lt;/code>, and adjusted the interaction logic between the transport layer and the protocol layer to achieve the correct protocol layer for the distribution of connection types Processing (protocol server).
For scenarios that need to monitor TCP (TLS) and UDP (QUIC) at the same time, we provide a &lt;code>WithAltTransporter&lt;/code> option, which facilitates passing the backup transporter to the main transporter, and facilitates the ability to monitor QUIC/TLS in parallel.&lt;/p>
&lt;h4 id="protocol-layer">Protocol Layer&lt;/h4>
&lt;p>Support adding a stream-based protocol layer implementation (protocol server) &lt;code>StreamServer&lt;/code>, so as to build a corresponding processing protocol (HTTP/3) on top of the newly added stream-based transport layer extension.
In order to facilitate the configuration of alternative service meta-information for a main protocol (HTTP/3), &lt;code>ProtocolSuite&lt;/code> exposes the &lt;code>SetAltHeader&lt;/code> interface.
At the same time, we also designed the ALPN capability for &lt;code>StreamConn&lt;/code>, so as to provide the ability of protocol negotiation in QUIC.&lt;/p>
&lt;h4 id="common-layer">Common layer&lt;/h4>
&lt;p>At the same time, we have added an auxiliary function that can convert with the Golang standard Handler in the general layer, so as to quickly port the implementation based on the Golang standard Handler to Hertz. The &lt;a href="https://github.com/hertz-contrib/http3">QUIC &amp;amp; HTTP/3 extension&lt;/a> based on &lt;a href="https://github.com/lucas-clemente/quic-go">quic-go&lt;/a> provided later /pull/1), the capabilities provided by this function are used.&lt;/p>
&lt;h4 id="feature-status">Feature Status&lt;/h4>
&lt;p>The Hertz core library capability has been released, and the specific implementation will be released in the form of &lt;a href="https://github.com/hertz-contrib/http3/pull/1">extension package&lt;/a>, welcome to try~&lt;/p>
&lt;p>For more detailed design instructions, please refer to: &lt;a href="https://www.cloudwego.io/zh/blog/2023/08/02/hertz-%E6%94%AF%E6%8C%81-quic-http/3/">Hertz supports QUIC &amp;amp; HTTP/3&lt;/a>&lt;/p>
&lt;h2 id="scaffolding-tools-support-generating-hertz-client-code">Scaffolding tools support generating hertz client code&lt;/h2>
&lt;blockquote>
&lt;p>&lt;a href="https://github.com/cloudwego/hertz/pull/471">https://github.com/cloudwego/hertz/pull/471&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>In the v0.5.0 version of the scaffolding tool (Hz), we support the function of automatically generating the hertz client code based on IDL, and realize the one-click call of the HTTP request in the form of an RPC call.
Instructions:&lt;/p>
&lt;blockquote>
&lt;p>For details, see: &lt;a href="https://github.com/cloudwego/hertz-examples/tree/main/hz_client">https://github.com/cloudwego/hertz-examples/tree/main/hz_client&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>Define the IDL&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">namespace&lt;/span> &lt;span style="color:#204a87;font-weight:bold">go&lt;/span> &lt;span style="color:#000">toutiao&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">middleware&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hzClient&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000">QueryReq&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">string&lt;/span> &lt;span style="color:#000">QueryValue&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">api&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span> &lt;span style="color:#000">query&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;query1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000">Resp&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">string&lt;/span> &lt;span style="color:#000">Resp&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">service&lt;/span> &lt;span style="color:#000">Hertz121&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Resp&lt;/span> &lt;span style="color:#000">QueryMethod&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000">QueryReq&lt;/span> &lt;span style="color:#000">request&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">api&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">get&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/query&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">api&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span> &lt;span style="color:#000">handler_path&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;get&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">api&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">base_domain&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;http://127.0.0.1:8888&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>Generate code&lt;/li>
&lt;/ol>
&lt;p>Based on the above IDL, the server and client codes can be generated separately:&lt;/p>
&lt;p>Server:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">hz&lt;/span> &lt;span style="color:#000">new&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">--&lt;/span>&lt;span style="color:#000">idl&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#000">psm&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">thrift&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">--&lt;/span>&lt;span style="color:#000">handler_by_method&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#000">t&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#000">template&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#000">slim&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Client:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">hz&lt;/span> &lt;span style="color:#000">client&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">--&lt;/span>&lt;span style="color:#000">idl&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#000">psm&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">thrift&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">--&lt;/span>&lt;span style="color:#000">model_dir&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#000">hertz_gen&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#000">t&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#000">template&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#000">slim&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">--&lt;/span>&lt;span style="color:#000">client_dir&lt;/span>&lt;span style="color:#000;font-weight:bold">=&lt;/span>&lt;span style="color:#000">hz_client&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>Call the client code to initiate an HTTP request to realize the intercommunication between the client end and the server end&lt;/li>
&lt;/ol>
&lt;h2 id="full-release-note">Full Release Note&lt;/h2>
&lt;p>The complete Release Note can refer to:&lt;/p>
&lt;ul>
&lt;li>Hertz: &lt;a href="https://github.com/cloudwego/hertz/releases/tag/v0.5.0">https://github.com/cloudwego/hertz/releases/tag/v0.5.0&lt;/a>&lt;/li>
&lt;li>Hz(scaffolding): &lt;a href="https://github.com/cloudwego/hertz/releases/tag/cmd%2Fhz%2Fv0.5.0">https://github.com/cloudwego/hertz/releases/tag/cmd%2Fhz%2Fv0.5.0&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Blog: Volo Release 0.3.0</title><link>https://www.cloudwego.io/blog/2022/12/22/volo-release-0.3.0/</link><pubDate>Thu, 22 Dec 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/12/22/volo-release-0.3.0/</guid><description>
&lt;p>In Volo 0.3.0 version, in addition to regular bugfixes, we also brought several important features.&lt;/p>
&lt;h2 id="service-trait-refactoring">Service Trait refactoring&lt;/h2>
&lt;p>In version 0.3.0 of Volo, we refactored &lt;code>Service&lt;/code> Trait to make the implementation of &lt;code>Service&lt;/code> Trait easier and provide more flexibility.&lt;/p>
&lt;p>Specifically, we changed the definition of &lt;code>Service&lt;/code> Trait from:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">pub&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">trait&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Responses given by the service.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Errors produced by the service.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// The future response value.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>: &lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Send&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">where&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Cx&lt;/span>: &lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>: &lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Process the request and return the response asynchronously.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">call&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cx&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span> &lt;span style="color:#000">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>: &lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">Self&lt;/span>::&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">where&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>: &lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>changed to:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">pub&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">trait&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Responses given by the service.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Errors produced by the service.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// The future response value.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>: &lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">Output&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Result&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Response&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>::&lt;span style="color:#000">Error&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87">Send&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">where&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Cx&lt;/span>: &lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">Self&lt;/span>: &lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">/// Process the request and return the response asynchronously.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">call&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#3465a4">self&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cx&lt;/span>: &lt;span style="color:#204a87;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span> &lt;span style="color:#000">mut&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Cx&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">req&lt;/span>: &lt;span style="color:#000">Request&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>-&amp;gt; &lt;span style="color:#000">Self&lt;/span>::&lt;span style="color:#000">Future&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">where&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#c4a000">&amp;#39;s&lt;/span>: &lt;span style="color:#c4a000">&amp;#39;cx&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The most obvious change is that the self parameter of the Service Trait method call() is changed from &lt;code>&amp;amp;mut self&lt;/code> to &lt;code>&amp;amp;self&lt;/code>. The purpose of this is that if we relied on &lt;code>&amp;amp;mut self&lt;/code> before, we have to clone to take ownership before calling, and we need &lt;code>Service&lt;/code> users to ensure that the overhead of Clone is low; in fact, this clone is completely unnecessary, and this decision should be handed over to the user to decide. If there is a need to change the internal state, they can lock it internally or use atomic, which can save the cost of cloning.&lt;/p>
&lt;h2 id="grpc-multi-service-support">gRPC multi-Service support&lt;/h2>
&lt;p>In this version, we also support the scenario where the gRPC server supports multiple Services at the same time, and each Service can have its own layer; of course, the Server can also have a globally valid layer.&lt;/p>
&lt;p>If a middleware needs to perceive the specific type of Request / Response and process it, or only for a single Service, it can be added as the Service&amp;rsquo;s own layer.&lt;/p>
&lt;p>This is a breaking change. Users of previous versions may need to modify the code. Specifically, it needs to change from this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">#[volo::main]&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">addr&lt;/span>: &lt;span style="color:#000">SocketAddr&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;[::]:8080&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">parse&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#000">unwrap&lt;/span>&lt;span style="color:#000;font-weight:bold">();&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">addr&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">volo&lt;/span>::&lt;span style="color:#000">net&lt;/span>::&lt;span style="color:#000">Address&lt;/span>::&lt;span style="color:#000">from&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">addr&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">volo_gen&lt;/span>::&lt;span style="color:#000">proto_gen&lt;/span>::&lt;span style="color:#000">hello&lt;/span>::&lt;span style="color:#000">HelloServiceServer&lt;/span>::&lt;span style="color:#000">new&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">S&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">run&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">addr&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">unwrap&lt;/span>&lt;span style="color:#000;font-weight:bold">();&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Change it to this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">use&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">std&lt;/span>::&lt;span style="color:#000">net&lt;/span>::&lt;span style="color:#000">SocketAddr&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">use&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">volo_grpc&lt;/span>::&lt;span style="color:#000">server&lt;/span>::&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#000">Server&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ServiceBuilder&lt;/span>&lt;span style="color:#000;font-weight:bold">};&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#[volo::main]&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">async&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">fn&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">addr&lt;/span>: &lt;span style="color:#000">SocketAddr&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;[::]:8080&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">parse&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>&lt;span style="color:#000">unwrap&lt;/span>&lt;span style="color:#000;font-weight:bold">();&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">let&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">addr&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">volo&lt;/span>::&lt;span style="color:#000">net&lt;/span>::&lt;span style="color:#000">Address&lt;/span>::&lt;span style="color:#000">from&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">addr&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Server&lt;/span>::&lt;span style="color:#000">new&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">add_service&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ServiceBuilder&lt;/span>::&lt;span style="color:#000">new&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">volo_gen&lt;/span>::&lt;span style="color:#000">proto_gen&lt;/span>::&lt;span style="color:#000">hello&lt;/span>::&lt;span style="color:#000">GreeterServer&lt;/span>::&lt;span style="color:#000">new&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">S&lt;/span>&lt;span style="color:#000;font-weight:bold">)).&lt;/span>&lt;span style="color:#000">build&lt;/span>&lt;span style="color:#000;font-weight:bold">())&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">run&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">addr&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#204a87;font-weight:bold">await&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">unwrap&lt;/span>&lt;span style="color:#000;font-weight:bold">();&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="grpc-compression">gRPC Compression&lt;/h2>
&lt;p>Thanks to &lt;a href="https://github.com/tuchg">@tuchg&lt;/a> for bringing us gRPC compression and decompression support in &lt;a href="https://github.com/cloudwego/volo/pull/91">#91&lt;/a> , if there is a requirement for the transmission size, this function can be used.&lt;/p>
&lt;h2 id="thrift-codec-refactoring">Thrift Codec refactoring&lt;/h2>
&lt;p>In the previous Codec design, Thrift codec was specified by &lt;code>CodecType&lt;/code>, which brought two problems:&lt;/p>
&lt;ol>
&lt;li>It is not easy to extend new protocol support, all supported protocols need to be implemented in the framework and hard-coded into CodecType;&lt;/li>
&lt;li>It is impossible to decouple and arrange the Transport and Serialize protocols. For example, if we want to support the TCompact protocol, then we need to add multiple variants: TTHeaderFramedCompact, TTheaderCompact, FramedCompact, Compact&amp;hellip;&lt;/li>
&lt;/ol>
&lt;p>At the same time, the previous codec did not achieve Zero Copy, and there is room for improvement in performance.&lt;/p>
&lt;p>This refactoring solves all the above problems at once. We no longer rely on &lt;code>CodecType&lt;/code> to specify the codec method, but use the &lt;code>make_codec&lt;/code> interface to specify the Codec generation method, so that we can easily Expand new protocol support, and also decouple and arrange Transport and Serialize protocols.&lt;/p>
&lt;p>For details, please refer to &lt;a href="https://docs.rs/volo-thrift/latest/volo_thrift/codec/index.html">codec documentation&lt;/a>.&lt;/p>
&lt;h2 id="thrift-generated-code-default-field-change">Thrift generated code default field change&lt;/h2>
&lt;p>In the previous generated code, the binary type will generate &lt;code>Vec&amp;lt;u8&amp;gt;&lt;/code>, and the string type will generate String, which will cause a clone to be performed when decoding and encoding, and the performance loss will be large; in this version, we will use these two The Rust type generated by default for this type has been changed to Bytes and &lt;a href="https://docs.rs/faststr/latest/faststr/">FastStr&lt;/a> to achieve full-link Zero Copy, because in practice we have observed absolutely Most of the binary and string in Request / Response will not be modified, and even if the user needs to modify, it is at the cost of one Clone, and the performance will not be worse than before.&lt;/p>
&lt;p>This is a breaking change. Users of previous versions may need to modify the code after upgrading. Generally speaking, only need to modify the type according to the error message.&lt;/p>
&lt;p>If there is still a need to generate &lt;code>String&lt;/code> for string, you can add an annotation of &lt;code>pilota.rust_type=&amp;quot;string&amp;quot;&lt;/code> to the corresponding field in the thrift idl file, as follows:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-thrift" data-lang="thrift">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">struct&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Item&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">required&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">name&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>&lt;span style="color:#000">pilota&lt;/span>&lt;span style="color:#a40000">.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">rust_type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;string&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In addition, Pilota also supports other annotations. For details, please refer to: &lt;a href="https://www.cloudwego.io/docs/volo/pilota/#pilota-supported-annotations">Pilota Supported Annotations&lt;/a>&lt;/p>
&lt;h2 id="full-release-note">Full Release Note&lt;/h2>
&lt;p>The complete Release Note can be referred to: &lt;a href="https://github.com/cloudwego/volo/releases/tag/volo-0.3.0">https://github.com/cloudwego/volo/releases/tag/volo-0.3.0&lt;/a>&lt;/p></description></item><item><title>Blog: Kitex Proxyless Practice：Traffic Lane Implementation with Istio and OpenTelemetry</title><link>https://www.cloudwego.io/blog/2022/12/20/kitex-proxyless-practicetraffic-lane-implementation-with-istio-and-opentelemetry/</link><pubDate>Tue, 20 Dec 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/12/20/kitex-proxyless-practicetraffic-lane-implementation-with-istio-and-opentelemetry/</guid><description>
&lt;blockquote>
&lt;p>Preface: Kitex Proxyless enables the Kitex service to interact directly with istiod without envoy sidecar. It dynamically obtains service governance rules
delivered by the control plane based on the xDS protocol and converts them to Kitex rules to implement some service governance functions, such as traffic routing.
Based on Kitex Proxyless, Kitex can be managed by Service Mesh without sidecar. Besides, the governance rule Spec, governance control plane, governance delivery protocol,
and heterogeneous data governance capability can be unified under multiple deployment modes. By rewriting the bookinfo project using Kitex and Hertz, it demonstrates how to implement a traffic lane using xDS protocol.&lt;/p>
&lt;/blockquote>
&lt;h2 id="01-introduction">01 Introduction&lt;/h2>
&lt;h3 id="kitex-proxyless">&lt;strong>Kitex Proxyless&lt;/strong>&lt;/h3>
&lt;p>&lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a> is a Golang RPC framework open-sourced by ByteDance that already natively supports the xDS standard protocol and can be managed by Service Mesh in Proxyless way.
Refer to this doc for detailed design: &lt;a href="https://github.com/cloudwego/kitex/issues/461">Proposal: Kitex support xDS Protocol&lt;/a>.
Official doc is also available here at &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/advanced-feature/xds/">Kitex/Tutorials/Advanced Feature/xDS Support&lt;/a>&lt;/p>
&lt;p>Kitex Proxyless Simply means that Kitex services can interact directly with istiod without envoy sidecar and dynamically obtain service governance rules delivered by the control plane based on the xDS protocol.
And those rules will be translated into Kitex corresponding rules to implement some service governance functions (such as traffic routing which is the focus of this blog).&lt;/p>
&lt;p>Based on Kitex Proxyless, Kitex application can be managed by Service Mesh in a unified manner without sidecar, and thus the governance rule Spec, governance control plane,
governance delivery protocol, and heterogeneous data governance capability can be unified under multiple deployment modes.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/unify_architecture.svg" alt="image">&lt;/p>
&lt;h3 id="traffic-routing">Traffic Routing&lt;/h3>
&lt;p>Traffic routing refers to the ability to route traffic to a specified destination based on its specific metadata identifier.&lt;/p>
&lt;p>Traffic routing is one of the core capabilities in service governance and one of the scenarios that Kitex Proxyless supports in the first place.&lt;/p>
&lt;p>The approach of &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a> implementing traffic routing base on xDS is as follows:&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/2.png" alt="image">&lt;/p>
&lt;p>Specific procedure:&lt;/p>
&lt;ol>
&lt;li>Add an xDS Router MW to Pick Cluster (routing) and watch LDS and RDS of target services.&lt;/li>
&lt;li>Aware of LDS changes and extract the Filter Chain and inline RDS in the LDS of the target service.&lt;/li>
&lt;li>Aware of RDS changes and obtain the route configuration of the target service based on VirtualHost and ServiceName matching. (Prefix, suffix, exact, and wildcard are supported)&lt;/li>
&lt;li>The routing rules in the matched RDS are traversed and processed. The routing rules are divided into two parts (refer to the routing specification definition) :&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>Match:
&lt;ul>
&lt;li>Path(required): Extract Method from rpcinfo for matching;&lt;/li>
&lt;li>HeaderMatcher(optional): Extract the corresponding metadata KeyValue from the metainfo and match it.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Route：
&lt;ul>
&lt;li>Cluster ：Standard Cluster.&lt;/li>
&lt;li>WeightedClusters(Weight routing) : cluster is selected according to weight within MW.&lt;/li>
&lt;li>Write the selected Cluster to the EndpointInfo.Tag for later service discovery.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>As you can see, traffic routing is a process of selecting the corresponding SubCluster according to certain rules.&lt;/p>
&lt;h2 id="02-traffic-lane">02 Traffic Lane&lt;/h2>
&lt;p>Based on traffic routing capability, we can extend many usage scenarios, such as: A/B testing, canary release, blue-green release, etc., and the focus of this paper: Traffic Lane.&lt;/p>
&lt;p>The traffic lane can be understood as splitting a group of service instances in a certain way (such as deployment environment), and based on the routing capability and global metadata,
so that traffic can flow in the specified service instance lanes in accordance with the exact rules (logically similar to lanes in a swimming pool). Traffic lane can be used for full-path grey release.&lt;/p>
&lt;p>In Istio we typically group instances with DestinationRule subset, splitting a service into multiple subsets (e.g. Based on attributes such as version and region)
and then work with VirtualService to define the corresponding routing rules and route the traffic to the corresponding subset. In this way, the single-hop routing capability in the lane is realized.&lt;/p>
&lt;p>However, traffic routing capability alone is not enough to realize traffic lane. We need a good mechanism to accurately identify the traffic
and configure routing rules for each hop traffic based on this feature when a request spans multiple services.&lt;/p>
&lt;p>As shown in the following figure: Suppose we want to implement a user request that is accurately route to the v1 version of service-b.
The first thought might be to put a &lt;code>uid = 100&lt;/code> in the request header and configure the corresponding VirtualService to match the &lt;code>uid = 100&lt;/code> in the header.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/3.png" alt="image">&lt;/p>
&lt;p>But it has several obvious drawbacks for this approach:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Not common enough&lt;/strong>: If a specific business attribute (such as uid) is used as a traffic route matching rule, the business attribute must be manually transmitted through the full path.
This is highly intrusive to business and requires business cooperation. In addition, when we want to use other business attributes, all services on the full path need to change to adapt. Therefore, it is a very unusual practice.&lt;/li>
&lt;li>Routing rules are prone to frequent changes, resulting in &lt;strong>rule overcrowding&lt;/strong>. Routing rules are identified by specific business attributes (for example: uid) is used as a traffic route matching rule.
If you want to change a business attribute or set a routing rule for other users, you need to modify the original routing rule or repeatedly define multiple routing rules for different business attributes, which easily causes route rule overcrowding and is difficult to maintain.&lt;/li>
&lt;/ol>
&lt;p>Therefore, in order to achieve uniform traffic routing across the full path, we also need to use a more general traffic dyeing and the capability to transmit the dye identifier through the full path.&lt;/p>
&lt;h3 id="traffic-dyeing">Traffic Dyeing&lt;/h3>
&lt;p>Traffic dyeing refers to marking the request traffic with a special identifier and carrying this identifier in the full request path.
The so-called traffic lane means that all services in the path sets traffic routing rules based on the uniform gray traffic dyeing identifier so that the traffic can be accurately controlled in different lanes.&lt;/p>
&lt;p>Usually, traffic dyeing is done at the gateway layer, and the metadata in the original request is converted into corresponding dye identifiers according to certain rules (conditions and proportions).&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Dyeing by conditions&lt;/strong>: when the request metadata meets certain conditions (such as &lt;code>uid = 100&lt;/code> in the request header and cookie matching), the current request is marked with a dye identifier.&lt;/li>
&lt;li>&lt;strong>Dyeing by proportions&lt;/strong>: the request is marked with a dye identifier in proportion.&lt;/li>
&lt;/ul>
&lt;p>With a unified traffic dyeing mechanism, we do not need to care about specific business attribute identifiers when configuring routing rules. We only need to configure routes based on the dye identifiers.
The specific service attributes are abstracted into conditional dyeing rules to be more universal. Even if the business attributes change, the routing rules do not need to change frequently.&lt;/p>
&lt;h4 id="dye-identifier-transmitting">Dye Identifier Transmitting&lt;/h4>
&lt;p>The dyed identifier is usually transmitted through the Tracing Baggage, which is used to pass business custom KV attributes through the entire call chain (full-path), such as traffic dyeing identifiers and business identifiers such as AccountID.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/4.png" alt="image">&lt;/p>
&lt;p>We usually use the Tracing Baggage mechanism to transmit the corresponding dye identifiers through the full-path. Most of the Tracing frameworks support the Baggage concept, such as: OpenTelemetry, Skywalking, Jaeger, etc.&lt;/p>
&lt;p>With a set of universal full-path transmitting mechanism, the service only needs to config the tracing once, and there is no need to adapt every time the service attribute identifier changes.&lt;/p>
&lt;p>Next part introduces and demonstrates how to implement the traffic lane based on Kitex Proxyless and OpenTelemetry Baggage by using a specific engineering example.&lt;/p>
&lt;h2 id="03-demo-introductionbookinfo">03 Demo Introduction：Bookinfo&lt;/h2>
&lt;p>The demo is a rewriting of the &lt;a href="https://istio.io/latest/zh/docs/examples/bookinfo/">Istio Bookinfo&lt;/a> project using &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> and &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a>:&lt;/p>
&lt;ul>
&lt;li>Use &lt;strong>istiod&lt;/strong> as the xDS server and the entry for CRD configuration and delivery.&lt;/li>
&lt;li>Use &lt;strong>wire&lt;/strong> to implement dependency injection;&lt;/li>
&lt;li>Use &lt;strong>opentelemetry&lt;/strong> to implement full path tracing;&lt;/li>
&lt;li>Use &lt;a href="https://github.com/kitex-contrib/xds">Kitex-xds&lt;/a> and &lt;strong>opentelemetry baggage&lt;/strong> to implement a traffic lane in proxyless mode;&lt;/li>
&lt;li>Implement a &lt;a href="https://github.com/cloudwego/biz-demo/blob/main/bookinfo/README_CN.md">Bookinfo&lt;/a> UI using &lt;strong>arco-design&lt;/strong> and &lt;strong>react&lt;/strong>.&lt;/li>
&lt;/ul>
&lt;h3 id="business-architecture">Business Architecture&lt;/h3>
&lt;p>In keeping with Bookinfo, the overall business architecture is divided into four separate microservices:&lt;/p>
&lt;ul>
&lt;li>&lt;code>productpage&lt;/code> - This microservice calls &lt;code>details&lt;/code> and &lt;code>reviews&lt;/code>;&lt;/li>
&lt;li>&lt;code>details&lt;/code> - This microservice contains information about the book;&lt;/li>
&lt;li>&lt;code>reviews&lt;/code> - This microservice contains book related reviews. It also calls &lt;code>ratings&lt;/code>;&lt;/li>
&lt;li>&lt;code>ratings&lt;/code> - This microservice contains ratings information consisting of book reviews.&lt;/li>
&lt;/ul>
&lt;p>&lt;code>reviews&lt;/code> are available in three versions:&lt;/p>
&lt;ul>
&lt;li>The v1 version calls the ratings service and uses one ⭐️ to display the ratings.&lt;/li>
&lt;li>The v2 version invokes the ratings services, and use five ⭐⭐⭐⭐⭐⭐ to display the ratings.&lt;/li>
&lt;li>The v3 version won&amp;rsquo;t call the ratings service&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/bookinfo.svg" alt="image">&lt;/p>
&lt;h3 id="diagram-of-traffic-lanes">Diagram of Traffic Lanes&lt;/h3>
&lt;p>The whole call chain is divided into 2 lanes:&lt;/p>
&lt;ul>
&lt;li>Base lane: Undyed traffic is routed to the base lane.&lt;/li>
&lt;li>Branch lane: dyed traffic is routed to the branch lane of reviews-v2 -&amp;gt;ratings-v2.&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/lane.svg" alt="image">&lt;/p>
&lt;h3 id="traffic-dyeing-1">Traffic Dyeing&lt;/h3>
&lt;p>The gateway is responsible for traffic dyeing. For example, the request with &lt;code>uid=100&lt;/code> in the request header is dyed and carries baggage of &lt;code>env=dev&lt;/code>.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/dyeing.svg" alt="image">&lt;/p>
&lt;p>The dye mode may vary according to different gateways. For example, when we select istio ingress as the gateway, we can use &lt;strong>EnvoyFilter + Lua&lt;/strong> to write the gateway dye rules.&lt;/p>
&lt;h3 id="workload-labeling">Workload Labeling&lt;/h3>
&lt;ol>
&lt;li>Label the workload with corresponding version identifier.&lt;/li>
&lt;/ol>
&lt;p>Take service &lt;code>reviews&lt;/code> as an example. You only need to label the corresponding pod with &lt;code>version: v1&lt;/code>.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/8.png" alt="image">&lt;/p>
&lt;ol start="2">
&lt;li>Set a series of subsets for the service based on the DestinationRule:&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>Productpage: v1&lt;/li>
&lt;li>Reviews: v1、v2、v3&lt;/li>
&lt;li>Ratings: v1、v2&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/9.png" alt="image">&lt;/p>
&lt;h3 id="traffic-routing-rules">Traffic Routing Rules&lt;/h3>
&lt;p>The gateway has already dyed the request header with &lt;code>uid=100&lt;/code> and automatically loaded &lt;code>env=dev&lt;/code> baggage,
so we only need to match the route according to the header. Here is an example of the route rule configuration:&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/10.png" alt="image">&lt;/p>
&lt;h3 id="check-the-effect">Check the Effect&lt;/h3>
&lt;ol>
&lt;li>Base Lane&lt;/li>
&lt;/ol>
&lt;p>Requests without &lt;code>uid=100&lt;/code> header in the inbound traffic are automatically routed to the base lane, which is a round-robin of v1 and v3 of &lt;code>reviews&lt;/code> service resulting in a round-robin score of 0 and 1.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/bookstore_base.png" alt="image">&lt;/p>
&lt;ol start="2">
&lt;li>Branch Lane&lt;/li>
&lt;/ol>
&lt;p>We use the &lt;strong>mod-header&lt;/strong> plug-in of the browser to simulate the scenario where the &lt;code>uid=100&lt;/code> is carried in the inbound traffic request header.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/12.png" alt="image">&lt;/p>
&lt;p>Click the refresh button again, you can find that the request hits the branch lane, and the traffic lane takes effect successfully.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Kitex_Proxyless/bookstore_branch.jpeg" alt="image">&lt;/p>
&lt;h2 id="04-summary-and-outlook">04 Summary and Outlook&lt;/h2>
&lt;p>So far, we have implemented a complete full-path traffic lane based on Kitex Proxyless and OpenTelemetry.
And we can set corresponding routing rules for Kitex based on Istio standard governance rule Spec without Envoy sidecar.&lt;/p>
&lt;p>In addition to traffic routing capabilities, Kitex Proxyless is also continuously iterating and optimizing to meet more requirements for data plane governance capabilities.
As an exploration and practice of Service Mesh data plane, Proxyless not only can enrich the deployment form of data plane, but also hopes to continuously polish &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a>,
enhance its ability in open source ecological compatibility, and create a more open and inclusive microservice ecosystem.&lt;/p>
&lt;h2 id="05-relevant-project">05 Relevant Project&lt;/h2>
&lt;p>Here is a list of the projects involved in the demo:&lt;/p>
&lt;ul>
&lt;li>biz-demo: &lt;a href="https://github.com/cloudwego/biz-demo">https://github.com/cloudwego/biz-demo&lt;/a>&lt;/li>
&lt;li>kitex: &lt;a href="https://github.com/cloudwego/kitex">https://github.com/cloudwego/kitex&lt;/a>&lt;/li>
&lt;li>hertz: &lt;a href="https://github.com/cloudwego/hertz">https://github.com/cloudwego/hertz&lt;/a>&lt;/li>
&lt;li>kitex-xds: &lt;a href="https://github.com/kitex-contrib/xds">https://github.com/kitex-contrib/xds&lt;/a>&lt;/li>
&lt;li>kitex-opentelemetry: &lt;a href="https://github.com/kitex-contrib/obs-opentelemetry">https://github.com/kitex-contrib/obs-opentelemetry&lt;/a>&lt;/li>
&lt;li>hertz-opentelemetry: &lt;a href="https://github.com/hertz-contrib/obs-opentelemetry">https://github.com/hertz-contrib/obs-opentelemetry&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>This demo has been submitted in the biz-demo repository, and will be optimised continuously. biz-demo will include some complete demos based on CloudWeGo technology stack with certain business scenarios.
The original intention is to provide valuable references for enterprise users to use CloudWeGo in production. Contributors are always welcomed to participate in the contribution of CloudWeGo biz-demo. Let&amp;rsquo;s try something fun together.&lt;/p></description></item><item><title>Blog: Netpoll Release v0.3.0</title><link>https://www.cloudwego.io/blog/2022/11/09/netpoll-release-v0.3.0/</link><pubDate>Wed, 09 Nov 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/11/09/netpoll-release-v0.3.0/</guid><description>
&lt;h2 id="feat">Feat&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/206">#206&lt;/a>] feat: connection flush support write timeout.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/182">#182&lt;/a>] feat: dial in ipv6 only.&lt;/li>
&lt;/ul>
&lt;h2 id="fix">Fix&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/200">#200&lt;/a>] fix: fd not detach when close by user.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/196">#196&lt;/a>] fix: limit iovecs max to 2GB(2^31).&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/179">#179&lt;/a>] fix: length overflow.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/netpoll/pull/183">#183&lt;/a>] fix: dont check epollout when epollerr.&lt;/li>
&lt;/ul></description></item><item><title>Blog: Kitex Release v0.4.3</title><link>https://www.cloudwego.io/blog/2022/11/02/kitex-release-v0.4.3/</link><pubDate>Wed, 02 Nov 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/11/02/kitex-release-v0.4.3/</guid><description>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="feature">&lt;strong>Feature&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>Extend the Generated Code of client/server&lt;/strong>: Add a new feature which can extend generated client.go/server.go with config file. It is applicable to the scenario for customizing the unified suite. See &lt;a href="[/docs/kitex/tutorials/code-gen/template_extension/]">Extend the Templates of Service Generated Code&lt;/a> for details.&lt;/li>
&lt;li>&lt;strong>Biz Customized Exception&lt;/strong> : Add supporting to return customized biz error which can distinguish with RPC error. See &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/bizstatuserr/">Business Exception&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/issues/511">Proposal&lt;/a>.&lt;/li>
&lt;li>&lt;strong>Request Profiler&lt;/strong> : Add a new feature to do profiler for requests which can be used for cost statistics.&lt;/li>
&lt;li>&lt;strong>Context Middleware&lt;/strong> : Add Context Middleware which is used for adding request-level middlewares.&lt;/li>
&lt;/ol>
&lt;h3 id="optimization">&lt;strong>Optimization&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>Frugal Performance Optimization&lt;/strong> : Support frugal precompile (pretouch) when new client or server, which is to reduce the impact of dynamic compilation on latency.&lt;/li>
&lt;li>&lt;strong>Connpool Optimization&lt;/strong> : Refactor connection pool to improve the idle connections cleanup.&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h3 id="feature-1">Feature&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/691">#691&lt;/a>] feat(client): add context middleware which is used for adding request-level middlewares.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/649">#649&lt;/a>] feat(connpool): new long connection pool with minIdle config and idle connections cleanup.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/672">#672&lt;/a>] feat(grpc): add kitex grpc metadata api to get header, tailer, and peer address metadata.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/613">#613&lt;/a>] feat(exception): support customized biz error which can distinguish with RPC error.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/670">#670&lt;/a>] feat(exception): support error format.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/678">#678&lt;/a>] feat(tool): add git and record param for cmd.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/662">#662&lt;/a>] feat(tool): support frugal precompile (pretouch) when new client or server.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/657">#657&lt;/a>] feat(tool): support template extension.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/527">#527&lt;/a>] feat(profiler): profiler for rpc request which can be used for cost statistics.&lt;/li>
&lt;/ul>
&lt;h3 id="optimize">Optimize&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/690">#690&lt;/a>] optimize(meta): remove error logic for adding default metaHandler in #503.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/638">#638&lt;/a>] optimize(generic): httppb generic support map/list elem type as struct.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/641">#641&lt;/a>] optimize(tool): add warnings comments for oneway methods.&lt;/li>
&lt;/ul>
&lt;h3 id="fix">Fix&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/611">#611&lt;/a>] fix(client): fix resource leaks caused by Finalizer not being triggered in the scenario where clients are created frequently.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/698">#698&lt;/a>] fix(connpool): adjust globalIdle based on the number of connections decreased during the Get.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/636">#636&lt;/a>] fix(connpool): CloseCallback and statistical reporting of connection pool are invalid when the connection pool is reset in &lt;code>ForwardProxy&lt;/code>.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/647">#647&lt;/a>] fix(grpc): update grpc connection window size when initial and synchronize grpc pr #5459.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/639">#639&lt;/a>] fix(generic): marshalling list&lt;byte> in generic and enabling forJSON reader option for MapThriftGeneric.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/655">#655&lt;/a>] fix(generic): numeric constant parsing fails when used as generic default value.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/654">#654&lt;/a>] fix(frugal): fix compilation error when using lower go version.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/682">#682&lt;/a>] fix(profiler): profiler stops pprof profile.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/637">#637&lt;/a>] fix(tool): fix imports in handler.go template.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/630">#630&lt;/a>] fix(tool): remove redundant kitex comments for file that do not declare an interface.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/627">#627&lt;/a>] fix(tool): fix import missing when having different alias for the same path.&lt;/li>
&lt;/ul>
&lt;h3 id="refactor">Refactor&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/651">#651&lt;/a>] refactor(server): server handler read/write interface return new context.&lt;/li>
&lt;/ul>
&lt;h3 id="docs">Docs&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/656">#656&lt;/a>] docs: remove wrong message in CONTRIBUTING.md.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/683">#683&lt;/a>] docs(kerrors): fix kerrors WithCauseAndExtraMsg method comment.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/625">#625&lt;/a>] chore: fix grammar of pull request template.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/623">#623&lt;/a>] chore: modify the template of pull request.&lt;/li>
&lt;/ul>
&lt;h3 id="test--ci">Test &amp;amp; CI&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/646">#646&lt;/a>] test: fix ut failure caused by InitRPCInfoFunc not setting rpcinfo.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/680">#680&lt;/a>] test: fix retry test race.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/661">#661&lt;/a>] test: make wpool tests more stable.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/643">#643&lt;/a>] test: add test for detection server handler.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/632">#632&lt;/a>] test: replace handwritten mock classes with gomock auto-generated classes.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/697">#697&lt;/a>] chore(ci): fixed skywalking-eyes version.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/652">#652&lt;/a>] chore(ci): delete repeated tests to reduce unit tests cost times.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/588">#588&lt;/a>] chore(ci): support codecov.&lt;/li>
&lt;/ul></description></item><item><title>Blog: Hertz Release v0.4.0</title><link>https://www.cloudwego.io/blog/2022/10/28/hertz-release-v0.4.0/</link><pubDate>Fri, 28 Oct 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/10/28/hertz-release-v0.4.0/</guid><description>
&lt;h2 id="feature">Feature&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/289">#289&lt;/a>] feat: render support IndentedJSON.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/304">#304&lt;/a>] feat: support errors format for the recovery middleware.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/278">#278&lt;/a>] feat: add compile tag for json implementation.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/239">#239&lt;/a>] feat: add retry extension for client.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/265">#265&lt;/a>] feat: add closeNoResetBuffer method for standard network.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/258">#258&lt;/a>] feat: errors support format.&lt;/li>
&lt;/ul>
&lt;h2 id="optimize">Optimize&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/295">#295&lt;/a>] optimize: ignore flushing error when connection is closed or reset.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/322">#322&lt;/a>] optimize: modify the default log of the recovery middleware.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/266">#266&lt;/a>] optimize(hlog): distinguish systemlogger and defaultlogger.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/280">#280&lt;/a>] optimize: add listening log when using standard lib.&lt;/li>
&lt;/ul>
&lt;h2 id="refactor">Refactor&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/318">#318&lt;/a>] refactor: add SetRetryIf to remain compatible.&lt;/li>
&lt;/ul>
&lt;h2 id="test">Test&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/299">#299&lt;/a>] test: enrich ut for pkg/protocol/header.go.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/290">#290&lt;/a>] test: enrich ut for pkg/app/server/option.go.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/274">#274&lt;/a>] test: increase internal/bytesconv unit test statement coverage.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/285">#285&lt;/a>] test: enrich unit tests for pkg/protocol/request.go.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/271">#271&lt;/a>] test: ut supplementary for pkg/network.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/264">#264&lt;/a>] test: add ut for hertz/pkg/common/adaptor.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/267">#267&lt;/a>] test(pkg/common/config): pkg/common/config test coverage.&lt;/li>
&lt;/ul>
&lt;h2 id="docs">Docs&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/328">#328&lt;/a>] docs: add lark extension to readme.md.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/325">#325&lt;/a>] docs: update performance data in README and README_cn.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/307">#307&lt;/a>] docs(README): add hertz extensions list.&lt;/li>
&lt;/ul>
&lt;h2 id="style">Style&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/316">#316&lt;/a>] style: remove empty comments for license.&lt;/li>
&lt;/ul>
&lt;h2 id="chore">Chore&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/272">#272&lt;/a>] chore: upgrade sonic version.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/310">#310&lt;/a>] chore: change license header style to avoid format error of buildtag from CI check.&lt;/li>
&lt;/ul></description></item><item><title>Blog: Volo Release v0.2.1</title><link>https://www.cloudwego.io/blog/2022/10/26/volo-release-v0.2.1/</link><pubDate>Wed, 26 Oct 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/10/26/volo-release-v0.2.1/</guid><description>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/61">#61&lt;/a>] optimize volo-thrift code, remove unnecessary generic parameters.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/63">#63&lt;/a>] remove TAIT elision lifetime required after nightly-2022-10-20.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/73">#73&lt;/a>] remove useless liftetime parameter in LoadBalance:: InstanceIter.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/65">#65&lt;/a>] feat: upgrade clap to 4.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/72">#72&lt;/a>] feat: add writev support for volo net conn.&lt;/li>
&lt;/ul></description></item><item><title>Blog: Volo Release v0.2.0</title><link>https://www.cloudwego.io/blog/2022/10/18/volo-release-v0.2.0/</link><pubDate>Tue, 18 Oct 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/10/18/volo-release-v0.2.0/</guid><description>
&lt;h2 id="feature">Feature&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/31">#31&lt;/a>] Support Windows.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/26">#26&lt;/a>] feat: add sd and lb for grpc.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/45">#45&lt;/a>] feat(grpc): support uds.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/32">#32&lt;/a>] feat: grpc support metainfo.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/30">#30&lt;/a>] feat: grpc server add &lt;code>layer_front()&lt;/code>.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/42">#42&lt;/a>] feat(thrift): support multiplex.&lt;/li>
&lt;/ul>
&lt;h2 id="optimize">Optimize&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/53">#53&lt;/a>] fix: &lt;code>write_field_begin&lt;/code> args.&lt;/li>
&lt;/ul>
&lt;h2 id="fix">Fix&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/34">#34&lt;/a>] fix: connect timeout.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/46">#46&lt;/a>] retry IO error only.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/volo/pull/33">#33&lt;/a>] fix: grpc middleware error constraints.&lt;/li>
&lt;/ul></description></item><item><title>Blog: Kitex: Unifying Open Source Practice for a High-Performance RPC Framework</title><link>https://www.cloudwego.io/blog/2022/09/30/kitex-unifying-open-source-practice-for-a-high-performance-rpc-framework/</link><pubDate>Fri, 30 Sep 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/09/30/kitex-unifying-open-source-practice-for-a-high-performance-rpc-framework/</guid><description>
&lt;h2 id="from-development-to-open-source-transition">From Development to Open Source Transition&lt;/h2>
&lt;p>Many researchers and practitioners may have just learned about CloudWeGo, so let&amp;rsquo;s first introduce the relationship between CloudWeGo and &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a>.&lt;/p>
&lt;h2 id="cloudwego-and-kitex">CloudWeGo and Kitex&lt;/h2>
&lt;p>Kitex is CloudWeGo&amp;rsquo;s first open-source microservice framework, designed to empower developers in building high-performance and extensible microservices using Golang. Kitex encompasses the entire stack, including the network library, serialization library, and framework implementation, making it a comprehensive self-developed RPC framework.&lt;/p>
&lt;p>One notable feature of Kitex is its support for the gRPC protocol. Leveraging the official gRPC source code, Kitex optimizes the gRPC implementation, resulting in superior performance compared to the official gRPC framework. This sets Kitex apart from other Golang frameworks that offer open-source support for the gRPC protocol. Developers seeking both gRPC functionality and high-performance capabilities will find Kitex to be an excellent choice.&lt;/p>
&lt;p>In addition to Kitex, CloudWeGo has recently introduced two other projects to its open-source lineup: &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a>, a Golang HTTP framework, and &lt;a href="https://github.com/cloudwego/volo">Volo&lt;/a>, a Rust RPC framework. Alongside these microservice frameworks, CloudWeGo offers various high-performance foundational libraries and general microservice capabilities as open-source resources. To explore more of CloudWeGo&amp;rsquo;s open-source sub-projects, visit the &lt;a href="https://www.cloudwego.io/">official CloudWeGo website&lt;/a> for additional information and resources.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/1.png" alt="image">&lt;/p>
&lt;p>Based on feedback from the community, there have been discussions surrounding whether Kitex is an open-source Key Performance Indicator (KPI) project of ByteDance, as well as concerns about its stability and continuity. We can responsibly state that Kitex is not a KPI project, but rather a genuine project derived from ByteDance&amp;rsquo;s extensive internal practical experience. Since its open-source release, we have consistently maintained consistency between the internal and external development efforts of Kitex. This consistency, coupled with the alignment of internal and external codebases, has ensured the continuous iteration and improvement of Kitex. To address any remaining concerns, let us provide you with a detailed overview of Kitex&amp;rsquo;s development and open-source process.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/2.png" alt="image">&lt;/p>
&lt;h2 id="kitex-development-history">Kitex Development History&lt;/h2>
&lt;p>In 2014, ByteDance began adopting Golang as a programming language. The internal services of ByteDance were established in 2015, where the Thrift protocol was chosen for RPC (Remote Procedure Call) scenarios, and an internal RPC framework was supported. In 2016, the first Golang RPC framework called Kite was officially launched. During the initial stages of rapid company growth, the primary focus is on quickly implementing requirements and addressing relatively simple scenarios. Therefore, there may not be extensive considerations in the design process. This approach is reasonable since the exploration phase lacks complete clarity on which scenarios will require support, and excessive consideration can lead to over-design issues.&lt;/p>
&lt;p>As business scenarios became more complex, the demand for diversified functionalities increased, resulting in a rise in the number of access services and calls each year. Kite, the initial Golang RPC framework, eventually proved inadequate to support subsequent iterations. Recognizing this, a new project called Kitex was initiated in 2019, following over three years of online service. The official version of Kitex was released in early 2020, and by the end of the same year, over 10,000 services within Byte were connected to Kitex, showcasing its widespread adoption.&lt;/p>
&lt;p>From 2014 to 2020, Golang has served as the primary programming language for business development within ByteDance, positioning the company as one of the industry leaders in terms of Golang application adoption. Our service framework enables reliable communication among tens of thousands of Golang microservices. Through extensive verification of numerous microservices and handling substantial traffic, we have developed relatively mature microservice best practices. To contribute to the cloud-native community and enrich the Golang product ecosystem, we decided to open-source our internal practices. In 2021, under the CloudWeGo brand, we officially released Kitex as the first open-sourced service framework. As of August this year, Kitex has provided support for over &lt;strong>60,000&lt;/strong> internal services at ByteDance, reaching peak &lt;strong>QPS (Queries Per Second) in the hundreds of millions&lt;/strong>.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/3.png" alt="image">&lt;/p>
&lt;p>You might still have lingering questions regarding the comprehensive microservice system and its integration with the fundamental cloud ecosystem. Whether it&amp;rsquo;s in a public or private cloud environment, additional services are essential to support microservice governance. These services include governance platforms, registration centers, configuration centers, monitoring tools, traceability systems, service grids, and other customized specifications. ByteDance has developed a comprehensive set of internal services to support its microservice system. However, due to constraints, these services cannot be open-sourced in the short term.&lt;/p>
&lt;p>Now, how does CloudWeGo maintain a unified codebase internally and externally while ensuring seamless iteration?
In addressing this issue, let&amp;rsquo;s examine the module division of Kitex. The Kitex module is divided into three distinct parts. Firstly, there is &lt;strong>Kitex Core&lt;/strong>, situated in the middle. This component defines the hierarchical structure of the framework, implements the core logic of the interface, and provides the default implementation of the interface.&lt;/p>
&lt;p>On the left, we have &lt;strong>Kitex Tool&lt;/strong>, which encompasses the implementation related to the generated code. The generated code tool is acquired by compiling this package and includes features such as IDL parsing, verification, code generation, and plug-in support.&lt;/p>
&lt;p>To enhance user convenience and offer more flexible extensions, the main capabilities have been separated as independent open-source basic libraries. Some examples include Thriftgo, Thrift-validator plug-in, and Fastpb. These independent libraries enable users to leverage specific functionalities and extend Kitex as needed.&lt;/p>
&lt;p>On the right, Kitex Byted represents an extended implementation of Byte&amp;rsquo;s internal basic &lt;strong>capabilities&lt;/strong> integration. At the outset, we consolidated internal capabilities as extensions within a single package, allowing for streamlined integration.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/4.png" alt="image">&lt;/p>
&lt;p>By following this approach, we have been able to open-source specific parts of Kitex, namely Kitex Core and Tool. We achieved this by splitting the codebase, migrating the core code and tools of Kitex to the open-source library, and integrating internal extension modules as Kitex extensions while keeping them in the internal library. Additionally, we encapsulated a shell layer within the internal library to ensure seamless upgrades for internal users without significant impact.&lt;/p>
&lt;p>However, Kitex&amp;rsquo;s open-source journey goes beyond simple code splitting. In February 2021, we initiated preparations for Kitex&amp;rsquo;s open-source release. Despite the scalability of Kitex allowing for decoupling and integration with internal infrastructure, Kitex still relies on certain internal basic libraries. Therefore, to facilitate the open-source process, we first identified the dependent libraries and collaborated with relevant developers to open-source the &lt;a href="https://github.com/bytedance/gopkg">bytedance/gopkg&lt;/a> library. This library is jointly maintained by CloudWeGo and ByteDance&amp;rsquo;s language team and includes enhancements to the capabilities of the Golang standard library. Interested developers can follow and utilize this library as a valuable resource.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/5.png" alt="image">&lt;/p>
&lt;p>After successfully open-sourcing the gopkg library, we made necessary code adjustments to ensure compatibility for open-source adaptation. In July 2021, Kitex was officially open-sourced, and the internal version began utilizing the open-source library. However, considering the substantial number of internal microservices relying on Kitex, we prioritized a smooth transition for internal services. Consequently, we opted not to make an initial public announcement about the open-source release. Once we confirmed the stability and compatibility of the open-source version, we proceeded with an official public release in September 2021. The announcement confirmed the open-source nature of Kitex and welcomed external developers to explore and contribute.&lt;/p>
&lt;p>By providing insights into Kitex&amp;rsquo;s development and open-source history, our aim is to address concerns that external developers may have regarding whether Kitex is a KPI project. We want to assure them that Kitex is a community-driven open-source project backed by our commitment to stability, compatibility, and continuous improvement.&lt;/p>
&lt;h3 id="the-value-of-open-source">The Value of Open Source&lt;/h3>
&lt;p>Towards the end of the first part, let&amp;rsquo;s briefly discuss the value that open source brings to us. Although Kitex was not initially developed solely for open source purposes, its implementation has been oriented towards open source from the start. &lt;strong>Kitex&lt;/strong> itself is a project that has undergone extensive internal implementation within our organization. By open sourcing Kitex, our aim is to enable more users to swiftly build microservices internally.&lt;/p>
&lt;p>At the same time, open source allows us to gather valuable feedback from communities and enterprises. It also attracts external developers to contribute their expertise and insights. This collective engagement helps drive the evolution of Kitex towards supporting multiple scenarios and enriching its capabilities, making it applicable to a wider range of contexts and organizations.&lt;/p>
&lt;p>This symbiotic process of open source fosters a positive cycle of mutual benefit and facilitates a win-win scenario for all involved parties.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/6.png" alt="image">&lt;/p>
&lt;h2 id="a-year-long-review-of-open-source-changes">A Year-long Review of Open Source Changes&lt;/h2>
&lt;h3 id="framework-metrics">Framework Metrics&lt;/h3>
&lt;p>Before delving into the one-year open source changes of Kitex, let us first discuss the key metrics that should be considered when choosing a framework.&lt;/p>
&lt;h3 id="scalability">Scalability&lt;/h3>
&lt;p>A framework&amp;rsquo;s scalability is crucial in determining its suitability for different platforms. If a framework is tightly coupled with internal capabilities and cannot be easily transplanted or expanded to support various scenarios, it may present challenges when used externally.&lt;/p>
&lt;h3 id="usability">Usability&lt;/h3>
&lt;p>The ease of use of a framework can be evaluated from two perspectives. Firstly, for business developers, a framework that requires meticulous attention to its internal details may not be suitable for teams with high research and development efficiency requirements. Secondly, for framework-oriented secondary developers who provide custom support, a framework with excessive expansion capabilities or insufficient scalability may impose limitations and high expansion costs.&lt;/p>
&lt;h3 id="richness-of-functions">Richness of Functions&lt;/h3>
&lt;p>While a framework can be customized based on extensibility, it is important to consider that not all developers have the capacity for extensive custom development. An ideal framework should offer a range of options for different expansion capabilities, allowing developers to select and combine them according to their underlying infrastructure and specific environment.&lt;/p>
&lt;h3 id="high-performance">High Performance&lt;/h3>
&lt;p>While the preceding three points are crucial considerations during the initial framework selection, as service scale and resource consumption increase, performance becomes an indispensable factor. It is imperative to prioritize performance when choosing a framework to avoid future issues such as the need for framework replacement or forced customized maintenance.&lt;/p>
&lt;p>Regarding the measurement indicators mentioned above, Kitex may not have achieved perfection in all areas, but these four elements have been carefully considered during its design and implementation. We are committed to ensuring a well-rounded framework that addresses these aspects without compromising on any one of them.&lt;/p>
&lt;h2 id="features">Features&lt;/h2>
&lt;p>The following is an overview of several significant functional features that have been introduced in Kitex&amp;rsquo;s open source journey over the past year.&lt;/p>
&lt;h3 id="proxyless">Proxyless&lt;/h3>
&lt;p>Proxyless is a feature in Kitex that caters to open source scenarios. During the initial stages of Kitex&amp;rsquo;s open source release, there were internal discussions on whether to support xDS integration with &lt;a href="https://github.com/istio/istio">Istio&lt;/a>. For external users, leveraging Istio allows for the quick establishment of a basic microservices architecture, resolving issues such as service discovery, traffic routing, and configuration delivery. However, utilizing the complete Istio solution necessitates the introduction of Envoy, which can increase operational and maintenance costs. Moreover, using the official Envoy solution directly may result in performance degradation, additional CPU overhead, and increased latency.&lt;/p>
&lt;p>If Kitex can directly connect to Istio, users would be able to benefit from some of Istio&amp;rsquo;s capabilities while avoiding the performance loss, deployment complexity, and maintenance costs associated with Envoy. However, in the early days of open source, we did not encounter clear user demands, so we did not provide high-quality support for this.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/7.png" alt="image">&lt;/p>
&lt;p>Later on, the gRPC team also introduced Proxyless support, and Istio officials adopted Proxyless as a recommended approach for Istio usage. Kitex has now implemented support for Proxyless, primarily focusing on service discovery integration. The extensions supported by xDS have been open sourced separately in the &lt;a href="https://github.com/kitex-contrib/xds">kitex-contrib/xds&lt;/a> library and will undergo further enhancements in the future. To learn how to use Kitex to connect with Istio, please refer to the &lt;a href="https://github.com/istio/istio/blob/master/README.md">README&lt;/a> documentation.&lt;/p>
&lt;h3 id="json-and-protobuf-generalized-call-support">JSON and Protobuf generalized Call Support&lt;/h3>
&lt;p>Initially, Kitex provided support for HTTP generalization in gateway scenarios, as well as Map and binary generalization for common service scenarios. However, after open sourcing Kitex, user feedback highlighted the need for JSON and Protobuf generalization, leading to their subsequent implementation.&lt;/p>
&lt;p>The generalization of Protobuf is also used in API gateway scenarios. While the original data format for HTTP generalization is JSON, the serialization of JSON can be bulky and inefficient, which negatively impacts performance. As a result, many mobile interfaces opt to transmit data using Protobuf due to its more compact representation. To address this demand, Kitex now includes support for Protobuf generalization.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/8.png" alt="image">&lt;/p>
&lt;p>Currently, Kitex&amp;rsquo;s generalization primarily focuses on the back-end Thrift service. Whether it&amp;rsquo;s Protobuf, Map, or JSON, Kitex combines IDL analysis on the calling side to encode the data mappings into Thrift packets and send them to the back-end service.&lt;/p>
&lt;p>Now, you may wonder why the generalization is implemented on the calling side instead of the server side. Typically, when we think of generalization, we imagine the server parsing and processing the generalized request, with the caller providing a corresponding generalized client. However, generalization comes with a certain cost, making it less suitable for regular RPC scenarios. Moreover, generalization is meant for all back-end services, including those written in different languages like Golang, Java, C++, Python, Rust, and more. If every language framework had to support generalization, the cost would be significantly high. Additionally, achieving convergence across different language frameworks is a lengthy process. Considering these factors, Kitex supports generalization on the calling side. This approach allows for greater flexibility and enables users to take advantage of generalization selectively based on their specific needs.&lt;/p>
&lt;h3 id="enhanced-retry-capability">Enhanced Retry Capability&lt;/h3>
&lt;p>When Kitex was open sourced last year, it already supported the retry function. Initially, there were two types of retries available: timeout retry and Backup Request.
For timeout retry, only the timeout exception was retried. However, to further improve the success rate of requests, users expressed the need to retry other exceptions or based on specific user-defined status codes. It became evident that supporting only timeout retry was insufficient to meet user requirements. In response, Kitex introduced retries with specified results. Users can now specify other exceptions or a particular type of response for which they want retries, and the framework will retry according to the specified results.&lt;/p>
&lt;p>Additionally, when users configure retries, if they set retries through code configuration, it will take effect for all RPC methods of the entire Client. However, users desired the ability to apply different retry strategies to different RPC methods. Different RPC methods may have varying requirements for indicators. For instance, some users may prefer using Backup Request to reduce delay, while others may prioritize exception retry to improve the success rate. To address this need, the new version of Kitex supports request granular configuration for retries.
The example below illustrates the usage of request granularity retry configuration. For example, if the RPC method is Mock, then when initiating an RPC call, we can configure a calloptspecified, and this request will adopt the specified retry strategy.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/9.png" alt="image">&lt;/p>
&lt;h3 id="thrift-validator">Thrift Validator&lt;/h3>
&lt;p>Thrift-gen-validator is a tool plug-in for Thriftgo, that enhances the code generation process. It allows users to describe and enforce constraints on the generated &lt;code>struct&lt;/code>&amp;rsquo;s &lt;code>IsValid()&lt;/code> error method based on annotations defined in the Thrift IDL. This ensures the legality of field values. Usually when making an RPC call, the user may verify the validity of some fields. If the user directly writes these verification codes, the investment cost will be high. To address this, we provide annotation support. As long as users define annotations in IDL according to the specified format, Kitex can help users generate verification code.&lt;/p>
&lt;p>The example below demonstrates the usage of code generation commands and an IDL annotation definition. By specifying the Thrift Validator plugin during code generation, our tool will parse the annotations and generate the required validation code. We are also currently contributing the Thrift Validator functionality to Apache Thrift.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/10.png" alt="image">&lt;/p>
&lt;h2 id="performance-optimization">Performance Optimization&lt;/h2>
&lt;p>After highlighting the important functional features, let&amp;rsquo;s move on to discussing several performance optimization features.&lt;/p>
&lt;h3 id="thrift-high-performance-codec">Thrift High-Performance Codec&lt;/h3>
&lt;p>&lt;a href="https://github.com/cloudwego/frugal">Frugal&lt;/a> is a dynamic Thrift codec that offers high-performance capabilities by leveraging Just-in-Time (JIT) compilation, eliminating the need for code generation. While we have already optimized the official Thrift codec and introduced FastThrift as part of our pre-open source optimization efforts, we wanted to further enhance performance by incorporating the design principles from our open source high-performance JSON library, Sonic. As a result, we have implemented the Thrift JIT codec in Frugal.
The table below illustrates a performance comparison between Frugal, combined with Kitex, and FastThrift.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/frugal.png" alt="image">&lt;/p>
&lt;p>It is evident that Frugal offers superior RPC performance in most scenarios. In addition to its performance advantages, Frugal provides another benefit: it eliminates the need to generate codec code. Compared to Protobuf, Thrift&amp;rsquo;s generated code tends to be heavier. A complex IDL can generate files with tens of thousands of lines of code, which users are responsible for maintaining. Frugal simplifies this process by only requiring the generation of structure code, removing the need for codec code generation.&lt;/p>
&lt;p>To learn how to use Frugal in conjunction with Kitex, you can refer to the repository&amp;rsquo;s &lt;a href="https://github.com/cloudwego/frugal#readme">Readme&lt;/a> file. users can also utilize Frugal as a standalone high-performance codec for Thrift. In the future, &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a> may consider incorporating Frugal as the default codec option.&lt;/p>
&lt;h3 id="protobuf-high-performance-codec">Protobuf High-Performance Codec&lt;/h3>
&lt;p>We primarily focused on supporting Thrift internally; however, we recognized that external users are more inclined towards using Protobuf or gRPC after the open-source release. Consequently, taking inspiration from Kitex FastThrift&amp;rsquo;s optimization approach, we re-implemented the generated code for Protobuf.
Starting from version v0.4.0, if users employ Kitex tools to generate Protobuf code, the default generation will include &lt;a href="https://github.com/cloudwego/fastpb">Fastpb&lt;/a> codec code. Furthermore, when initiating RPC calls, Kitex will also utilize &lt;a href="https://github.com/cloudwego/fastpb">Fastpb&lt;/a> as the default serialization option.&lt;/p>
&lt;p>The figures below illustrate a performance comparison between &lt;a href="https://github.com/cloudwego/fastpb">Fastpb&lt;/a> and the official Protobuf serialization library. It is evident that Fastpb outperforms the official library in terms of efficiency, memory allocation, encoding, and decoding.&lt;/p>
&lt;ul>
&lt;li>FastWrite: &lt;strong>(ns/op) ↓67.8% ，(B/op) ↓83.9%&lt;/strong>&lt;/li>
&lt;li>FastRead: &lt;strong>(ns/op) ↓41.5% ，(B/op) ↓4.5%&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h3 id="grpc-performance-optimization">gRPC Performance Optimization&lt;/h3>
&lt;p>In the early days of open sourcing Kitex, our focus on stability and performance optimization for gRPC was relatively limited, as there were fewer internal use cases. However, after receiving feedback from numerous external users, we made dedicated efforts to address issues and optimize the performance of gRPC. In the middle of this year, we officially contributed these optimizations to the open-source library, which was released in version v0.4.0.&lt;/p>
&lt;p>The figure below provides a comparison of unary request throughput between Kitex-gRPC and the official gRPC framework before and after optimization. On the left side, you can see the throughput comparison before optimization.&lt;/p>
&lt;p>The figure below provides a comparison of unary request throughput between Kitex-gRPC and the official gRPC framework before and after optimization. On the left side, you can see the throughput comparison before optimization. At relatively low concurrency, Kitex&amp;rsquo;s throughput does not exhibit an advantage over the official gRPC framework. However, when using Fastpb, Kitex&amp;rsquo;s throughput performance improves compared to the pre-optimization stage. Despite this improvement, the low-concurrency throughput is still lower than that of the official gRPC framework. On the right side of the figure, you can observe the throughput comparison after optimization. The throughput has increased by 46% - 70% compared to the pre-optimization stage, and when compared to the official gRPC framework, the throughput has increased by 51% - 70%.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/13.png" alt="image">&lt;/p>
&lt;p>The right side of the figure below presents a comparison of latency for the optimized Unary requests. In scenarios where Kitex achieves a much higher throughput than the official gRPC framework, Kitex also demonstrates significantly lower latency compared to gRPC. Additionally, after optimization, Kitex exhibits improved delay performance overall.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/14.png" alt="image">&lt;/p>
&lt;p>Now let&amp;rsquo;s examine the performance comparison of streaming requests in a stress test. Prior to optimization, Kitex&amp;rsquo;s performance for streaming requests, even under low concurrency, did not outperform the gRPC framework. However, after optimization, Kitex&amp;rsquo;s throughput surpasses that of the official gRPC, as demonstrated in the figure below. It is worth noting that while Kitex achieves high throughput under low concurrency, the latency remains relatively consistent. However, as concurrency increases, the latency diverges. Consequently, in terms of performance, Kitex&amp;rsquo;s implementation of the gRPC protocol exhibits clear advantages over the official framework.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/15.png" alt="image">&lt;/p>
&lt;p>While Kitex may not have achieved complete functional alignment at this stage, it is capable of fulfilling the requirements of the majority of scenarios. Moreover, we are committed to ongoing efforts to further align and enhance its functionality in the future.&lt;/p>
&lt;h2 id="development-with-community-and-advancement-of-ecosystem-and-enterprise-integration">Development with Community and Advancement of Ecosystem and Enterprise Integration&lt;/h2>
&lt;h3 id="kitexs-community-driven-ecosystem-expansion">Kitex&amp;rsquo;s Community-Driven Ecosystem Expansion&lt;/h3>
&lt;p>Since its open-source release, we have been thrilled by the enthusiastic response from developers. Recognizing our team&amp;rsquo;s limitations in rapidly building an extensive Kitex ecosystem for external users, we have relied on the invaluable support of the community over the past year. Through collaborative efforts, Kitex has received significant contributions in areas such as service registration/discovery, observability, and service governance, with notable advancements in service registration/discovery. We have successfully integrated with mainstream open-source registration centers, and although further enhancements are required, we now possess the capability to help external users build robust microservice architectures, leveraging our existing support and expanding feature set.&lt;/p>
&lt;p>While we acknowledge the need for further enrichment in our docking capabilities, we are proud to state that, in conjunction with our existing support, Kitex already possesses the necessary features to facilitate the construction of microservice architectures for external users.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/16.png" alt="image">&lt;/p>
&lt;p>We extend our heartfelt appreciation to the developers who have actively contributed to the growth of the CloudWeGo community. To explore the extensive ecosystem surrounding Kitex, we invite you to visit the &lt;a href="https://github.com/kitex-contrib">kitex-contrib&lt;/a> repository in our open-source warehouse.&lt;/p>
&lt;h3 id="working-with-external-companies">Working with External Companies&lt;/h3>
&lt;p>Our primary goal with the open-source release of Kitex was to assist external companies in swiftly establishing enterprise-level cloud-native architectures. Since then, we have been delighted to receive interest and engagement from notable organizations such as Semir, Huaxing Securities, Tanwan Games, and Heduo Technology. Their valuable feedback and specific requirements have shed light on unique usage scenarios and challenges distinct from our internal use cases, necessitating our attention, support, and optimization efforts.&lt;/p>
&lt;p>We are thrilled to witness the successful application of Kitex in these enterprise environments. In fact, during the CloudWeGo Meetup held on June 25th of this year, R&amp;amp;D professionals from &lt;a href="https://mp.weixin.qq.com/s/JAurW4P2E3NIduFaVY6jew">Semir&lt;/a> and &lt;a href="https://mp.weixin.qq.com/s/QqGdzp-7rTdlxedy6bsXiw">Huaxing Securities&lt;/a> shared their internal experiences and practical use cases, further validating the effectiveness and value of Kitex in real-world scenarios.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/17.png" alt="image">&lt;/p>
&lt;p>In addition to the above companies, we have also provided consultation to private inquiries from various organizations regarding usage issues. We are very grateful for the support and feedback from these corporate users. As mentioned earlier, gathering feedback from the community and enterprises plays a crucial role in driving the evolution of Kitex to support a wide range of scenarios. If enterprise users have any specific needs or requirements, we encourage them to reach out to us.&lt;/p>
&lt;h2 id="how-to-use-kitex-to-integrate-with-existing-infrastructure">How to use Kitex to Integrate with Existing Infrastructure&lt;/h2>
&lt;p>Here is a brief introduction on how to use Kitex to integrate with your internal infrastructure. Let&amp;rsquo;s take ByteDance as an example, there are extensions in the open source library within the internal warehouse. These extensions are designed to integrate internal capabilities specific to ByteDance. Within the BytedSuite, Kitex can be initialized to cater to various scenarios. Users simply need to add an option configuration while constructing the Client and Server components to achieve seamless integration. To ensure a hassle-free experience, we have incorporated this configuration within the generated scaffolding code. This means that users no longer need to specifically focus on integrating internal capabilities. Furthermore, we plan to share details about how this configuration is embedded in the generated code. By doing so, secondary developers working with external frameworks will be able to provide integration capabilities to business development teams in a similar manner.
&lt;img src="https://www.cloudwego.io/img/blog/Kitex_architecture_explained_en/18.png" alt="image">&lt;/p>
&lt;h2 id="summary-and-future-perspectives">Summary and Future Perspectives&lt;/h2>
&lt;h3 id="summarize">Summarize&lt;/h3>
&lt;p>This blog introduces the following key points:&lt;/p>
&lt;ol>
&lt;li>The transition of Kitex from an internally used framework to an open-source framework while ensuring compatibility between internal and external versions.&lt;/li>
&lt;li>Overview of important functional features and performance optimizations released during the past year of open source.&lt;/li>
&lt;li>The origination and development of Kitex&amp;rsquo;s ecosystem with contributions from the community, examples of enterprise adoption, and elegant integration of internal capabilities using Kitex.&lt;/li>
&lt;/ol>
&lt;h3 id="future-perspectives">Future Perspectives&lt;/h3>
&lt;ol>
&lt;li>Collaborate with the community to further enrich the ecosystem and foster active participation from developers.&lt;/li>
&lt;li>Enhance the usability of Kitex by incorporating engineering practices and providing greater convenience for microservice developers.&lt;/li>
&lt;li>Continuously improve the BDThrift ecosystem and optimize support for Protobuf and gRPC.&lt;/li>
&lt;li>Explore and implement additional feature support and open sourcing, such as ShmIPC (shared memory IPC), QUIC (Quick UDP Internet Connections), and generalization for Protobuf.&lt;/li>
&lt;/ol>
&lt;p>By pursuing these goals, Kitex aims to meet the evolving needs of users and further strengthen its position as a reliable and efficient framework for building cloud-native architectures.&lt;/p></description></item><item><title>Blog: Hertz Release v0.3.2</title><link>https://www.cloudwego.io/blog/2022/09/20/hertz-release-v0.3.2/</link><pubDate>Tue, 20 Sep 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/09/20/hertz-release-v0.3.2/</guid><description>
&lt;h2 id="feature">Feature&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/198">#198&lt;/a>] feat: add the function to get the client dialer name.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/251">#251&lt;/a>] feat: add a startup log to display the name of the loaded network library.&lt;/li>
&lt;/ul>
&lt;h2 id="refactor">Refactor&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/238">#238&lt;/a>] refactor: refactor the client logic initialize for HostClient and TLSHostClient.&lt;/li>
&lt;/ul>
&lt;h2 id="optimize">Optimize&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/226">#226&lt;/a>] optimize: add a warning log for illegal status code.&lt;/li>
&lt;/ul>
&lt;h2 id="fix">Fix&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/249">#249&lt;/a>] fix: add channel signal judge to allow onShutdownHook to complete or timeout.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/232">#232&lt;/a>] fix: fix some trailing slash redirect bugs.&lt;/li>
&lt;/ul>
&lt;h2 id="chore">Chore&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/217">#217&lt;/a>] chore: update pr template.&lt;/li>
&lt;/ul></description></item><item><title>Blog: China's First Rust-based RPC Framework - Volo is Officially Open Source!</title><link>https://www.cloudwego.io/blog/2022/08/30/chinas-first-rust-based-rpc-framework-volo-is-officially-open-source/</link><pubDate>Tue, 30 Aug 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/08/30/chinas-first-rust-based-rpc-framework-volo-is-officially-open-source/</guid><description>
&lt;p>&lt;a href="https://github.com/cloudwego/volo">Volo&lt;/a> is a lightweight, high-performance, scalable, and user-friendly Rust RPC framework developed by the ByteDance service framework team. It leverages the latest GAT and TAIT features of Rust to deliver exceptional performance and efficiency.
Within ByteDance, Volo has been extensively used, implementing multiple business and foundational components. It has exceeded performance expectations, showcasing its superiority compared to the Go version. As with other CloudWeGo open-source projects, Volo maintains a consistent codebase internally and externally, ensuring robustness and reliability for open-source users.
While observing the relatively weak Rust open-source community in terms of RPC frameworks, Volo&amp;rsquo;s open-source release aims to contribute to community improvement. It also strengthens the CloudWeGo ecosystem, advancing performance, security, and the adoption of the latest technologies. Volo provides robust support for developers, enterprises, and Rustaceans in developing RPC microservices and building cloud-native distributed systems.
This article will provide a brief introduction to Volo and its related ecosystem, offering suggestions for choosing between Rust and Go.&lt;/p>
&lt;h2 id="origin-of-the-project">Origin of the project&lt;/h2>
&lt;p>The founding members of &lt;a href="https://github.com/cloudwego/volo">Volo&lt;/a> originally came from the &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a> team, the open-source Go RPC framework developed by CloudWeGo. Through deep performance optimizations in Go, they encountered challenges that motivated their exploration of Rust. Rust proved to be a suitable choice for businesses requiring exceptional performance, safety, and low-level control capabilities. The birth of Volo was driven by the need for a robust RPC framework as a vital component of distributed systems.&lt;/p>
&lt;h2 id="features">Features&lt;/h2>
&lt;p>Key features of Volo include:&lt;/p>
&lt;h3 id="high-performance">High performance&lt;/h3>
&lt;p>Rust&amp;rsquo;s reputation for high performance and safety guides the design and implementation of Volo. Every aspect of the framework is optimized to minimize overhead and maximize performance.
It is important to note that directly comparing the performance of Volo and Kitex would be unfair, and the performance data provided should be viewed as a reference. We aim to avoid unnecessary controversy, especially since there is no mature Async version of a Thrift RPC framework in the Rust open-source community. Instead, we focus on sharing our own limit QPS (queries per second) data.
Under the same test conditions as &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a> (limited to 4 cores), Volo achieves a limit QPS of 350,000 (35W). Furthermore, we are internally validating a version based on &lt;a href="https://github.com/bytedance/monoio">Monoio&lt;/a> (CloudWeGo&amp;rsquo;s open-source Rust Async Runtime), which can achieve a limit QPS of 440,000 (44W).
Judging from the flame graph of our online business, thanks to Rust&amp;rsquo;s static distribution and excellent compilation optimization, the overhead of the framework part is basically negligible (excluding syscall overhead).&lt;/p>
&lt;h3 id="based-on-gat-design">Based on GAT design&lt;/h3>
&lt;p>Volo embraces the latest technologies and utilizes Rust&amp;rsquo;s GAT feature as the core abstraction. Additionally, we draw inspiration from Tower, a well-designed abstraction layer suitable for non-GAT scenarios. We extend our gratitude to the &lt;a href="https://github.com/tower-rs/tower">Tower&lt;/a> team for their contribution.&lt;/p>
&lt;p>Through the use of GAT, Volo eliminates unnecessary Box memory allocations, enhances usability, and offers users a more intuitive programming interface and a more ergonomic programming paradigm.
Our core abstraction is as follows:&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/opensource_volo/1.png" alt="image">&lt;/p>
&lt;p>Thanks to the use of Rust&amp;rsquo;s GAT feature, they address the lifecycle challenges associated with returning asynchronous Futures. Additionally, if &lt;code>impl_trait_in_assoc_type&lt;/code> is used , the effect will be better. For example, the following methods can be used to implement Timeout:
&lt;img src="https://www.cloudwego.io/img/blog/opensource_volo/2.png" alt="image">&lt;/p>
&lt;h3 id="easy-to-use">Easy to use&lt;/h3>
&lt;p>Rust is renowned for its learning curve and perceived difficulty. We recognize the importance of reducing the barriers for users to adopt the Volo framework and develop microservices in the Rust language. Our goal is to provide the most intuitive and simple coding experience possible.&lt;/p>
&lt;p>To achieve this, we offer the Volo command-line tool, which facilitates project initialization and IDL management. Additionally, we have separated Thrift and gRPC into two independent frameworks (although they share some components) to cater to the specific programming paradigms and interfaces that align with each protocol&amp;rsquo;s semantics.&lt;/p>
&lt;p>We also provide the &lt;code>#[service]&lt;/code> macro (which can be understood as the &lt;code>async_trait&lt;/code> that does not require &lt;code>Box&lt;/code>) to enable users to write service middleware using async rust without psychological burden.
This macro simplifies the implementation of Service middleware, as demonstrated below:&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/opensource_volo/3.png" alt="image">&lt;/p>
&lt;h3 id="strong-scalability">Strong scalability&lt;/h3>
&lt;p>Benefiting from Rust&amp;rsquo;s powerful expression and abstraction capabilities, developers can process RPC meta-information, requests, and responses in a unified manner through flexible middleware &amp;lsquo;Service&amp;rsquo; abstraction.
For example, service governance functions such as service discovery and load balancing can be implemented in the form of services without the need to implement Trait independently.
We encourage everyone to contribute their own extensions to volo-rs, which will be hosted under the &lt;a href="http://github.com/volo-rs">github.com/volo-rs&lt;/a> organization&lt;/p>
&lt;h2 id="ecosystem">Ecosystem&lt;/h2>
&lt;p>Volo is the RPC framework at the core, accompanied by the following open-source projects:&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://github.com/volo-rs">Volo-rs&lt;/a>: The volo ecosystem which contains a lot of useful components.&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudwego/pilota">Pilota&lt;/a>: A thrift and protobuf implementation in pure rust with high performance and extensibility.&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudwego/motore">Motore&lt;/a>: Middleware abstraction layer designed by Tower, leveraging GAT and TAIT.&lt;/li>
&lt;li>&lt;a href="https://github.com/cloudwego/metainfo">Metainfo&lt;/a>: A Volo component for transparent transmission of meta information, aimed at defining a set of standards for such transmission.&lt;/li>
&lt;/ol>
&lt;h2 id="choosing-between-rust-and-go">Choosing Between Rust and Go&lt;/h2>
&lt;p>The question of when to use Rust or Go is a classic one. From the perspective of the Volo team, Rust and Go are not opposing choices but rather complementary options that can learn from each other.&lt;/p>
&lt;ul>
&lt;li>For performance-insensitive, IO-heavy, and rapidly developing applications that prioritize stability, Go is recommended. Rust does not bring significant benefits in such scenarios.&lt;/li>
&lt;li>However, for applications requiring extreme performance, heavy calculations, and a need for stability, even if it comes at the expense of development speed, Rust is recommended. Rust&amp;rsquo;s advantages in extreme performance optimization and security are valuable in these cases.&lt;/li>
&lt;li>Additionally, the team&amp;rsquo;s existing technology stack and talent pool are crucial factors to consider.&lt;/li>
&lt;/ul>
&lt;h2 id="summary">Summary&lt;/h2>
&lt;p>We hope this article has provided you with a basic understanding of &lt;a href="https://github.com/cloudwego/volo">Volo&lt;/a> and its related ecosystem. Volo is still in its early stages, and we welcome interested developers to join us in building the CloudWeGo and Rust open-source communities. We encourage you to submit &lt;a href="https://github.com/cloudwego/volo/issues">Issues&lt;/a> and &lt;a href="https://github.com/cloudwego/volo/pulls">PRs&lt;/a> to Volo, as we look forward to collective development. We sincerely hope to see more developers join us, and we aspire for Volo to assist more enterprises in swiftly building cloud-native architectures. If enterprise customers wish to explore Volo internally, we can schedule dedicated technical support and communication for their needs.&lt;/p>
&lt;h3 id="references">References&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/cloudwego/volo">Volo overview&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.cloudwego.io/docs/volo/">Volo Tutorial&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.rs/volo">Volo Documentation&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/volo-rs">Volo-rs organization&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Blog: Hertz Release v0.3.0</title><link>https://www.cloudwego.io/blog/2022/08/29/hertz-release-v0.3.0/</link><pubDate>Mon, 29 Aug 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/08/29/hertz-release-v0.3.0/</guid><description>
&lt;h2 id="feature">Feature&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/182">#182&lt;/a>] feat: add service registration &amp;amp; service discovery &amp;amp; load balancing.&lt;/li>
&lt;li>&lt;a href="https://github.com/hertz-contrib/registry/pull/6">[#6]&lt;/a> feat: add zookeeper register.&lt;/li>
&lt;li>&lt;a href="https://github.com/hertz-contrib/registry/pull/7">[#7]&lt;/a> feat: add nacos registry.&lt;/li>
&lt;li>&lt;a href="https://github.com/hertz-contrib/registry/pull/8">[#8]&lt;/a> feat: Support Hertz to use Consul for service discovery and registration.&lt;/li>
&lt;li>&lt;a href="https://github.com/hertz-contrib/registry/pull/9">[#9]&lt;/a> feat: add polaris registry.&lt;/li>
&lt;li>&lt;a href="https://github.com/hertz-contrib/registry/pull/14">[#14]&lt;/a> feat: add etcd registry.&lt;/li>
&lt;li>&lt;a href="https://github.com/hertz-contrib/registry/pull/15">[#15]&lt;/a> feat: support servicecomb.&lt;/li>
&lt;li>&lt;a href="https://github.com/hertz-contrib/registry/pull/16">[#16]&lt;/a> feat: support service registration and discovery with Netflix Eureka.&lt;/li>
&lt;/ul>
&lt;h2 id="refactor">Refactor&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/175">#175&lt;/a>] refactor: distinguish between global dialer and local dialer.&lt;/li>
&lt;/ul>
&lt;h2 id="optimize">Optimize&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/205">#205&lt;/a>] optimize: func checkPathValid returns true if the path is valid.&lt;/li>
&lt;/ul>
&lt;h2 id="test">Test&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/174">#174&lt;/a>] test: correcting TestRouterMiddlewareAndStatic.&lt;/li>
&lt;/ul>
&lt;h2 id="fix">Fix&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/190">#190&lt;/a>] fix: modify the same middleware name.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/192">#192&lt;/a>] fix: fix the problem of the same package name in handler.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/208">#208&lt;/a>] fix: deregister failed when service shutdown.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/202">#202&lt;/a>] fix: get wrong local loopback IPv6.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/196">#196&lt;/a>] fix: typo.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/155">#155&lt;/a>] fix: name_style_thrift.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/169">#169&lt;/a>] fix: thrift namespace.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/184">#184&lt;/a>] fix: hijack conn throw timeout err when using standard network lib.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/162">#162&lt;/a>] fix: generate router register error.&lt;/li>
&lt;/ul>
&lt;h2 id="chore">Chore&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/189">#189&lt;/a>] Revert &amp;ldquo;fix: generate router register error&amp;rdquo;.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/203">#203&lt;/a>] add v6 support for AddMissingPort function.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/186">#186&lt;/a>] chore: support codecov.&lt;/li>
&lt;/ul></description></item><item><title>Blog: Kitex Release v0.4.0</title><link>https://www.cloudwego.io/blog/2022/08/26/kitex-release-v0.4.0/</link><pubDate>Fri, 26 Aug 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/08/26/kitex-release-v0.4.0/</guid><description>
&lt;h2 id="introduction-to-key-changes">&lt;strong>Introduction to Key Changes&lt;/strong>&lt;/h2>
&lt;h3 id="feature">&lt;strong>Feature&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>Retry enhancement&lt;/strong>: Support user-defined result retry; Support request-level configuration (priority is higher than Neptune). See &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/service-governance/retry/">retry guide&lt;/a> for details&lt;/li>
&lt;li>&lt;strong>Frugal (Thrift)&lt;/strong>: Support default value of IDL; No codec code is supported by using frugal. See &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/advanced-feature/codec_frugal/">frugal&lt;/a> for details&lt;/li>
&lt;li>&lt;strong>Tool-Protobuf&lt;/strong>: Support depend on external libraries with go_package, see &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/code-gen/code_generation/#notes-for-using-protobuf-idls">Notes for Using Protobuf IDLs&lt;/a>; Support Guess IDL type from the file extension, it is unnecessary to specify the type param when generating the protobuf code&lt;/li>
&lt;li>&lt;strong>Fastpb(protobuf)&lt;/strong>: Support fastpb to optimize performance of protobuf, and it is integrated into Kite by default. See &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/code-gen/fastpb/">fastpb&lt;/a> for details&lt;/li>
&lt;li>&lt;strong>Generic Call&lt;/strong>: Support HTTP+Protobuf generic call&lt;/li>
&lt;li>&lt;strong>Kitex lib supports Windows&lt;/strong>: You can use kitex running on Windows (Kitex tool still doesn&amp;rsquo;t support)&lt;/li>
&lt;/ol>
&lt;h3 id="optimization--bugfix">&lt;strong>Optimization &amp;amp; Bugfix&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>Performance Optimization&lt;/strong>: gRPC unary throughput increased by 46-70%, and 51% - 70% higher than the official gRPC framework throughput. See &lt;a href="https://github.com/cloudwego/kitex-benchmark">benchmark&lt;/a> for details&lt;/li>
&lt;li>&lt;strong>Generic Call&lt;/strong>: Support default value defined in thrift IDL for HTTP / Map / JSON Generic&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="full-release-log">&lt;strong>Full Release Log&lt;/strong>&lt;/h2>
&lt;h3 id="feature-1">Feature&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/571">#571&lt;/a>] feat(protobuf): integrate &lt;a href="https://github.com/cloudwego/fastpb">fastpb&lt;/a> into kitex, refer to &lt;a href="https://www.cloudwego.io/docs/kitex/tutorials/code-gen/fastpb/">doc&lt;/a>.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/592">#592&lt;/a>] feat(generic): add default value defined in thrift idl for HTTP/Map/JSON generic call.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/600">#600&lt;/a>] feat(thrift): support no codec gen-code when using frugal.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/607">#607&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/610">#610&lt;/a>] feat(proxyless): add option for xDS extension. Support traffic route, timeout config and service discovery based on xDS.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/541">#541&lt;/a>] feat(trans): Add the go net extension to the transport layer, and choose it as the transmission mode by default in Windows OS.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/540">#540&lt;/a>] feat(retry): support retry with specified error or response and add retry option for setup method retry policy.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/533">#533&lt;/a>] feat(generic): js_conv annotation of generic call supports map type conversion.&lt;/li>
&lt;/ul>
&lt;h3 id="optimize">Optimize&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/522">#522&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/538">#538&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/605">#605&lt;/a>] perf(grpc): optimize performance for gRPC protocol.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/590">#590&lt;/a>] optimize(tool): guess IDL type from file extension.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/559">#559&lt;/a>] optimize(timeout): use wrap func to check timeout err in timeout middleware which can ignore logs customized timeout err.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/581">#581&lt;/a>] optimize(tool): kitex tool usage add cmd example.&lt;/li>
&lt;/ul>
&lt;h3 id="bugfix">Bugfix&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/564">#564&lt;/a>] fix(oneway): discard oneway conn after sending complete, or subsequent requests that send to the same connection may get blocked until the oneway request gets processed by the server.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/577">#577&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/584">#584&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/602">#602&lt;/a>] fix(rpcinfo): fix rpcinfo reuse problem in longconn scene.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/578">#578&lt;/a>] fix: fix long pool dump panic.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/583">#583&lt;/a>] fix(tool): fix misusing of package name in protobuf generated code.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/587">#587&lt;/a>] fix(tool): skip proto files with external import paths when generates code.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/594">#594&lt;/a>] fix(generic): support the tag format of the escape double quotes in single quotes to be compatible with the logic of the old version.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/595">#595&lt;/a>] fix: fix nil union panic in BLength.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/589">#589&lt;/a>, &lt;a href="https://github.com/cloudwego/kitex/pull/596">#596&lt;/a>] fix(frugal): fix frugal build tag.&lt;/li>
&lt;/ul>
&lt;h3 id="refactor">Refactor&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/566">#566&lt;/a>] refactor(metainfo): remove noused metakeys of HTTP2 Header.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/593">#593&lt;/a>] refactor(trans): support specify Listener for server by option WithListener, the priority is higher than WithServiceAddr.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/582">#582&lt;/a>] refactor(tool): use templates by embedding and export APIs for external usage for kitex tool.&lt;/li>
&lt;/ul>
&lt;h3 id="test">Test&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/579">#579&lt;/a>] test: add ut for long pool dump function.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/608">#608&lt;/a>] test: fix data race in TestClientConnDecoupledFromApplicationRead.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/609">#609&lt;/a>] test: fix gonet ut avoid testing port conflicts.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/480">#480&lt;/a>] test: add unit test for client package.&lt;/li>
&lt;/ul>
&lt;h3 id="chore">Chore&lt;/h3>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/558">#558&lt;/a>] ci: fix setup-python github action.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/487">#487&lt;/a>] ci: workflow add golangci-lint.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/580">#580&lt;/a>] chore: fix the typos in remote module about go net.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/601">#601&lt;/a>] chore: fixed some typos and replaced some defunct functions.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/604">#604&lt;/a>] chore: upgrade fastpb to v0.0.2.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/kitex/pull/603">#603&lt;/a>] chore: upgrade frugal to v0.1.2.&lt;/li>
&lt;/ul>
&lt;h3 id="dependency-change">Dependency Change&lt;/h3>
&lt;p>github.com/cloudwego/frugal v0.1.1 -&amp;gt; v0.1.3&lt;/p>
&lt;p>github.com/cloudwego/netpoll v0.2.5 -&amp;gt; v0.2.6&lt;/p>
&lt;p>github.com/cloudwego/thriftgo v0.1.2 -&amp;gt; v0.2.0&lt;/p>
&lt;p>google.golang.org/protobuf v1.26.0 -&amp;gt; v1.28.0&lt;/p>
&lt;p>github.com/choleraehyq/pid v0.0.13 -&amp;gt; v0.0.15&lt;/p>
&lt;p>new imported:&lt;/p>
&lt;p>github.com/cloudwego/fastpb v0.0.2&lt;/p>
&lt;p>github.com/jhump/protoreflect v1.8.2&lt;/p></description></item><item><title>Blog: Hertz Release v0.2.0</title><link>https://www.cloudwego.io/blog/2022/07/22/hertz-release-v0.2.0/</link><pubDate>Fri, 22 Jul 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/07/22/hertz-release-v0.2.0/</guid><description>
&lt;h2 id="feature">Feature&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/124">#124&lt;/a>] feat: add option to remove hijackConnPool.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/116">#116&lt;/a>] feat: update for template.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/130">#130&lt;/a>] feat: add a warning log for invalid character in Cookie.Value.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/143">#143&lt;/a>] feat: custom signal to graceful shutdown&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/114">#114&lt;/a>] feat: release buffer in standard network method.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/112">#112&lt;/a>] feat: parse post args in bodystream.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/105">#105&lt;/a>] feat: client abstracts hostclient layer.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/92">#92&lt;/a>] feat: hz support windows.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/102">#102&lt;/a>] feat: client removes default retry logic.&lt;/li>
&lt;/ul>
&lt;h2 id="optimize">Optimize&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/111">#111&lt;/a>] optimize: pre-allocate slice when calling bytesconv.AppendHTTPDate.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/128">#128&lt;/a>] optimize: remove useless judgement.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/108">#108&lt;/a>] optimize: avoid parsing regular expression repeatedly.&lt;/li>
&lt;/ul>
&lt;h2 id="chore">Chore&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/125">#125&lt;/a>] Update pr-check.yml.&lt;/li>
&lt;/ul>
&lt;h2 id="fix">Fix&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/104">#104&lt;/a>] fix: use defer to guarantee that mutex will be unlocked.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/96">#96&lt;/a>] fix: ci exec /bin/license-eye: exec format error&lt;/li>
&lt;/ul>
&lt;h2 id="style">Style&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/103">#103&lt;/a>] style: fixed the typo &amp;ldquo;ungzipped&amp;rdquo; to &amp;ldquo;gunzipped&amp;rdquo;.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/90">#90&lt;/a>] style: use const var and remove duplicate type conversions.&lt;/li>
&lt;/ul>
&lt;h2 id="refactor">Refactor&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/94">#94&lt;/a>] refactor: use appendCookiePart to simplify code.&lt;/li>
&lt;/ul>
&lt;h2 id="docs">Docs&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/97">#97&lt;/a>] docs: use comma to separate &amp;amp;&amp;amp; remove extra space.&lt;/li>
&lt;/ul></description></item><item><title>Blog: Hertz, an Ultra Large Scale Enterprise-Level Microservice HTTP Framework, is Now Officially Open Source!</title><link>https://www.cloudwego.io/blog/2022/06/21/hertz-an-ultra-large-scale-enterprise-level-microservice-http-framework-is-now-officially-open-source/</link><pubDate>Tue, 21 Jun 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/06/21/hertz-an-ultra-large-scale-enterprise-level-microservice-http-framework-is-now-officially-open-source/</guid><description>
&lt;p>Today, after more than a year of internal use and iteration at ByteDance, &lt;strong>&lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a>&lt;/strong>, a &lt;strong>high-performance enterprise-level HTTP framework&lt;/strong>, is officially open-sourced on &lt;a href="https://github.com/cloudwego">CloudWeGo&lt;/a>! Hertz has become the largest HTTP framework within ByteDance, with more than &lt;strong>10,000&lt;/strong> online services and a peak QPS (Query Per Second) of more than &lt;strong>40 million&lt;/strong>. It has the characteristics of high usability, easy expansion, and low latency. For the ByteDance service framework team and CloudWeGo, &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> will not only be an open source project, but also a real ultra-large-scale enterprise-level practice.&lt;/p>
&lt;p>Project website: &lt;a href="https://github.com/cloudwego/hertz">https://github.com/cloudwego/hertz&lt;/a>&lt;/p>
&lt;p>In the future, ByteDance infrastructure team will iterate on the Hertz open source library, maintaining a unified codebase both internally and externally, and facilitating iterative evolution to enhance user experience.&lt;/p>
&lt;h2 id="hertz-overview">Hertz Overview&lt;/h2>
&lt;p>&lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a> is a high-usability, high-performance, highly extensible, and low-latency Golang HTTP framework that assists developers in building microservices. Originally, the HTTP framework used within ByteDance was an encapsulation of the Gin framework, which offered advantages such as ease of use and a comprehensive ecosystem. However, as the internal business continued to grow, the demand for high performance and versatility rapidly increased.&lt;/p>
&lt;p>&lt;a href="https://github.com/gin-gonic/gin">Gin&lt;/a>, being a secondary development of Golang&amp;rsquo;s native net/http, faced limitations in terms of on-demand expansion and performance optimization. In order to meet the evolving business needs and effectively serve major functions, the ByteDance service framework team embarked on research based on their self-developed networking library, &lt;a href="https://github.com/cloudwego/netpoll">Netpoll&lt;/a>. This research led to the development of the internal framework, Hertz, which exhibits enhanced performance and stability when faced with enterprise-level requirements. Hertz also facilitates business development and addresses evolving technical requirements. In July 2021, Hertz officially launched version 1.0.&lt;/p>
&lt;p>After over a year of internal usage at ByteDance, the Hertz framework has become the largest HTTP framework within the organization. It boasts more than 10,000 online services and reaches a peak QPS of over 40 million. In addition to being utilized by various business lines, Hertz also serves numerous internal core components, such as the function computing platform FaaS, stress testing platform, gateways, and Service Mesh control plane. It has received positive feedback regarding its usage.
In such a large-scale scenario, Hertz demonstrates remarkable stability and performance. Bugs and kernel issues are promptly identified and rectified. Furthermore, Hertz maintains a set of codes both internally and externally, providing a strong foundation for the open-source Hertz framework.&lt;/p>
&lt;h2 id="features">Features&lt;/h2>
&lt;p>Key features of Hertz include:&lt;/p>
&lt;h3 id="stability">Stability&lt;/h3>
&lt;p>In a large-scale environment, Hertz exercises caution during every PR integration and release. Great care is taken to avoid any potential losses, which can amount to millions or even more. A standardized PR and release process has been formulated, requiring review by experienced developers for every code merge. Each PR and version release is to be tested for a period of time, and fully tested. Various testing scenarios, including compatibility, high concurrency, and package size, are employed to minimize risks.&lt;/p>
&lt;h3 id="high-usability">High Usability&lt;/h3>
&lt;p>Hertz prioritizes the ability to write correct code quickly during development. When designing the API, Hertz considers user usage habits and draws inspiration from the industry&amp;rsquo;s mainstream framework API usage. Continuous iteration and user feedback contribute to the framework&amp;rsquo;s refinement. For instance, many users hope that the Client also has the ability to trace. For this reason, Hertz Client supports middleware capabilities. Additionally, the Client supports stream processing in proxy scenarios. Middleware and stream processing are designed with the user&amp;rsquo;s actual habits in mind, promoting faster development of correct code. Hertz also provides a one-click command-line tool for code generation, enhancing the framework&amp;rsquo;s ease of use.&lt;/p>
&lt;h3 id="easy-expandability">Easy expandability&lt;/h3>
&lt;p>Hertz employs a layered design, offering a range of interfaces and default extension implementations for users to expand upon. Details regarding &lt;a href="https://www.cloudwego.io/zh/docs/hertz/tutorials/framework-exten/">Hertz extension&lt;/a> can be found on the &lt;a href="https://www.cloudwego.io/">CloudWeGo official website&lt;/a>. The framework&amp;rsquo;s layered design enhances its scalability. Currently, only stable capabilities are open-sourced, with more planned for the future. Please refer to the &lt;a href="https://github.com/cloudwego/hertz/blob/develop/ROADMAP.md">Hertz roadmap&lt;/a> for further details.&lt;/p>
&lt;h3 id="low-latency">Low latency&lt;/h3>
&lt;p>Hertz utilizes the internally developed high-performance network library, &lt;a href="https://github.com/cloudwego/netpoll">Netpoll&lt;/a>, by default. In certain special scenarios, Hertz demonstrates advantages in terms of QPS and delay compared to the go net package.&lt;/p>
&lt;p>For performance data, please refer to the Echo data in the figure below. Internal testing has shown significant reduction in resource usage, including a &lt;strong>30%-60% decrease in CPU usage&lt;/strong> for services predominantly utilizing frameworks and gateway services. For detailed performance data, please refer to: &lt;a href="https://github.com/cloudwego/hertz-benchmark">https://github.com/cloudwego/hertz-benchmark&lt;/a>.&lt;/p>
&lt;p>&lt;img src="https://www.cloudwego.io/img/blog/Hertz_Open_Source/Echo.png" alt="image">&lt;/p>
&lt;h3 id="command-line-tool">Command line tool&lt;/h3>
&lt;p>Hertz provides a simple and user-friendly command-line tool called Hz. Users simply need to provide an Interface Definition Language (IDL). Based on the defined interface information, Hz can generate project scaffolding with a single click, enabling users to use Hertz out of the box. Additionally, Hz offers update capabilities, allowing users to update the scaffolding when changes are made to the IDL. Currently, Hz supports two IDL definitions: Thrift and Protobuf. The command-line tool provides a range of built-in options that can be tailored to individual needs. It relies on the official Protobuf compiler and the self-developed Thriftgo compiler, both of which support custom code plug-ins for generating templates that meet specific requirements.&lt;/p>
&lt;p>Since the launch of Hertz, the internal response has been excellent. It has been extensively used in various scenarios including front-end and back-end communication, as well as gateway, upload, download, and proxy scenarios. The supported interaction modes encompass not only ping-pong but also streaming and chunk interactions. Hertz supports multiple protocols such as HTTP1, HTTP2, and Websocket. Managing such complex interaction scenarios and modes poses significant challenges to the usability and stability of Hertz&amp;rsquo;s Server and Client components. In response, Hertz promptly addresses user needs and establishes a stability test service that simulates real-world and complex online scenarios as accurately as possible. With a high single-test coverage rate, Hertz ensures that the code logic functions normally and reliably.&lt;/p>
&lt;h2 id="internal-and-external-version-maintenance">Internal and external version maintenance&lt;/h2>
&lt;p>ByteDance possesses a comprehensive internal microservice system, and the team places significant emphasis on open source development and commitment. This principle applies to both the Hertz project and CloudWeGo&amp;rsquo;s &lt;a href="https://github.com/cloudwego/kitex">Kitex&lt;/a> project, ensuring consistency between internal and external versions. The core capabilities of the project have been migrated to the open source library, with only one internal layer of encapsulation. This approach facilitates enterprise upgrades without disruptions, thus guaranteeing long-term maintenance commitments. All open source features will be released after undergoing internal stability verification.&lt;/p>
&lt;p>Moving forward, the team will continue to iterate based on the Hertz open source library, promptly addressing community needs and issues to enhance user experience and ensure a reliable framework. Hertz developers can also leverage its flexible expansion capabilities to meet specific business requirements. Furthermore, external developers are encouraged to &lt;a href="https://github.com/cloudwego/hertz/blob/develop/CONTRIBUTING.md">contribute&lt;/a> to the community, collaboratively constructing an HTTP framework with a comprehensive ecosystem, exceptional performance, and user-friendly features.&lt;/p>
&lt;h2 id="roadmap">Roadmap&lt;/h2>
&lt;p>For the infrastructure team, Hertz represents not only an open source project but also a genuine ultra-large-scale enterprise-level practice. By open sourcing Hertz, our aim is to enrich the Golang middleware system within the cloud-native community, enhance the CloudWeGo ecosystem, and enable more developers and enterprises to build cloud-native large-scale distributed systems. We aspire to provide modern, resource-efficient technical solutions.&lt;/p>
&lt;p>As mentioned earlier, Hertz has currently open sourced only the internally verified stable components. However, we intend to further enhance the framework by pursuing the following objectives:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Cloud native capability support&lt;/strong>: Integrate support for the xDS API to dynamically obtain service configurations from Istio.&lt;/li>
&lt;li>&lt;strong>Multi-protocol support&lt;/strong>: Hertz currently only open-sources HTTP1. In the future, we will open-source other protocols, such as HTTP2, Websocket, ALPN, etc., to provide developers with support for micro-service requirements in more scenarios. If you have a need, you can also submit an issue and let us know your needs for quick support.&lt;/li>
&lt;li>&lt;strong>Improved command-line tools&lt;/strong>: Continuously iterate on Hz, integrating various commonly used middleware and providing modular construction capabilities, enabling users to select the required components as needed.&lt;/li>
&lt;li>&lt;strong>Enhanced ecosystem support&lt;/strong>: Since Hertz does not adopt go net&amp;rsquo;s data structure, additional ecosystem support is required. In the initial batch of open source releases, we have included CORS, Trace, and Metrics. In the future, we plan to support additional aspects such as reverse proxy and Session.&lt;/li>
&lt;li>&lt;strong>Iteration based on user feedback&lt;/strong>: Following the project&amp;rsquo;s open sourcing, we will iterate based on developer feedback and requirements.&lt;/li>
&lt;/ul>
&lt;p>We welcome everyone to &lt;a href="https://github.com/cloudwego/hertz/blob/develop/CONTRIBUTING.md">contribute&lt;/a> by submitting issues and PRs to &lt;a href="https://github.com/cloudwego/hertz">Hertz&lt;/a>, fostering collaborative development. We eagerly anticipate the involvement of more developers and anticipate Hertz aiding enterprises in swiftly constructing cloud-native architectures. Enterprise users are invited to migrate and utilize Hertz, and we will provide dedicated technical support and communication. Feel free to &lt;a href="https://discord.gg/jceZSE7DsW">join our Discord community&lt;/a> for further consultations and assistance.&lt;/p>
&lt;h2 id="related-links">Related Links&lt;/h2>
&lt;ul>
&lt;li>Project &lt;a href="https://github.com/cloudwego/hertz">address&lt;/a>&lt;/li>
&lt;li>Community &lt;a href="https://github.com/hertz-contrib">ecosystem&lt;/a>&lt;/li>
&lt;li>Hertz benchmark &lt;a href="https://www.cloudwego.io/blog/2023/02/24/getting-started-with-hertz-performance-testing-guide/">blog&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Blog: Hertz Release v0.1.0</title><link>https://www.cloudwego.io/blog/2022/06/20/hertz-release-v0.1.0/</link><pubDate>Mon, 20 Jun 2022 00:00:00 +0000</pubDate><guid>https://www.cloudwego.io/blog/2022/06/20/hertz-release-v0.1.0/</guid><description>
&lt;h2 id="feature">Feature&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/31">#31&lt;/a>] feat: close connection after responding to the short-connection request.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/44">#44&lt;/a>] feat: add the VisitAllCustomHeader method.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/59">#59&lt;/a>] feat: support windows.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/70">#70&lt;/a>] feat: add code generator hz.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/64">#64&lt;/a>] feat: add adaptor for Hertz Request &amp;amp; Response to net/http Request &amp;amp; ResponseWriter.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/45">#45&lt;/a>] feat: add ctx.Body().&lt;/li>
&lt;/ul>
&lt;h2 id="optimize">Optimize&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/57">#57&lt;/a>] optimize: use http.TimeFormat as layout for http date, which can avoid more copying.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/58">#58&lt;/a>] optimize: add remote address to the error log when server processes the error.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/41">#41&lt;/a>] optimize: use CtxErrorf instead of ‘Errorf’ when server panic.&lt;/li>
&lt;/ul>
&lt;h2 id="refactor">Refactor&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/37">#37&lt;/a>] refactor: unify the entry of setting request options to prevent options uninitialized from causing panic.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/52">#52&lt;/a>] refactor: omit redundant nil check around loop.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/33">#33&lt;/a>] refactor: simplify code in AddMissingPort.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/27">#27&lt;/a>] refactor: use errors.NewPublic rather than fmt.Errorf.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/34">#34&lt;/a>] refactor: remove fshandler and related tests.&lt;/li>
&lt;/ul>
&lt;h2 id="style">Style&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/29">#29&lt;/a>] style(*): fix typos.&lt;/li>
&lt;/ul>
&lt;h2 id="docs">Docs&lt;/h2>
&lt;ul>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/60">#60&lt;/a>] docs: add icon in README.md and README_cn.md.&lt;/li>
&lt;li>[&lt;a href="https://github.com/cloudwego/hertz/pull/54">#54&lt;/a>] docs: Update README.md.&lt;/li>
&lt;/ul></description></item></channel></rss>